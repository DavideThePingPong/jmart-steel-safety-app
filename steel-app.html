<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>STEEL - AI Trade Documentation Suite</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üî©</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        .header {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header p { color: #888; margin-top: 8px; }

        /* Navigation */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .nav-tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .nav-tab:hover { background: rgba(255,255,255,0.2); }
        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .nav-tab.offline {
            opacity: 0.5;
            position: relative;
        }
        .nav-tab.offline::after {
            content: "API";
            font-size: 8px;
            background: #f59e0b;
            padding: 2px 4px;
            border-radius: 3px;
            position: absolute;
            top: -5px;
            right: -5px;
        }

        /* Agent Section */
        .agent-section {
            display: none;
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .agent-section.active { display: block; }
        .agent-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .agent-icon { font-size: 2.5rem; }
        .agent-title h2 {
            color: #60a5fa;
            font-size: 1.5rem;
        }
        .agent-title p { color: #888; font-size: 0.9rem; }

        /* Controls */
        .control-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .btn-group {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 10px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        .btn:hover { background: rgba(255,255,255,0.2); }
        .btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
        }
        .btn.primary {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            border: none;
        }
        label { color: rgba(255,255,255,0.7); margin-bottom: 5px; display: block; font-size: 13px; }

        /* Results */
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .result-card {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        .result-card .label { color: #888; font-size: 11px; margin-bottom: 4px; }
        .result-card .value { font-size: 1.4rem; font-weight: bold; color: #60a5fa; }
        .result-card .unit { color: #888; font-size: 12px; }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 13px;
        }
        .data-table th, .data-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .data-table th {
            background: rgba(245,158,11,0.3);
            color: #f59e0b;
        }
        .data-table td { background: rgba(0,0,0,0.2); }

        /* Section Buttons Grid */
        .section-btns {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            padding: 5px;
        }
        .section-btn {
            padding: 8px 12px;
            background: rgba(59,130,246,0.2);
            border: 1px solid rgba(59,130,246,0.3);
            border-radius: 6px;
            color: #93c5fd;
            cursor: pointer;
            font-size: 12px;
            font-family: monospace;
        }
        .section-btn:hover { background: rgba(59,130,246,0.4); }
        .section-btn.active {
            background: #3b82f6;
            color: #fff;
        }

        /* Calculator inputs */
        .calc-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
            margin: 15px 0;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        .calc-input { flex: 1; min-width: 120px; }
        .calc-input input {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
        }
        .calc-total {
            text-align: center;
            padding: 10px 20px;
            background: rgba(34,197,94,0.2);
            border-radius: 8px;
        }
        .calc-total .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #22c55e;
        }

        /* Console */
        .console {
            background: rgba(0,0,0,0.4);
            border-radius: 8px;
            padding: 12px 15px;
            font-family: monospace;
            font-size: 13px;
            color: #22c55e;
            margin-top: 15px;
        }

        /* API Notice */
        .api-notice {
            background: rgba(245,158,11,0.2);
            border: 1px solid rgba(245,158,11,0.5);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }
        .api-notice h3 { color: #f59e0b; margin-bottom: 10px; }
        .api-notice p { color: #fcd34d; }

        /* Status badge */
        .status-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-badge.online { background: rgba(34,197,94,0.3); color: #22c55e; }
        .status-badge.offline { background: rgba(239,68,68,0.3); color: #ef4444; }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        /* IGOR Dropdown Styles */
        .igor-dropdown-container {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .igor-dropdown-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }
        .igor-labels {
            display: flex;
            gap: 8px;
            font-size: 11px;
            color: rgba(255,255,255,0.5);
        }
        .igor-labels span:nth-child(1) { flex: 2; min-width: 120px; }
        .igor-labels span:nth-child(2) { flex: 2; min-width: 150px; }
        .igor-labels span:nth-child(3) { width: 80px; }
        .igor-labels span:nth-child(4) { width: 60px; }
        .igor-labels span:nth-child(5) { width: 40px; }
        .igor-select {
            flex: 2;
            min-width: 120px;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
        }
        .igor-select:focus { outline: none; border-color: #3b82f6; }
        .igor-select option { background: #1a1a2e; color: #fff; }
        .igor-input {
            width: 80px;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            text-align: center;
        }
        .igor-input.igor-qty { width: 60px; }
        .igor-input:focus { outline: none; border-color: #3b82f6; }
        .igor-add-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .igor-add-btn:hover { transform: scale(1.05); }
        .igor-preview {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(168,85,247,0.1);
            border: 1px solid rgba(168,85,247,0.3);
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
        }
        .igor-members-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .igor-member-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(59,130,246,0.1);
            border: 1px solid rgba(59,130,246,0.2);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .igor-member-item .weight { color: #a855f7; margin-left: auto; margin-right: 15px; }
        .igor-member-item .remove-btn {
            background: rgba(239,68,68,0.3);
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            color: #ef4444;
            cursor: pointer;
            font-size: 16px;
        }
        .igor-member-item .remove-btn:hover { background: rgba(239,68,68,0.5); }
        .igor-results {
            background: rgba(34,197,94,0.1);
            border: 1px solid rgba(34,197,94,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .igor-breakdown {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .igor-totals { }
        .igor-total-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 16px;
        }
        .igor-total-row.total {
            font-size: 20px;
            font-weight: bold;
            color: #22c55e;
        }
        @media (max-width: 600px) {
            .igor-dropdown-row { flex-direction: column; }
            .igor-select, .igor-input { width: 100%; min-width: unset; }
            .igor-labels { display: none; }
            .igor-add-btn { width: 100%; height: 44px; }
        }

        /* CHUCK Temperature & Cure Styles */
        .chuck-temp-display {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(59,130,246,0.2);
            border: 1px solid rgba(59,130,246,0.3);
            border-radius: 10px;
            padding: 12px 15px;
            margin-bottom: 15px;
        }
        .chuck-temp-display .temp-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #60a5fa;
        }
        .chuck-temp-display .temp-location {
            flex: 1;
            color: rgba(255,255,255,0.7);
            font-size: 13px;
        }
        .chuck-temp-display .temp-refresh {
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 16px;
        }
        .chuck-cure-section {
            background: rgba(245,158,11,0.1);
            border: 1px solid rgba(245,158,11,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .cure-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .cure-card {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        .cure-card.standard { border-left: 3px solid #22c55e; }
        .cure-card.coastal { border-left: 3px solid #3b82f6; }
        .cure-card.shade { border-left: 3px solid #a855f7; }
        .cure-icon { font-size: 1.5rem; margin-bottom: 5px; }
        .cure-label { font-size: 11px; color: rgba(255,255,255,0.6); margin-bottom: 5px; }
        .cure-work { font-size: 12px; color: #f59e0b; }
        .cure-time { font-size: 14px; font-weight: bold; color: #fff; }
        .chuck-cartridge-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .cart-option {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 10px 20px;
            text-align: center;
        }
        .cart-size { display: block; font-size: 12px; color: rgba(255,255,255,0.6); }
        .cart-count { display: block; font-size: 1.2rem; font-weight: bold; color: #22c55e; }

        /* BRITTANY Parameters Styles */
        .brittany-params {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 15px 0;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        .param-group {
            flex: 1;
            min-width: 100px;
        }
        .param-group label {
            display: block;
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 5px;
        }
        .param-group input {
            width: 100%;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
        }
        .param-min {
            display: block;
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            margin-top: 3px;
        }
        .brittany-options {
            margin: 15px 0;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }
        .checkbox-label input { width: 18px; height: 18px; }
        .brittany-load-check {
            background: rgba(168,85,247,0.1);
            border: 1px solid rgba(168,85,247,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .brittany-load-check label {
            color: #a855f7;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .load-input-row {
            display: flex;
            gap: 10px;
        }
        .load-input-row input {
            flex: 1;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
        }
        .load-input-row select {
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
        }
        .load-check-result { margin-top: 15px; }
        .load-bar {
            height: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        .load-fill {
            height: 100%;
            transition: width 0.3s, background 0.3s;
            border-radius: 10px;
        }
        .load-status {
            text-align: center;
            margin-top: 8px;
            font-weight: bold;
        }
        @media (max-width: 600px) {
            .cure-cards { grid-template-columns: 1fr; }
            .brittany-params { flex-direction: column; }
            .load-input-row { flex-direction: column; }
        }

        /* CHUCK Timer Styles */
        .chuck-timer-section {
            background: linear-gradient(135deg, rgba(34,197,94,0.2) 0%, rgba(22,163,74,0.2) 100%);
            border: 2px solid rgba(34,197,94,0.5);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }
        .chuck-timer-section.curing {
            background: linear-gradient(135deg, rgba(245,158,11,0.2) 0%, rgba(217,119,6,0.2) 100%);
            border-color: rgba(245,158,11,0.5);
            animation: pulse-border 2s infinite;
        }
        @keyframes pulse-border {
            0%, 100% { border-color: rgba(245,158,11,0.5); }
            50% { border-color: rgba(245,158,11,1); }
        }
        .chuck-timer-section.ready {
            background: linear-gradient(135deg, rgba(34,197,94,0.3) 0%, rgba(22,163,74,0.3) 100%);
            border-color: #22c55e;
        }
        .timer-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: #22c55e;
            font-family: monospace;
        }
        .timer-display.curing { color: #f59e0b; }
        .timer-label {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 5px;
        }
        .timer-ready-at {
            font-size: 1.2rem;
            color: #60a5fa;
            margin: 10px 0;
        }
        .timer-btn {
            padding: 15px 40px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.2s;
        }
        .timer-btn.start {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }
        .timer-btn.stop {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        .timer-btn:hover { transform: scale(1.05); }
        .timer-progress {
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            margin-top: 15px;
            overflow: hidden;
        }
        .timer-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f59e0b, #22c55e);
            border-radius: 4px;
            transition: width 1s linear;
        }

        /* HOBART Tube Finder Styles */
        .hobart-tube-finder {
            background: rgba(168,85,247,0.1);
            border: 1px solid rgba(168,85,247,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .tube-finder-title {
            color: #a855f7;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .tube-finder-inputs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .tube-finder-inputs .calc-input {
            flex: 1;
            min-width: 100px;
        }
        .tube-finder-results {
            display: none;
        }
        .tube-finder-results.active { display: block; }
        .tube-match {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #22c55e;
        }
        .tube-match.warning { border-left-color: #f59e0b; }
        .tube-match.fail { border-left-color: #ef4444; }
        .tube-match-bolt { font-weight: bold; color: #60a5fa; }
        .tube-match-info { font-size: 12px; color: rgba(255,255,255,0.6); }
        .tube-match-status { font-size: 20px; }

        /* HOBART Grip Visual */
        .grip-visual {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        .grip-diagram {
            position: relative;
            height: 70px;
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 5px;
            margin: 10px 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .grip-range {
            display: none; /* Hide old single range div */
        }
        .grip-marker {
            position: absolute;
            top: -25px;
            transform: translateX(-50%);
            font-size: 11px;
            color: #fff;
        }
        .grip-current {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 80%;
            background: #f59e0b;
            border-radius: 2px;
        }
        .grip-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            margin-top: 5px;
        }

        /* BRITTANY Report Section */
        .brittany-report-section {
            background: rgba(59,130,246,0.1);
            border: 1px solid rgba(59,130,246,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .report-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .report-btn:hover { transform: scale(1.02); }
        .utilisation-display {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }
        .utilisation-big {
            font-size: 3rem;
            font-weight: bold;
        }
        .utilisation-big.ok { color: #22c55e; }
        .utilisation-big.warning { color: #f59e0b; }
        .utilisation-big.fail { color: #ef4444; }
        .utilisation-status {
            font-size: 1.5rem;
            margin-top: 10px;
        }
        .safety-factor {
            font-size: 14px;
            color: rgba(255,255,255,0.6);
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üî© STEEL Command Center</h1>
        <p>AI-Powered Trade Documentation Suite</p>
    </div>

    <!-- Navigation -->
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="showSection('hobart')">üî© HOBART</button>
        <button class="nav-tab" onclick="showSection('igor')">‚öñÔ∏è IGOR</button>
        <button class="nav-tab" onclick="showSection('chuck')">üß™ CHUCK</button>
        <button class="nav-tab" onclick="showSection('brittany')">üí™ BRITTANY</button>
        <button class="nav-tab offline" onclick="showSection('ai-agents')">ü§ñ AI Agents</button>
    </div>

    <!-- HOBART Section -->
    <div id="hobart" class="agent-section active">
        <div class="agent-header">
            <div class="agent-icon">üî©</div>
            <div class="agent-title">
                <h2>HOBART - Hollo-Bolt Reference</h2>
                <p>Lindapter Hollo-Bolt drilling, capacities & grip ranges</p>
            </div>
        </div>

        <!-- Tube Finder - Reverse Lookup -->
        <div class="hobart-tube-finder">
            <div class="tube-finder-title">üîç WHAT FITS THIS TUBE?</div>
            <div class="tube-finder-inputs">
                <div class="calc-input">
                    <label>Wall Thickness (mm)</label>
                    <input type="number" id="tubeWallThickness" placeholder="e.g. 6" min="1" max="50" oninput="hobartFindFits()">
                </div>
                <div class="calc-input">
                    <label>Total Clamp (mm)</label>
                    <input type="number" id="tubeClampTotal" placeholder="e.g. 12" min="1" max="100" oninput="hobartFindFits()">
                </div>
            </div>
            <div class="tube-finder-results" id="tubeFitResults"></div>
        </div>

        <label>Bolt Type</label>
        <div class="btn-group" id="hobartTypeButtons">
            <button class="btn active" onclick="hobartSetType('HB', this)">HB Hex Head</button>
            <button class="btn" onclick="hobartSetType('HBCSK', this)">HBCSK Countersunk</button>
            <button class="btn" onclick="hobartSetType('HBFF', this)">HBFF Flush Fit</button>
            <button class="btn" onclick="hobartSetType('LB', this)">LB2 LindiBolt</button>
        </div>

        <label style="margin-top:15px">Bolt Size</label>
        <div class="btn-group" id="hobartSizeButtons">
            <button class="btn" onclick="hobartSetSize('M8', this)">M8</button>
            <button class="btn" onclick="hobartSetSize('M10', this)">M10</button>
            <button class="btn active" onclick="hobartSetSize('M12', this)">M12</button>
            <button class="btn" onclick="hobartSetSize('M16', this)">M16</button>
            <button class="btn" onclick="hobartSetSize('M20', this)">M20</button>
        </div>

        <div class="result-grid" id="hobartResults"></div>

        <!-- Visual Grip Range -->
        <div class="grip-visual" id="hobartGripVisual">
            <div style="color:#f59e0b;font-weight:bold;margin-bottom:10px">üìè Grip Range Visualization</div>
            <div class="grip-diagram" id="gripDiagram">
                <div class="grip-range" id="gripRange"></div>
                <div class="grip-current" id="gripCurrent" style="display:none"></div>
            </div>
            <div class="grip-labels">
                <span id="gripMinLabel">0mm</span>
                <span id="gripMaxLabel">100mm</span>
            </div>
            <div style="margin-top:10px">
                <label style="font-size:12px">Your clamping thickness:</label>
                <input type="number" id="hobartClampInput" placeholder="mm" style="width:80px;padding:5px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:5px;color:#fff;margin-left:10px" oninput="hobartUpdateGripVisual()">
                <span id="gripStatus" style="margin-left:10px;font-weight:bold"></span>
            </div>
        </div>

        <table class="data-table" id="hobartGripTable">
            <thead>
                <tr><th>Product Code</th><th>Clamping Range (mm)</th></tr>
            </thead>
            <tbody id="hobartGripBody"></tbody>
        </table>

        <div class="console" id="hobartConsole">üî© HOBART Ready - "Lindapter Hollo-Bolt at your service"</div>
    </div>

    <!-- IGOR Section -->
    <div id="igor" class="agent-section">
        <div class="agent-header">
            <div class="agent-icon">‚öñÔ∏è</div>
            <div class="agent-title">
                <h2>IGOR - IBSC Steel Reference</h2>
                <p>Complete IBSC Know Your Steel V11 catalogue - 543 sections across 14 types</p>
            </div>
        </div>

        <!-- Dropdown-based member selector -->
        <div class="igor-dropdown-container">
            <div class="igor-dropdown-row">
                <select id="igorTypeSelect" onchange="igorLoadSections()" class="igor-select">
                    <option value="">Type</option>
                    <option value="SHS">SHS - Square Hollow</option>
                    <option value="RHS">RHS - Rectangular Hollow</option>
                    <option value="CHS">CHS - Circular Hollow</option>
                    <option value="EA">EA - Equal Angle</option>
                    <option value="UA">UA - Unequal Angle</option>
                    <option value="FB">FB - Flat Bar</option>
                    <option value="RB">RB - Round Bar</option>
                    <option value="SB">SB - Square Bar</option>
                    <option value="UB">UB - Universal Beam</option>
                    <option value="WB">WB - Welded Beam</option>
                    <option value="UC">UC - Universal Column</option>
                    <option value="WC">WC - Welded Column</option>
                    <option value="PFC">PFC - Parallel Flange Channel</option>
                    <option value="TFB">TFB - Taper Flange Beam</option>
                </select>
                <select id="igorSectionSelect" onchange="igorUpdatePreview()" class="igor-select">
                    <option value="">Section</option>
                </select>
                <input type="number" id="igorLengthInput" class="igor-input" placeholder="Length (m)" min="0.1" step="0.1" value="1" onchange="igorUpdatePreview()" oninput="igorUpdatePreview()">
                <input type="number" id="igorQtyInput" class="igor-input igor-qty" placeholder="Qty" min="1" value="1" onchange="igorUpdatePreview()" oninput="igorUpdatePreview()">
                <button class="igor-add-btn" onclick="igorAddMember()" title="Add member">+</button>
            </div>
            <div class="igor-labels">
                <span>Type</span>
                <span>Section</span>
                <span>Length (m)</span>
                <span>Qty</span>
                <span></span>
            </div>
            <div class="igor-preview" id="igorPreview" style="display: none;">
                <span id="igorPreviewMember">-</span>
                <span id="igorPreviewWeight" style="color:#a855f7;">0 kg</span>
            </div>
        </div>

        <!-- Added members list -->
        <div class="igor-members-list" id="igorMembersList"></div>

        <!-- Results -->
        <div class="igor-results" id="igorResultsSection" style="display:none">
            <div class="igor-breakdown" id="igorBreakdown"></div>
            <div class="igor-totals">
                <div class="igor-total-row">
                    <span>Steel Weight:</span>
                    <span id="igorSteelWeight">0 kg</span>
                </div>
                <div class="igor-total-row total">
                    <span>+ 10% Fittings:</span>
                    <span id="igorTotalWeight">0 kg</span>
                </div>
            </div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:15px;">
            <button class="btn primary" onclick="igorCalculateTotal()" style="flex:1; min-width:150px;">
                ‚öñÔ∏è Calculate Weight
            </button>
            <button class="btn" onclick="igorDownloadExcel()" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); flex:1; min-width:150px;">
                üì• Download Excel
            </button>
        </div>

        <div class="console" id="igorConsole">‚öñÔ∏è IGOR Ready - "I know the weight of every steel section"</div>
    </div>

    <!-- CHUCK Section -->
    <div id="chuck" class="agent-section">
        <div class="agent-header">
            <div class="agent-icon">üß™</div>
            <div class="agent-title">
                <h2>CHUCK - Hilti Calculator</h2>
                <p>Chemical anchor usage calculator with cure times</p>
            </div>
        </div>

        <!-- Temperature Display -->
        <div class="chuck-temp-display" id="chuckTempDisplay">
            <div class="temp-value"><span id="chuckCurrentTemp">--</span>¬∞C</div>
            <div class="temp-location" id="chuckLocation">üìç Getting location...</div>
            <button class="temp-refresh" onclick="chuckGetWeather()">üîÑ</button>
        </div>

        <label>Chemical Type</label>
        <div class="btn-group" id="chuckTypeButtons">
            <button class="btn active" onclick="chuckSetType('HY200R', this)">HY 200-R</button>
            <button class="btn" onclick="chuckSetType('HY200A', this)">HY 200-A</button>
            <button class="btn" onclick="chuckSetType('RE500', this)">RE 500</button>
            <button class="btn" onclick="chuckSetType('HY170', this)">HY 170</button>
        </div>

        <label style="margin-top:15px">Rod Size</label>
        <div class="btn-group" id="chuckSizeButtons">
            <button class="btn" onclick="chuckSetSize('M10', this)">M10</button>
            <button class="btn" onclick="chuckSetSize('M12', this)">M12</button>
            <button class="btn active" onclick="chuckSetSize('M16', this)">M16</button>
            <button class="btn" onclick="chuckSetSize('M20', this)">M20</button>
            <button class="btn" onclick="chuckSetSize('M24', this)">M24</button>
            <button class="btn" onclick="chuckSetSize('M30', this)">M30</button>
        </div>

        <div class="calc-row">
            <div class="calc-input">
                <label>Embed Depth (mm)</label>
                <input type="number" id="chuckDepth" value="125" oninput="chuckCalculate()">
            </div>
            <div class="calc-input">
                <label>Quantity</label>
                <input type="number" id="chuckQty" value="10" min="1" oninput="chuckCalculate()">
            </div>
        </div>

        <div class="result-grid" id="chuckResults"></div>

        <!-- Cure Times Section -->
        <div class="chuck-cure-section" id="chuckCureSection" style="display:none">
            <h4 style="color:#f59e0b;margin-bottom:10px">‚è±Ô∏è Cure Times @ <span id="chuckCureTemp">--</span>¬∞C</h4>
            <div class="cure-cards">
                <div class="cure-card standard">
                    <div class="cure-icon">üèóÔ∏è</div>
                    <div class="cure-label">Standard</div>
                    <div class="cure-work" id="cureWorkStd">-</div>
                    <div class="cure-time" id="cureCureStd">-</div>
                </div>
                <div class="cure-card coastal">
                    <div class="cure-icon">üåä</div>
                    <div class="cure-label">Coastal/Humid</div>
                    <div class="cure-work" id="cureWorkCoast">-</div>
                    <div class="cure-time" id="cureCureCoast">-</div>
                </div>
                <div class="cure-card shade">
                    <div class="cure-icon">üå•Ô∏è</div>
                    <div class="cure-label">Shade/Cold</div>
                    <div class="cure-work" id="cureWorkShade">-</div>
                    <div class="cure-time" id="cureCureShade">-</div>
                </div>
            </div>
        </div>

        <!-- Cartridge Options -->
        <div class="chuck-cartridge-options" id="chuckCartOptions" style="display:none">
            <div class="cart-option"><span class="cart-size">330ml</span><span class="cart-count" id="chuckCart330">-</span></div>
            <div class="cart-option"><span class="cart-size">500ml</span><span class="cart-count" id="chuckCart500">-</span></div>
            <div class="cart-option"><span class="cart-size">1400ml</span><span class="cart-count" id="chuckCart1400">-</span></div>
        </div>

        <!-- Cure Timer Section -->
        <div class="chuck-timer-section" id="chuckTimerSection">
            <div class="timer-label">‚è±Ô∏è CURE TIMER</div>
            <div class="timer-display" id="chuckTimerDisplay">--:--:--</div>
            <div class="timer-ready-at" id="chuckReadyAt">Set anchors and start timer</div>
            <div>
                <button class="timer-btn start" id="chuckTimerStart" onclick="chuckStartTimer()">‚ñ∂Ô∏è START TIMER</button>
                <button class="timer-btn stop" id="chuckTimerStop" onclick="chuckStopTimer()" style="display:none">‚èπÔ∏è STOP</button>
            </div>
            <div class="timer-progress" id="chuckTimerProgress" style="display:none">
                <div class="timer-progress-fill" id="chuckTimerFill"></div>
            </div>
        </div>

        <div class="console" id="chuckConsole">üß™ CHUCK Ready - "Hilti chemical calculations at your service"</div>
    </div>

    <!-- BRITTANY Section -->
    <div id="brittany" class="agent-section">
        <div class="agent-header">
            <div class="agent-icon">üí™</div>
            <div class="agent-title">
                <h2>BRITTANY - Fixing Capacity</h2>
                <p>Will it hold? How many kg?</p>
            </div>
        </div>

        <label>Fixing Type</label>
        <div class="btn-group" id="brittanyTypeButtons">
            <button class="btn active" onclick="brittanySetType('dynabolt', this)">Dynabolt</button>
            <button class="btn" onclick="brittanySetType('trubolt', this)">TruBolt</button>
            <button class="btn" onclick="brittanySetType('hilti_hsl', this)">Hilti HSL</button>
            <button class="btn" onclick="brittanySetType('chemset', this)">Chemset</button>
            <button class="btn" onclick="brittanySetType('dropin', this)">Drop-In</button>
        </div>

        <label style="margin-top:15px">Size</label>
        <div class="btn-group" id="brittanySizeButtons">
            <button class="btn" onclick="brittanySetSize('M8', this)">M8</button>
            <button class="btn" onclick="brittanySetSize('M10', this)">M10</button>
            <button class="btn active" onclick="brittanySetSize('M12', this)">M12</button>
            <button class="btn" onclick="brittanySetSize('M16', this)">M16</button>
            <button class="btn" onclick="brittanySetSize('M20', this)">M20</button>
            <button class="btn" onclick="brittanySetSize('M24', this)">M24</button>
        </div>

        <div class="calc-row">
            <div class="calc-input">
                <label>Quantity</label>
                <input type="number" id="brittanyQty" value="4" min="1" oninput="brittanyCalculate()">
            </div>
            <div class="calc-input">
                <label>Substrate</label>
                <select id="brittanyConcrete" onchange="brittanyCalculate()">
                    <optgroup label="Concrete">
                        <option value="20">Concrete 20 MPa</option>
                        <option value="25">Concrete 25 MPa</option>
                        <option value="32" selected>Concrete 32 MPa</option>
                        <option value="40">Concrete 40 MPa</option>
                        <option value="50">Concrete 50 MPa</option>
                    </optgroup>
                    <optgroup label="Masonry">
                        <option value="15">Solid Brick (‚âà15 MPa)</option>
                        <option value="7">Clay Brick (‚âà7 MPa)</option>
                        <option value="10">Concrete Block Solid (‚âà10 MPa)</option>
                        <option value="4">Concrete Block Hollow (‚âà4 MPa)</option>
                        <option value="3">AAC/Hebel Block (‚âà3 MPa)</option>
                    </optgroup>
                    <optgroup label="Natural Stone">
                        <option value="60">Granite (‚âà60 MPa)</option>
                        <option value="35">Sandstone (‚âà35 MPa)</option>
                        <option value="25">Limestone (‚âà25 MPa)</option>
                        <option value="50">Bluestone (‚âà50 MPa)</option>
                    </optgroup>
                </select>
            </div>
        </div>

        <!-- Adjustable Parameters -->
        <div class="brittany-params">
            <div class="param-group">
                <label>Embed (mm)</label>
                <input type="number" id="brittanyEmbed" placeholder="auto" onchange="brittanyCalculate()">
                <span class="param-min" id="brittanyEmbedMin">min: -</span>
            </div>
            <div class="param-group">
                <label>Edge (mm)</label>
                <input type="number" id="brittanyEdge" placeholder="auto" onchange="brittanyCalculate()">
                <span class="param-min" id="brittanyEdgeMin">min: -</span>
            </div>
            <div class="param-group">
                <label>Spacing (mm)</label>
                <input type="number" id="brittanySpacing" placeholder="auto" onchange="brittanyCalculate()">
                <span class="param-min" id="brittanySpacingMin">min: -</span>
            </div>
        </div>

        <!-- Options -->
        <div class="brittany-options">
            <label class="checkbox-label">
                <input type="checkbox" id="brittanyOverhead" onchange="brittanyCalculate()">
                <span>Overhead / Cracked Concrete (50% reduction)</span>
            </label>
        </div>

        <div class="result-grid" id="brittanyResults"></div>

        <!-- Load Check -->
        <div class="brittany-load-check">
            <label>Check Load (kg)</label>
            <div class="load-input-row">
                <input type="number" id="brittanyLoad" placeholder="e.g. 500" oninput="brittanyCheckLoad()">
                <select id="brittanyLoadType" onchange="brittanyCheckLoad()">
                    <option value="tension">Tension ‚Üì</option>
                    <option value="shear">Shear ‚Üí</option>
                </select>
            </div>
            <div class="load-check-result" id="brittanyLoadResult" style="display:none">
                <div class="load-bar"><div class="load-fill" id="brittanyLoadFill"></div></div>
                <div class="load-status" id="brittanyLoadStatus"></div>
            </div>
        </div>

        <!-- Quick Utilisation Display -->
        <div class="utilisation-display" id="brittanyUtilDisplay" style="display:none">
            <div class="timer-label">WILL IT HOLD?</div>
            <div class="utilisation-big" id="brittanyUtilPercent">--%</div>
            <div class="utilisation-status" id="brittanyUtilStatus">Enter a load to check</div>
            <div class="safety-factor" id="brittanySafetyFactor"></div>
        </div>

        <!-- Report Generator -->
        <div class="brittany-report-section">
            <button class="report-btn" onclick="brittanyGenerateReport()">
                üìÑ GENERATE ENGINEER REPORT
            </button>
        </div>

        <div class="console" id="brittanyConsole">üí™ BRITTANY Ready - "I'll tell you if it'll hold"</div>
    </div>

    <!-- AI Agents Section -->
    <div id="ai-agents" class="agent-section">
        <div class="agent-header">
            <div class="agent-icon">ü§ñ</div>
            <div class="agent-title">
                <h2>AI-Powered Agents</h2>
                <p>These agents require API connection</p>
            </div>
        </div>

        <div class="api-notice">
            <h3>‚ö° API Connection Required</h3>
            <p>The following agents use Claude AI and require the STEEL server running locally:</p>
        </div>

        <div class="result-grid" style="margin-top:20px">
            <div class="result-card"><div class="label">FRANK</div><div class="value" style="font-size:1rem">SWMS Generator</div></div>
            <div class="result-card"><div class="label">GRETA</div><div class="value" style="font-size:1rem">Plan Intelligence</div></div>
            <div class="result-card"><div class="label">VICTOR</div><div class="value" style="font-size:1rem">MSDS Finder</div></div>
            <div class="result-card"><div class="label">DORIS</div><div class="value" style="font-size:1rem">Document Organizer</div></div>
            <div class="result-card"><div class="label">QUINCY</div><div class="value" style="font-size:1rem">Quality Memory</div></div>
            <div class="result-card"><div class="label">UGO</div><div class="value" style="font-size:1rem">System Overseer</div></div>
            <div class="result-card"><div class="label">SIMON</div><div class="value" style="font-size:1rem">Quote Analyzer</div></div>
            <div class="result-card"><div class="label">PAMELA</div><div class="value" style="font-size:1rem">Warranty Generator</div></div>
            <div class="result-card"><div class="label">JERRY</div><div class="value" style="font-size:1rem">Workshop Creator</div></div>
            <div class="result-card"><div class="label">HANNA</div><div class="value" style="font-size:1rem">Receipt Tracker</div></div>
        </div>

        <div class="console">ü§ñ To use AI agents, run: python steel/api.py</div>
    </div>

    <!-- Status Badge -->
    <div class="status-badge offline" id="statusBadge">
        <div class="status-dot"></div>
        <span>Standalone Mode</span>
    </div>

    <script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // EMBEDDED DATA - HOBART
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const HOLLO_BOLT_DATA={DRILLING_DATA:{M8:{clearance_hole:14,tolerance:"+1.0/-0.2",min_hole_distance:35,min_edge_distance:13},M10:{clearance_hole:18,tolerance:"+1.0/-0.2",min_hole_distance:40,min_edge_distance:15},M12:{clearance_hole:20,tolerance:"+1.0/-0.2",min_hole_distance:50,min_edge_distance:18},M16:{clearance_hole:26,tolerance:"+2.0/-0.2",min_hole_distance:55,min_edge_distance:20,min_outer_ply:8},M20:{clearance_hole:33,tolerance:"+2.0/-0.2",min_hole_distance:70,min_edge_distance:25,min_outer_ply:8}},HEXAGONAL_HEAD:{M8:{product_codes_with_sizes:["HB08-1 (L=45mm, clamp 3-22mm)","HB08-2 (L=65mm, clamp 22-41mm)","HB08-3 (L=85mm, clamp 41-60mm)"],clamping_ranges:["3-22","22-41","41-60"],torque_nm:23,spanner_mm:19,tensile_swl_kn:4.0,shear_swl_kn:5.0},M10:{product_codes_with_sizes:["HB10-1 (L=49mm, clamp 3-22mm)","HB10-2 (L=64mm, clamp 22-41mm)","HB10-3 (L=84mm, clamp 41-60mm)"],clamping_ranges:["3-22","22-41","41-60"],torque_nm:45,spanner_mm:24,tensile_swl_kn:8.5,shear_swl_kn:10.0},M12:{product_codes_with_sizes:["HB12-1 (L=53mm, clamp 3-25mm)","HB12-2 (L=73mm, clamp 25-47mm)","HB12-3 (L=93mm, clamp 47-69mm)"],clamping_ranges:["3-25","25-47","47-69"],torque_nm:80,spanner_mm:30,tensile_swl_kn:10.5,shear_swl_kn:15.0},M16:{product_codes_with_sizes:["HB16-1 (L=67mm, clamp 12-29mm)","HB16-2 (L=92mm, clamp 29-50mm)","HB16-3 (L=112mm, clamp 50-71mm)"],clamping_ranges:["12-29","29-50","50-71"],torque_nm:190,spanner_mm:36,tensile_swl_kn:21.0,shear_swl_kn:30.0},M20:{product_codes_with_sizes:["HB20-1 (L=80mm, clamp 12-34mm)","HB20-2 (L=110mm, clamp 34-60mm)","HB20-3 (L=140mm, clamp 60-86mm)"],clamping_ranges:["12-34","34-60","60-86"],torque_nm:300,spanner_mm:46,tensile_swl_kn:35.0,shear_swl_kn:40.0}},COUNTERSUNK_HEAD:{M8:{product_codes_with_sizes:["HBCSK08-1 (L=45mm, clamp 3-22mm)","HBCSK08-2 (L=65mm, clamp 22-41mm)","HBCSK08-3 (L=85mm, clamp 41-60mm)"],clamping_ranges:["3-22","22-41","41-60"],torque_nm:23,spanner_mm:19,tensile_swl_kn:4.0,shear_swl_kn:5.0},M10:{product_codes_with_sizes:["HBCSK10-1 (L=44mm, clamp 3-22mm)","HBCSK10-2 (L=64mm, clamp 22-41mm)","HBCSK10-3 (L=84mm, clamp 41-60mm)"],clamping_ranges:["3-22","22-41","41-60"],torque_nm:45,spanner_mm:24,tensile_swl_kn:8.5,shear_swl_kn:10.0},M12:{product_codes_with_sizes:["HBCSK12-1 (L=48mm, clamp 3-25mm)","HBCSK12-2 (L=73mm, clamp 25-47mm)","HBCSK12-3 (L=93mm, clamp 47-69mm)"],clamping_ranges:["3-25","25-47","47-69"],torque_nm:80,spanner_mm:30,tensile_swl_kn:10.5,shear_swl_kn:15.0},M16:{product_codes_with_sizes:["HBCSK16-1 (L=62mm, clamp 12-29mm)","HBCSK16-2 (L=92mm, clamp 29-50mm)","HBCSK16-3 (L=112mm, clamp 50-71mm)"],clamping_ranges:["12-29","29-50","50-71"],torque_nm:190,spanner_mm:36,tensile_swl_kn:21.0,shear_swl_kn:30.0}},FLUSH_FIT_HEAD:{M8:{product_codes_with_sizes:["HBFF08-1 (L=50mm, clamp 10-27mm)","HBFF08-2 (L=70mm, clamp 27-45mm)","HBFF08-3 (L=90mm, clamp 45-64mm)"],clamping_ranges:["10-27","27-45","45-64"],torque_nm:23,spanner_mm:19,tensile_swl_kn:4.0,shear_swl_kn:5.0},M10:{product_codes_with_sizes:["HBFF10-1 (L=50mm, clamp 12-27mm)","HBFF10-2 (L=70mm, clamp 27-45mm)","HBFF10-3 (L=90mm, clamp 45-64mm)"],clamping_ranges:["12-27","27-45","45-64"],torque_nm:45,spanner_mm:24,tensile_swl_kn:8.5,shear_swl_kn:10.0},M12:{product_codes_with_sizes:["HBFF12-1 (L=55mm, clamp 12-30mm)","HBFF12-2 (L=80mm, clamp 30-52mm)","HBFF12-3 (L=100mm, clamp 52-74mm)"],clamping_ranges:["12-30","30-52","52-74"],torque_nm:80,spanner_mm:30,tensile_swl_kn:10.5,shear_swl_kn:15.0}},LINDIBOLT:{M10:{product_codes_with_sizes:["LB10 (L=74mm, clamp 7-30mm)"],clamping_ranges:["7-30"],torque_nm:20,spanner_mm:17,tensile_swl_kn:3.0,shear_swl_kn:3.4},M12:{product_codes_with_sizes:["LB12 (L=85mm, clamp 10-36mm)"],clamping_ranges:["10-36"],torque_nm:31,spanner_mm:19,tensile_swl_kn:5.0,shear_swl_kn:5.0},M16:{product_codes_with_sizes:["LB16 (L=105mm, clamp 12-48mm)"],clamping_ranges:["12-48"],torque_nm:81,spanner_mm:24,tensile_swl_kn:8.0,shear_swl_kn:9.8},M20:{product_codes_with_sizes:["LB20 (L=128mm, clamp 14-60mm)"],clamping_ranges:["14-60"],torque_nm:129,spanner_mm:30,tensile_swl_kn:14.0,shear_swl_kn:15.2},M24:{product_codes_with_sizes:["LB24 (L=158mm, clamp 18-72mm)"],clamping_ranges:["18-72"],torque_nm:203,spanner_mm:36,tensile_swl_kn:20.0,shear_swl_kn:22.5}}};

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // EMBEDDED DATA - IGOR (Steel Sections)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const STEEL_SECTIONS = {
        SHS: {desc:"Square Hollow Sections",data:{"25x25x1.6":1.12,"25x25x2.0":1.36,"25x25x2.5":1.64,"25x25x3.0":1.89,"30x30x1.6":1.38,"30x30x2.0":1.68,"30x30x2.5":2.03,"30x30x3.0":2.36,"35x35x1.6":1.63,"35x35x2.0":1.99,"35x35x2.5":2.42,"35x35x3.0":2.83,"40x40x1.6":1.88,"40x40x2.0":2.31,"40x40x2.5":2.82,"40x40x3.0":3.30,"40x40x4.0":4.09,"50x50x1.6":2.38,"50x50x2.0":2.93,"50x50x2.5":3.60,"50x50x3.0":4.25,"50x50x4.0":5.35,"50x50x5.0":6.39,"50x50x6.0":7.32,"65x65x2.0":3.88,"65x65x2.5":4.78,"65x65x3.0":5.66,"65x65x4.0":7.23,"65x65x5.0":8.75,"65x65x6.0":10.1,"75x75x2.0":4.50,"75x75x2.5":5.56,"75x75x3.0":6.60,"75x75x4.0":8.49,"75x75x5.0":10.3,"75x75x6.0":12.0,"89x89x3.5":9.07,"89x89x5.0":12.5,"89x89x6.0":14.7,"100x100x2.0":6.07,"100x100x2.5":7.53,"100x100x3.0":8.96,"100x100x4.0":11.6,"100x100x5.0":14.2,"100x100x6.0":16.7,"100x100x8.0":21.4,"100x100x9.0":23.5,"100x100x10.0":25.6,"125x125x4.0":14.8,"125x125x5.0":18.2,"125x125x6.0":21.4,"125x125x8.0":27.7,"150x150x5.0":22.1,"150x150x6.0":26.2,"150x150x8.0":33.9,"150x150x10.0":41.3,"200x200x5.0":29.9,"200x200x6.0":35.6,"200x200x8.0":46.5,"200x200x10.0":57.0}},
        RHS: {desc:"Rectangular Hollow Sections",data:{"50x25x1.6":1.75,"50x25x2.0":2.15,"50x25x2.5":2.62,"50x25x3.0":3.07,"65x35x2.0":2.93,"65x35x2.5":3.60,"65x35x3.0":4.25,"75x50x2.0":3.72,"75x50x2.5":4.58,"75x50x3.0":5.42,"75x50x4.0":6.92,"100x50x2.0":4.50,"100x50x2.5":5.56,"100x50x3.0":6.60,"100x50x4.0":8.49,"100x50x5.0":10.3,"100x50x6.0":12.0,"125x75x3.0":8.96,"125x75x4.0":11.6,"125x75x5.0":14.2,"125x75x6.0":16.7,"150x50x3.0":8.96,"150x50x4.0":11.6,"150x50x5.0":14.2,"150x100x4.0":14.8,"150x100x5.0":18.2,"150x100x6.0":21.4,"200x100x4.0":17.9,"200x100x5.0":22.1,"200x100x6.0":26.2,"250x150x6.0":35.6,"250x150x8.0":46.5}},
        CHS: {desc:"Circular Hollow Sections",data:{"21.3x2.0":0.952,"26.9x2.0":1.23,"26.9x2.6":1.56,"33.7x2.6":1.99,"33.7x3.2":2.41,"42.4x2.6":2.55,"42.4x3.2":3.10,"48.3x3.2":3.56,"48.3x4.0":4.37,"60.3x3.6":5.03,"60.3x4.5":6.19,"76.1x3.6":6.44,"76.1x4.5":7.95,"88.9x4.0":8.38,"88.9x4.8":9.97,"101.6x4.0":9.63,"101.6x4.8":11.5,"114.3x4.5":12.2,"114.3x5.4":14.5,"139.7x5.0":16.6,"139.7x6.3":20.7,"165.1x5.0":19.7,"165.1x6.3":24.7,"219.1x6.4":33.6,"219.1x8.2":42.6,"273.1x6.4":42.1,"323.9x6.4":50.1}},
        EA: {desc:"Equal Angles",data:{"25x25x3":1.12,"25x25x5":1.65,"30x30x3":1.35,"30x30x5":2.01,"40x40x3":1.83,"40x40x5":2.73,"40x40x6":3.50,"50x50x3":2.31,"50x50x5":3.48,"50x50x6":4.46,"65x65x5":4.56,"65x65x6":5.87,"65x65x8":7.51,"75x75x5":5.27,"75x75x6":6.81,"75x75x8":8.73,"90x90x6":8.22,"90x90x8":10.6,"100x100x6":9.16,"100x100x8":11.8,"100x100x10":14.2}},
        UA: {desc:"Unequal Angles",data:{"65x50x5":4.02,"65x50x6":5.16,"75x50x5":4.40,"75x50x6":5.66,"100x75x6":7.98,"100x75x8":10.3,"125x75x6":9.16,"125x75x8":11.8,"150x90x8":14.3,"150x90x10":17.3,"150x100x10":18.0}},
        FB: {desc:"Flat Bars",data:{"25x3":0.60,"25x5":1.00,"25x6":1.21,"32x5":1.29,"32x6":1.55,"40x5":1.61,"40x6":1.93,"40x8":2.57,"50x5":2.01,"50x6":2.42,"50x8":3.22,"50x10":4.03,"65x6":3.14,"65x8":4.18,"65x10":5.23,"75x6":3.62,"75x8":4.83,"75x10":6.04,"100x6":4.83,"100x8":6.44,"100x10":8.05,"100x12":9.66}},
        RB: {desc:"Round Bars",data:{"10":0.64,"12":0.91,"14":1.24,"16":1.62,"18":2.05,"20":2.53,"22":3.05,"24":3.64,"27":4.61,"30":5.69,"33":6.88,"36":8.19,"40":10.1,"45":12.8,"50":15.8}},
        SB: {desc:"Square Bars",data:{"10x10":0.81,"12x12":1.16,"16x16":2.06,"20x20":3.22,"25x25":5.03,"32x32":8.24,"40x40":12.9}},
        UB: {desc:"Universal Beams",data:{"150UB14":14.0,"150UB18":18.0,"180UB16":16.1,"180UB18":18.1,"180UB22":22.2,"200UB18":18.2,"200UB22":22.3,"200UB25":25.4,"200UB30":29.8,"250UB26":25.7,"250UB31":31.4,"250UB37":37.3,"310UB32":32.0,"310UB40":40.4,"310UB46":46.2,"360UB45":44.7,"360UB51":50.7,"360UB57":56.7,"410UB54":53.7,"410UB60":59.7,"460UB67":67.1,"460UB75":74.6,"460UB82":82.1,"530UB82":82.0,"530UB92":92.4,"610UB101":101,"610UB113":113,"610UB125":125}},
        WB: {desc:"Welded Beams",data:{"700WB115":115,"700WB130":130,"700WB150":150,"700WB173":173,"800WB122":122,"800WB146":146,"800WB168":168,"800WB192":192,"900WB175":175,"900WB218":218,"900WB257":257,"1000WB215":215,"1000WB258":258,"1000WB296":296,"1200WB249":249,"1200WB278":278,"1200WB317":317}},
        UC: {desc:"Universal Columns",data:{"100UC15":14.8,"150UC23":23.4,"150UC30":30.0,"150UC37":37.2,"200UC46":46.2,"200UC52":52.2,"200UC60":59.5,"250UC73":72.9,"250UC90":89.5,"310UC97":96.8,"310UC118":118,"310UC137":137,"310UC158":158}},
        WC: {desc:"Welded Columns",data:{"350WC197":197,"350WC230":230,"350WC258":258,"350WC280":280,"400WC144":144,"400WC181":181,"400WC212":212,"400WC270":270,"400WC303":303,"500WC228":228,"500WC267":267,"500WC290":290,"500WC340":340,"500WC383":383}},
        PFC: {desc:"Parallel Flange Channels",data:{"75x40":5.92,"100x50":8.33,"125x65":11.9,"150x75":17.7,"180x75":20.9,"200x75":22.9,"230x75":25.1,"250x90":35.5,"300x90":40.1,"380x100":55.2}},
        TFB: {desc:"Taper Flange Beams",data:{"100x45":7.20,"125x65":13.1}}
    };

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // EMBEDDED DATA - CHUCK (Hilti Chemicals)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const HILTI_DATA = {
        HY200R: {name:"HIT-HY 200-R",volume_ml:330,sizes:{M10:{hole:12,embed:80},M12:{hole:14,embed:96},M16:{hole:18,embed:125},M20:{hole:22,embed:160},M24:{hole:26,embed:192},M30:{hole:35,embed:240}}},
        HY200A: {name:"HIT-HY 200-A",volume_ml:330,sizes:{M10:{hole:12,embed:80},M12:{hole:14,embed:96},M16:{hole:18,embed:125},M20:{hole:22,embed:160},M24:{hole:26,embed:192},M30:{hole:35,embed:240}}},
        RE500: {name:"HIT-RE 500",volume_ml:500,sizes:{M10:{hole:12,embed:90},M12:{hole:14,embed:110},M16:{hole:18,embed:125},M20:{hole:24,embed:170},M24:{hole:28,embed:210},M30:{hole:35,embed:270}}},
        HY170: {name:"HIT-HY 170",volume_ml:330,sizes:{M8:{hole:10,embed:60},M10:{hole:12,embed:75},M12:{hole:14,embed:90},M16:{hole:18,embed:115},M20:{hole:22,embed:145}}}
    };

    // Cure time data based on temperature (minutes)
    const CURE_TIME_DATA = {
        'HY200R': [
            {min: -10, max: -5, work: 180, cure: 1200},
            {min: -4, max: 0, work: 120, cure: 420},
            {min: 1, max: 5, work: 60, cure: 180},
            {min: 6, max: 10, work: 40, cure: 120},
            {min: 11, max: 20, work: 15, cure: 60},
            {min: 21, max: 30, work: 9, cure: 60},
            {min: 31, max: 40, work: 6, cure: 60},
        ],
        'HY200A': [
            {min: -10, max: -5, work: 90, cure: 420},
            {min: -4, max: 0, work: 50, cure: 240},
            {min: 1, max: 5, work: 25, cure: 120},
            {min: 6, max: 10, work: 15, cure: 60},
            {min: 11, max: 20, work: 7, cure: 30},
            {min: 21, max: 30, work: 4, cure: 30},
            {min: 31, max: 40, work: 3, cure: 30},
        ],
        'RE500': [
            // RE 500 V3 EPOXY - VERY LONG cure times! (per Hilti ETA-16/0143)
            {min: -5, max: -1, work: 120, cure: 10080},  // 7 days at -5 to -1¬∞C
            {min: 0, max: 4, work: 120, cure: 2880},     // 48h at 0-4¬∞C
            {min: 5, max: 9, work: 120, cure: 1440},     // 24h at 5-9¬∞C
            {min: 10, max: 14, work: 90, cure: 960},     // 16h at 10-14¬∞C
            {min: 15, max: 19, work: 60, cure: 720},     // 12h at 15-19¬∞C
            {min: 20, max: 24, work: 30, cure: 420},     // 7h at 20-24¬∞C
            {min: 25, max: 29, work: 20, cure: 360},     // 6h at 25-29¬∞C
            {min: 30, max: 34, work: 15, cure: 300},     // 5h at 30-34¬∞C
            {min: 35, max: 40, work: 10, cure: 270},     // 4.5h at 35-40¬∞C
        ],
        'HY170': [
            // HY 170 HYBRID - Fast cure times (per Hilti IFU)
            {min: -5, max: 0, work: 10, cure: 720},      // 12h at -5 to 0¬∞C
            {min: 1, max: 5, work: 10, cure: 360},       // 6h at 1-5¬∞C (interpolated)
            {min: 6, max: 10, work: 8, cure: 150},       // 2.5h at 6-10¬∞C
            {min: 11, max: 20, work: 5, cure: 90},       // 1.5h at 11-20¬∞C
            {min: 21, max: 30, work: 4, cure: 60},       // 1h at 21-30¬∞C
            {min: 31, max: 40, work: 3, cure: 45},       // 45min at 31-40¬∞C
        ]
    };

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // EMBEDDED DATA - BRITTANY (Fixing Capacities)
    // Format: [tensionKn, shearKn, minEmbed, minEdge, minSpacing, holeSize]
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const FIXING_DATA = {
        dynabolt: {
            name: 'Dynabolt Plus',
            sizes: {
                M8: [4.2, 4.0, 35, 60, 105, 10],
                M10: [5.9, 6.4, 45, 70, 135, 12],
                M12: [7.7, 7.9, 50, 75, 150, 16],
                M16: [11.9, 10.5, 65, 100, 195, 20],
                M20: [16.6, 15.6, 85, 130, 255, 24],
            }
        },
        trubolt: {
            name: 'TruBolt Stud',
            sizes: {
                M8: [5.4, 4.8, 30, 55, 80, 8],
                M10: [8.5, 8.1, 40, 60, 120, 10],
                M12: [11.2, 10.5, 48, 75, 150, 12],
                M16: [17.2, 15.2, 64, 100, 200, 16],
                M20: [24.0, 21.3, 80, 120, 240, 20],
            }
        },
        hilti_hsl: {
            name: 'Hilti HSL-3',
            sizes: {
                M8: [5.7, 7.9, 50, 48, 100, 12],
                M10: [8.5, 12.5, 60, 60, 120, 15],
                M12: [11.9, 19.4, 70, 72, 140, 18],
                M16: [18.8, 31.1, 90, 96, 192, 24],
                M20: [24.4, 47.9, 110, 120, 240, 28],
                M24: [28.6, 44.8, 130, 144, 288, 32],
            }
        },
        chemset: {
            name: 'ChemSet',
            sizes: {
                M10: [12.0, 11.0, 100, 60, 100, 12],
                M12: [17.0, 15.5, 120, 72, 120, 14],
                M16: [28.0, 26.0, 160, 96, 160, 18],
                M20: [42.0, 38.0, 200, 120, 200, 24],
                M24: [55.0, 50.0, 240, 144, 240, 28],
            }
        },
        dropin: {
            name: 'Drop-In Anchor',
            sizes: {
                M8: [4.0, 5.0, 30, 45, 60, 10],
                M10: [6.0, 7.5, 40, 55, 80, 13],
                M12: [8.5, 10.0, 50, 65, 100, 16],
                M16: [12.0, 15.0, 65, 85, 130, 20],
            }
        }
    };

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // NAVIGATION
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function showSection(id) {
        document.querySelectorAll('.agent-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // HOBART FUNCTIONS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let hobartType = 'HB', hobartSize = 'M12';

    function hobartSetType(type, btn) {
        hobartType = type;
        document.querySelectorAll('#hobartTypeButtons .btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        hobartUpdateSizes();
        hobartUpdate();
    }

    function hobartSetSize(size, btn) {
        hobartSize = size;
        document.querySelectorAll('#hobartSizeButtons .btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        hobartUpdate();
    }

    function hobartUpdateSizes() {
        const container = document.getElementById('hobartSizeButtons');
        let sizes = ['M8','M10','M12','M16','M20'];
        if (hobartType === 'HBFF') sizes = ['M8','M10','M12'];
        else if (hobartType === 'HBCSK') sizes = ['M8','M10','M12','M16'];
        else if (hobartType === 'LB') sizes = ['M10','M12','M16','M20','M24'];

        container.innerHTML = sizes.map(s =>
            `<button class="btn${s === hobartSize ? ' active' : ''}" onclick="hobartSetSize('${s}', this)">${s}</button>`
        ).join('');

        if (!sizes.includes(hobartSize)) {
            hobartSize = sizes[0];
            container.querySelector('.btn').classList.add('active');
        }
    }

    function hobartUpdate() {
        let dataSource;
        if (hobartType === 'HB') dataSource = HOLLO_BOLT_DATA.HEXAGONAL_HEAD;
        else if (hobartType === 'HBCSK') dataSource = HOLLO_BOLT_DATA.COUNTERSUNK_HEAD;
        else if (hobartType === 'HBFF') dataSource = HOLLO_BOLT_DATA.FLUSH_FIT_HEAD;
        else dataSource = HOLLO_BOLT_DATA.LINDIBOLT;

        const data = dataSource[hobartSize];
        const drill = HOLLO_BOLT_DATA.DRILLING_DATA[hobartSize] || {};

        if (!data) {
            document.getElementById('hobartResults').innerHTML = '<div class="result-card"><div class="value">Not Available</div></div>';
            return;
        }

        const tensionKg = Math.round(data.tensile_swl_kn * 102);
        const shearKg = Math.round(data.shear_swl_kn * 102);

        document.getElementById('hobartResults').innerHTML = `
            <div class="result-card"><div class="label">Clearance Hole</div><div class="value">${drill.clearance_hole || '-'}<span class="unit">mm</span></div></div>
            <div class="result-card"><div class="label">Tolerance</div><div class="value">${drill.tolerance || '-'}</div></div>
            <div class="result-card"><div class="label">Min Edge</div><div class="value">${drill.min_edge_distance || '-'}<span class="unit">mm</span></div></div>
            <div class="result-card"><div class="label">Min Spacing</div><div class="value">${drill.min_hole_distance || '-'}<span class="unit">mm</span></div></div>
            <div class="result-card"><div class="label">Tension SWL</div><div class="value">${tensionKg}<span class="unit">kg</span></div></div>
            <div class="result-card"><div class="label">Shear SWL</div><div class="value">${shearKg}<span class="unit">kg</span></div></div>
            <div class="result-card"><div class="label">Torque</div><div class="value">${data.torque_nm}<span class="unit">Nm</span></div></div>
            <div class="result-card"><div class="label">Spanner</div><div class="value">${data.spanner_mm}<span class="unit">mm</span></div></div>
        `;

        const tbody = document.getElementById('hobartGripBody');
        tbody.innerHTML = data.product_codes_with_sizes.map((code, i) =>
            `<tr><td>${code}</td><td>${data.clamping_ranges[i]}</td></tr>`
        ).join('');

        document.getElementById('hobartConsole').textContent = `üî© ${hobartType} ${hobartSize}: Drill ${drill.clearance_hole}mm hole, torque to ${data.torque_nm}Nm`;

        // Update grip visual
        hobartUpdateGripVisual();
    }

    // Find what bolts fit a given tube thickness
    function hobartFindFits() {
        const wallThickness = parseFloat(document.getElementById('tubeWallThickness').value) || 0;
        const clampTotal = parseFloat(document.getElementById('tubeClampTotal').value) || 0;
        const resultsDiv = document.getElementById('tubeFitResults');

        if (!wallThickness && !clampTotal) {
            resultsDiv.classList.remove('active');
            return;
        }

        const totalClamp = clampTotal || (wallThickness * 2); // Default to 2x wall if no total given
        const results = [];

        // Check all bolt types and sizes
        const boltTypes = [
            { key: 'HB', name: 'HB Hex Head', data: HOLLO_BOLT_DATA.HEXAGONAL_HEAD },
            { key: 'HBCSK', name: 'HBCSK Countersunk', data: HOLLO_BOLT_DATA.COUNTERSUNK_HEAD },
            { key: 'HBFF', name: 'HBFF Flush Fit', data: HOLLO_BOLT_DATA.FLUSH_FIT_HEAD },
            { key: 'LB', name: 'LB LindiBolt', data: HOLLO_BOLT_DATA.LINDIBOLT }
        ];

        boltTypes.forEach(type => {
            Object.entries(type.data).forEach(([size, data]) => {
                data.clamping_ranges.forEach((range, idx) => {
                    const [min, max] = range.split('-').map(Number);
                    let status = 'fail';
                    let statusIcon = '‚ùå';
                    let info = '';

                    if (totalClamp >= min && totalClamp <= max) {
                        const midPoint = (min + max) / 2;
                        if (totalClamp >= min + 3 && totalClamp <= max - 3) {
                            status = 'ok';
                            statusIcon = '‚úÖ';
                            info = 'Perfect fit';
                        } else {
                            status = 'warning';
                            statusIcon = '‚ö†Ô∏è';
                            info = totalClamp < midPoint ? 'Near minimum' : 'Near maximum';
                        }

                        results.push({
                            bolt: `${type.key} ${size}`,
                            code: data.product_codes_with_sizes[idx].split(' ')[0],
                            range: `${min}-${max}mm`,
                            status,
                            statusIcon,
                            info,
                            torque: data.torque_nm
                        });
                    }
                });
            });
        });

        if (results.length === 0) {
            resultsDiv.innerHTML = '<div style="color:#ef4444;padding:10px;">‚ùå No Hollo-Bolts fit this clamping thickness</div>';
        } else {
            resultsDiv.innerHTML = results.map(r => `
                <div class="tube-match ${r.status}">
                    <div>
                        <div class="tube-match-bolt">${r.bolt} (${r.code})</div>
                        <div class="tube-match-info">Grip: ${r.range} | Torque: ${r.torque}Nm | ${r.info}</div>
                    </div>
                    <div class="tube-match-status">${r.statusIcon}</div>
                </div>
            `).join('');
        }

        resultsDiv.classList.add('active');
    }

    // Update grip range visual
    function hobartUpdateGripVisual() {
        let dataSource;
        if (hobartType === 'HB') dataSource = HOLLO_BOLT_DATA.HEXAGONAL_HEAD;
        else if (hobartType === 'HBCSK') dataSource = HOLLO_BOLT_DATA.COUNTERSUNK_HEAD;
        else if (hobartType === 'HBFF') dataSource = HOLLO_BOLT_DATA.FLUSH_FIT_HEAD;
        else dataSource = HOLLO_BOLT_DATA.LINDIBOLT;

        const data = dataSource[hobartSize];
        if (!data) return;

        // Get all grip ranges for this bolt
        const allRanges = data.clamping_ranges.map(r => r.split('-').map(Number));
        const overallMin = Math.min(...allRanges.map(r => r[0]));
        const overallMax = Math.max(...allRanges.map(r => r[1]));

        // Update labels
        document.getElementById('gripMinLabel').textContent = `${overallMin}mm`;
        document.getElementById('gripMaxLabel').textContent = `${overallMax}mm`;

        // Clear and redraw ALL ranges on diagram
        const diagram = document.getElementById('gripDiagram');
        // Remove old range divs (except the current marker)
        diagram.querySelectorAll('.grip-range-segment').forEach(el => el.remove());

        // Get product codes (extract short name from full description)
        const productCodes = data.product_codes_with_sizes.map(p => p.split(' ')[0]);

        // Draw each bolt length range with different color intensity
        const colors = ['#22c55e', '#3b82f6', '#a855f7']; // green, blue, purple
        allRanges.forEach((range, i) => {
            const leftPercent = ((range[0] - overallMin) / (overallMax - overallMin)) * 100;
            const widthPercent = ((range[1] - range[0]) / (overallMax - overallMin)) * 100;

            const rangeDiv = document.createElement('div');
            rangeDiv.className = 'grip-range-segment';
            rangeDiv.style.cssText = `
                position: absolute;
                top: ${i * 20}px;
                height: 18px;
                left: ${leftPercent}%;
                width: ${widthPercent}%;
                background: ${colors[i % colors.length]};
                opacity: 0.7;
                border-radius: 3px;
                border: 1px solid rgba(255,255,255,0.3);
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 0 4px;
                box-sizing: border-box;
            `;
            // Add label with product code AND range numbers
            rangeDiv.innerHTML = `
                <span style="font-size:9px;color:#fff;white-space:nowrap;font-weight:bold">${productCodes[i]}</span>
                <span style="font-size:8px;color:rgba(255,255,255,0.9);white-space:nowrap">${range[0]}-${range[1]}</span>
            `;
            diagram.appendChild(rangeDiv);
        });

        // Check user input
        const userClamp = parseFloat(document.getElementById('hobartClampInput').value);
        const currentMarker = document.getElementById('gripCurrent');
        const statusSpan = document.getElementById('gripStatus');

        if (userClamp) {
            currentMarker.style.display = 'block';
            const pos = ((userClamp - overallMin) / (overallMax - overallMin)) * 100;
            currentMarker.style.left = `${Math.min(100, Math.max(0, pos))}%`;

            // Check if in range and which bolt fits
            let matchingBolt = null;
            allRanges.forEach((range, i) => {
                if (userClamp >= range[0] && userClamp <= range[1]) {
                    matchingBolt = productCodes[i];
                }
            });

            if (matchingBolt) {
                statusSpan.innerHTML = `‚úÖ <span style="color:#22c55e">USE ${matchingBolt}</span>`;
            } else if (userClamp < overallMin) {
                statusSpan.innerHTML = '‚ùå <span style="color:#ef4444">TOO THIN - No bolt fits</span>';
            } else if (userClamp > overallMax) {
                statusSpan.innerHTML = '‚ùå <span style="color:#ef4444">TOO THICK - No bolt fits</span>';
            } else {
                // In between ranges (gap)
                statusSpan.innerHTML = '‚ö†Ô∏è <span style="color:#f59e0b">BETWEEN RANGES - Check table</span>';
            }
        } else {
            currentMarker.style.display = 'none';
            statusSpan.textContent = '';
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // IGOR FUNCTIONS (Dropdown-based)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let igorMembers = []; // Array to store added members

    // Load sections into dropdown when type changes
    function igorLoadSections() {
        const typeSelect = document.getElementById('igorTypeSelect');
        const sectionSelect = document.getElementById('igorSectionSelect');
        const selectedType = typeSelect.value;

        if (!selectedType) {
            sectionSelect.innerHTML = '<option value="">Section</option>';
            document.getElementById('igorPreview').style.display = 'none';
            return;
        }

        const sections = STEEL_SECTIONS[selectedType].data;
        sectionSelect.innerHTML = '<option value="">Select section</option>';

        Object.entries(sections).forEach(([name, mass]) => {
            const opt = document.createElement('option');
            opt.value = name;
            opt.dataset.mass = mass;
            opt.textContent = `${name} (${mass} kg/m)`;
            sectionSelect.appendChild(opt);
        });

        document.getElementById('igorConsole').textContent = `‚öñÔ∏è ${selectedType}: ${Object.keys(sections).length} sections available`;
        document.getElementById('igorPreview').style.display = 'none';
    }

    // Update preview when section/length/qty changes
    function igorUpdatePreview() {
        const typeSelect = document.getElementById('igorTypeSelect');
        const sectionSelect = document.getElementById('igorSectionSelect');
        const lengthInput = document.getElementById('igorLengthInput');
        const qtyInput = document.getElementById('igorQtyInput');
        const preview = document.getElementById('igorPreview');

        const type = typeSelect.value;
        const section = sectionSelect.value;
        const length = parseFloat(lengthInput.value) || 0;
        const qty = parseInt(qtyInput.value) || 1;

        if (!section || !length) {
            preview.style.display = 'none';
            return;
        }

        const selectedOption = sectionSelect.options[sectionSelect.selectedIndex];
        const massPerM = parseFloat(selectedOption.dataset.mass) || 0;
        const totalWeight = massPerM * length * qty;

        document.getElementById('igorPreviewMember').textContent = `${qty}x ${section} ${type} @ ${length}m`;
        document.getElementById('igorPreviewWeight').textContent = `${totalWeight.toFixed(1)} kg`;
        preview.style.display = 'flex';
    }

    // Add member to list
    function igorAddMember() {
        const typeSelect = document.getElementById('igorTypeSelect');
        const sectionSelect = document.getElementById('igorSectionSelect');
        const lengthInput = document.getElementById('igorLengthInput');
        const qtyInput = document.getElementById('igorQtyInput');

        const type = typeSelect.value;
        const section = sectionSelect.value;
        const length = parseFloat(lengthInput.value) || 0;
        const qty = parseInt(qtyInput.value) || 1;

        if (!section || !length) {
            alert('Please select a section and enter a length');
            return;
        }

        const selectedOption = sectionSelect.options[sectionSelect.selectedIndex];
        const massPerM = parseFloat(selectedOption.dataset.mass) || 0;
        const total = massPerM * length * qty;

        igorMembers.push({ type, section, length, qty, massPerM, total });
        igorRenderMembers();

        // Reset for next entry
        sectionSelect.value = '';
        lengthInput.value = '1';
        qtyInput.value = '1';
        document.getElementById('igorPreview').style.display = 'none';

        document.getElementById('igorConsole').textContent = `‚öñÔ∏è Added: ${qty}x ${section} ${type} @ ${length}m = ${total.toFixed(1)} kg`;
    }

    // Render members list
    function igorRenderMembers() {
        const list = document.getElementById('igorMembersList');
        list.innerHTML = igorMembers.map((m, i) => `
            <div class="igor-member-item">
                <span>${m.qty}x ${m.section} ${m.type} @ ${m.length}m</span>
                <span class="weight">${m.total.toFixed(1)} kg</span>
                <button class="remove-btn" onclick="igorRemoveMember(${i})">√ó</button>
            </div>
        `).join('');
    }

    // Remove member from list
    function igorRemoveMember(index) {
        igorMembers.splice(index, 1);
        igorRenderMembers();
        document.getElementById('igorResultsSection').style.display = 'none';
    }

    // Calculate total weight
    function igorCalculateTotal() {
        if (igorMembers.length === 0) {
            alert('Please add at least one steel member');
            return;
        }

        const breakdown = {};
        let totalWeight = 0;

        igorMembers.forEach(m => {
            const key = m.type;
            if (!breakdown[key]) breakdown[key] = 0;
            breakdown[key] += m.total;
            totalWeight += m.total;
        });

        // Render breakdown
        const breakdownHtml = Object.entries(breakdown).map(([type, weight]) =>
            `<div style="display:flex;justify-content:space-between;padding:5px 0;"><span>${type}:</span><span>${weight.toFixed(1)} kg</span></div>`
        ).join('');

        document.getElementById('igorBreakdown').innerHTML = breakdownHtml;
        document.getElementById('igorSteelWeight').textContent = `${totalWeight.toFixed(1)} kg`;
        document.getElementById('igorTotalWeight').textContent = `${(totalWeight * 1.1).toFixed(1)} kg`;
        document.getElementById('igorResultsSection').style.display = 'block';

        document.getElementById('igorConsole').textContent = `‚öñÔ∏è Total: ${totalWeight.toFixed(1)} kg steel + 10% fittings = ${(totalWeight * 1.1).toFixed(1)} kg`;
    }

    // Excel Download Function - generates multi-sheet IBSC Steel Calculator with styling
    async function igorDownloadExcel() {
        document.getElementById('igorConsole').textContent = '‚öñÔ∏è Generating Excel calculator... Please wait';

        // Load ExcelJS library dynamically (supports styling)
        if (typeof ExcelJS === 'undefined') {
            await new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js';
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        const workbook = new ExcelJS.Workbook();
        workbook.creator = 'IGOR - STEEL Command Center';
        workbook.created = new Date();

        const SS_FACTOR = 1.02; // Stainless steel factor (density 8000 vs 7850 kg/m¬≥)

        // Different colors for each sheet type
        const sheetColors = {
            'SHS': '1E88E5',  // Blue
            'RHS': '43A047',  // Green
            'CHS': 'E53935',  // Red
            'EA':  'FB8C00',  // Orange
            'UA':  '8E24AA',  // Purple
            'FB':  '00ACC1',  // Cyan
            'RB':  '6D4C41',  // Brown
            'SB':  '546E7A',  // Blue Grey
            'UB':  '5E35B1',  // Deep Purple
            'WB':  '00897B',  // Teal
            'UC':  'D81B60',  // Pink
            'WC':  '3949AB',  // Indigo
            'PFC': 'F4511E',  // Deep Orange
            'TFB': '7CB342'   // Light Green
        };
        const headerFont = { bold: true, color: { argb: 'FFFFFF' } };
        const ssHeaderFill = { type: 'pattern', pattern: 'solid', fgColor: { argb: '4A7C59' } };
        const summaryHeaderFill = { type: 'pattern', pattern: 'solid', fgColor: { argb: '2F5496' } };
        const titleFont = { bold: true, size: 16 };
        const inputFill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FFF9C4' } };  // Light yellow
        const calcFill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'E3F2FD' } };   // Light blue
        const border = {
            top: { style: 'thin' },
            left: { style: 'thin' },
            bottom: { style: 'thin' },
            right: { style: 'thin' }
        };

        // Sheet order for summary references
        const sheetOrder = ['SHS', 'RHS', 'CHS', 'EA', 'UA', 'FB', 'RB', 'SB', 'UB', 'WB', 'UC', 'WC', 'PFC', 'TFB'];
        const sheetInfo = [];

        // Create hidden Lists sheet for dropdown references
        const listsSheet = workbook.addWorksheet('_Lists');
        listsSheet.state = 'veryHidden';
        let listCol = 1;
        const listRanges = {};

        // Populate Lists sheet with all section sizes
        sheetOrder.forEach(type => {
            const typeData = STEEL_SECTIONS[type];
            const entries = Object.entries(typeData.data);
            const sizes = entries.map(([size]) => size);

            // Write sizes to column
            sizes.forEach((size, idx) => {
                listsSheet.getCell(idx + 1, listCol).value = size;
            });

            // Store range reference for this type
            listRanges[type] = `_Lists!$${String.fromCharCode(64 + listCol)}$1:$${String.fromCharCode(64 + listCol)}$${sizes.length}`;
            listCol++;
        });

        // Create lookup sheet for VLOOKUP formulas
        const lookupSheet = workbook.addWorksheet('_Lookup');
        lookupSheet.state = 'veryHidden';
        let lookupCol = 1;
        const lookupRanges = {};

        // Populate lookup sheet with size -> mass data
        sheetOrder.forEach(type => {
            const typeData = STEEL_SECTIONS[type];
            const entries = Object.entries(typeData.data);

            entries.forEach(([size, mass], idx) => {
                lookupSheet.getCell(idx + 1, lookupCol).value = size;
                lookupSheet.getCell(idx + 1, lookupCol + 1).value = mass;
            });

            const colLetter1 = String.fromCharCode(64 + lookupCol);
            const colLetter2 = String.fromCharCode(64 + lookupCol + 1);
            lookupRanges[type] = `_Lookup!$${colLetter1}$1:$${colLetter2}$${entries.length}`;
            lookupCol += 2;
        });

        // Create data sheets with different colors and dropdowns (EMPTY rows)
        const NUM_EMPTY_ROWS = 50; // 50 empty rows for user input
        sheetOrder.forEach(type => {
            const typeData = STEEL_SECTIONS[type];
            const ws = workbook.addWorksheet(type);
            const entries = Object.entries(typeData.data);

            // Set tab color
            ws.properties.tabColor = { argb: sheetColors[type] };
            const sheetHeaderFill = { type: 'pattern', pattern: 'solid', fgColor: { argb: sheetColors[type] } };

            // Headers with sheet-specific color (include hidden Breakdown column E)
            const headers = ['Size (mm)', 'Mass (kg/m)', 'Linear Metres', 'Total Weight (kg)', 'Breakdown'];
            const headerRow = ws.addRow(headers);
            headerRow.eachCell((cell, colNumber) => {
                cell.fill = sheetHeaderFill;
                cell.font = headerFont;
                cell.alignment = { horizontal: 'center', vertical: 'middle' };
                cell.border = border;
            });

            // Empty data rows with dropdowns and VLOOKUP for mass
            for (let idx = 0; idx < NUM_EMPTY_ROWS; idx++) {
                const rowNum = idx + 2;
                // Mass uses VLOOKUP from hidden sheet, Weight calculates if linear metres entered
                // Column E creates breakdown text for Summary TEXTJOIN
                const row = ws.addRow([
                    null,
                    { formula: `IF(A${rowNum}="","",VLOOKUP(A${rowNum},${lookupRanges[type]},2,FALSE))` },
                    null,
                    { formula: `IF(OR(A${rowNum}="",C${rowNum}=""),"",B${rowNum}*C${rowNum})` },
                    { formula: `IF(OR(A${rowNum}="",C${rowNum}=""),"",A${rowNum}&" - "&TEXT(C${rowNum},"0.#")&"m")` }
                ]);
                row.eachCell((cell, colNumber) => {
                    cell.alignment = { horizontal: 'center', vertical: 'middle' };
                    cell.border = border;
                    // Column 1 (Size) is input - yellow
                    if (colNumber === 1) cell.fill = inputFill;
                    // Column 3 (Linear Metres) is input - yellow
                    if (colNumber === 3) cell.fill = inputFill;
                    // Column 4 (Total Weight) is calculated - light blue
                    if (colNumber === 4) cell.fill = calcFill;
                });
                row.getCell(2).numFmt = '0.00';
                row.getCell(3).numFmt = '0.00';
                row.getCell(4).numFmt = '#,##0.00';

                // Add dropdown for Size column using range reference
                row.getCell(1).dataValidation = {
                    type: 'list',
                    allowBlank: true,
                    formulae: [listRanges[type]]
                };
            }

            // Set column widths (Column E hidden for breakdown data)
            ws.getColumn(1).width = 25;
            ws.getColumn(2).width = 15;
            ws.getColumn(3).width = 15;
            ws.getColumn(4).width = 18;
            ws.getColumn(5).width = 0.1; // Hide column E (breakdown helper)
            ws.getColumn(5).hidden = true;

            // Freeze header
            ws.views = [{ state: 'frozen', ySplit: 1 }];

            sheetInfo.push({ name: type, rows: NUM_EMPTY_ROWS });
        });

        // Create Summary sheet at the beginning
        const summary = workbook.addWorksheet('Summary');

        // Title - merge cells A1:D1
        summary.mergeCells('A1:D1');
        const titleCell = summary.getCell('A1');
        titleCell.value = 'STEEL WEIGHT SUMMARY';
        titleCell.font = titleFont;
        titleCell.alignment = { horizontal: 'center' };

        // Instructions
        summary.mergeCells('A3:D3');
        summary.getCell('A3').value = 'Enter linear metres in each sheet. Totals update automatically.';
        summary.getCell('A3').font = { italic: true };

        summary.mergeCells('A4:D4');
        summary.getCell('A4').value = 'Stainless Steel weight = Mild Steel √ó 1.02 (density difference)';
        summary.getCell('A4').font = { italic: true };

        // Headers at row 6
        const summaryHeaders = ['Category', 'Total Weight (kg)', 'Weight (tonnes)', 'Stainless (kg)'];
        const summaryHeaderRow = summary.getRow(6);
        summaryHeaders.forEach((h, idx) => {
            const cell = summaryHeaderRow.getCell(idx + 1);
            cell.value = h;
            cell.fill = idx === 3 ? ssHeaderFill : summaryHeaderFill;
            cell.font = headerFont;
            cell.alignment = { horizontal: 'center', vertical: 'middle' };
            cell.border = border;
        });

        // Data rows
        sheetInfo.forEach((info, idx) => {
            const rowNum = idx + 7;
            const endRow = info.rows + 1;
            const row = summary.getRow(rowNum);

            row.getCell(1).value = info.name;
            row.getCell(2).value = { formula: `SUM('${info.name}'!D2:D${endRow})` };
            row.getCell(3).value = { formula: `B${rowNum}/1000` };
            row.getCell(4).value = { formula: `B${rowNum}*${SS_FACTOR}` };

            row.eachCell(cell => {
                cell.alignment = { horizontal: 'center', vertical: 'middle' };
                cell.border = border;
            });
            row.getCell(2).numFmt = '#,##0.00';
            row.getCell(3).numFmt = '#,##0.000';
            row.getCell(4).numFmt = '#,##0.00';
        });

        // Grand total row
        const startDataRow = 7;
        const endDataRow = 6 + sheetInfo.length;
        const totalRowNum = endDataRow + 2;
        const totalRow = summary.getRow(totalRowNum);

        totalRow.getCell(1).value = 'GRAND TOTAL';
        totalRow.getCell(1).font = { bold: true, size: 12 };
        totalRow.getCell(2).value = { formula: `SUM(B${startDataRow}:B${endDataRow})` };
        totalRow.getCell(3).value = { formula: `SUM(C${startDataRow}:C${endDataRow})` };
        totalRow.getCell(4).value = { formula: `SUM(D${startDataRow}:D${endDataRow})` };

        totalRow.eachCell(cell => {
            cell.font = { bold: true };
            cell.alignment = { horizontal: 'center', vertical: 'middle' };
            cell.border = border;
        });
        totalRow.getCell(2).numFmt = '#,##0.00';
        totalRow.getCell(3).numFmt = '#,##0.000';
        totalRow.getCell(4).numFmt = '#,##0.00';

        // Set column widths
        summary.getColumn(1).width = 20;
        summary.getColumn(2).width = 18;
        summary.getColumn(3).width = 18;
        summary.getColumn(4).width = 18;

        // Freeze at row 7
        summary.views = [{ state: 'frozen', ySplit: 6 }];

        // Move Summary to first position
        workbook.removeWorksheet('Summary');
        const summaryNew = workbook.addWorksheet('Summary');

        // Re-create Summary (ExcelJS doesn't support moving sheets easily)
        // Company Header
        const companyHeaderFill = { type: 'pattern', pattern: 'solid', fgColor: { argb: '1a365d' } };

        summaryNew.mergeCells('A1:E1');
        summaryNew.getCell('A1').value = 'J&M Art Steel Fabrication P/L';
        summaryNew.getCell('A1').font = { bold: true, size: 18, color: { argb: 'FFFFFF' } };
        summaryNew.getCell('A1').fill = companyHeaderFill;
        summaryNew.getCell('A1').alignment = { horizontal: 'center', vertical: 'middle' };
        summaryNew.getRow(1).height = 30;

        summaryNew.mergeCells('A2:E2');
        summaryNew.getCell('A2').value = 'Unit 2/ 28-30 Lillian Flower Place, Marrickville NSW 2204';
        summaryNew.getCell('A2').font = { size: 11, color: { argb: 'FFFFFF' } };
        summaryNew.getCell('A2').fill = companyHeaderFill;
        summaryNew.getCell('A2').alignment = { horizontal: 'center', vertical: 'middle' };

        summaryNew.mergeCells('A3:E3');
        summaryNew.getCell('A3').value = 'T: 02 8021 6707  |  M: 0421 470 043';
        summaryNew.getCell('A3').font = { size: 11, color: { argb: 'FFFFFF' } };
        summaryNew.getCell('A3').fill = companyHeaderFill;
        summaryNew.getCell('A3').alignment = { horizontal: 'center', vertical: 'middle' };

        // Title
        summaryNew.mergeCells('A5:E5');
        summaryNew.getCell('A5').value = 'STEEL WEIGHT SUMMARY';
        summaryNew.getCell('A5').font = titleFont;
        summaryNew.getCell('A5').alignment = { horizontal: 'center' };

        summaryNew.mergeCells('A7:E7');
        summaryNew.getCell('A7').value = 'Enter linear metres in each sheet. Totals update automatically.';
        summaryNew.getCell('A7').font = { italic: true };

        summaryNew.mergeCells('A8:E8');
        summaryNew.getCell('A8').value = 'Stainless Steel weight = Mild Steel √ó 1.02 (density difference)';
        summaryNew.getCell('A8').font = { italic: true };

        // Headers including Breakdown column
        const newSummaryHeaders = ['Category', 'Total Weight (kg)', 'Weight (tonnes)', 'Stainless (kg)', 'Breakdown'];
        const newHeaderRow = summaryNew.getRow(10);
        newSummaryHeaders.forEach((h, idx) => {
            const cell = newHeaderRow.getCell(idx + 1);
            cell.value = h;
            cell.fill = idx === 3 ? ssHeaderFill : summaryHeaderFill;
            cell.font = headerFont;
            cell.alignment = { horizontal: 'center', vertical: 'middle' };
            cell.border = border;
        });

        // Data rows start at row 11 (after header at row 10)
        sheetInfo.forEach((info, idx) => {
            const rowNum = idx + 11;
            const endRow = info.rows + 1;
            const row = summaryNew.getRow(rowNum);

            row.getCell(1).value = info.name;
            row.getCell(2).value = { formula: `SUM('${info.name}'!D2:D${endRow})` };
            row.getCell(3).value = { formula: `B${rowNum}/1000` };
            row.getCell(4).value = { formula: `B${rowNum}*${SS_FACTOR}` };
            // Breakdown: Add a helper column E on each member sheet that concatenates size + metres
            // Then use TEXTJOIN to combine all non-empty values from that column
            const breakdownFormula = `_xlfn.TEXTJOIN(", ",TRUE,'${info.name}'!E2:E${endRow})`;
            row.getCell(5).value = { formula: breakdownFormula };

            for (let c = 1; c <= 5; c++) {
                row.getCell(c).alignment = { horizontal: c === 5 ? 'left' : 'center', vertical: 'middle' };
                row.getCell(c).border = border;
            }
            row.getCell(2).numFmt = '#,##0.00';
            row.getCell(3).numFmt = '#,##0.000';
            row.getCell(4).numFmt = '#,##0.00';
        });

        // Grand total row for new summary
        const newStartDataRow = 11;
        const newEndDataRow = 10 + sheetInfo.length;
        const newTotalRowNum = newEndDataRow + 2;
        const newTotalRow = summaryNew.getRow(newTotalRowNum);
        newTotalRow.getCell(1).value = 'GRAND TOTAL';
        newTotalRow.getCell(1).font = { bold: true, size: 12 };
        newTotalRow.getCell(2).value = { formula: `SUM(B${newStartDataRow}:B${newEndDataRow})` };
        newTotalRow.getCell(3).value = { formula: `SUM(C${newStartDataRow}:C${newEndDataRow})` };
        newTotalRow.getCell(4).value = { formula: `SUM(D${newStartDataRow}:D${newEndDataRow})` };
        newTotalRow.getCell(5).value = '';

        for (let c = 1; c <= 5; c++) {
            newTotalRow.getCell(c).font = { bold: true };
            newTotalRow.getCell(c).alignment = { horizontal: 'center', vertical: 'middle' };
            newTotalRow.getCell(c).border = border;
        }
        newTotalRow.getCell(2).numFmt = '#,##0.00';
        newTotalRow.getCell(3).numFmt = '#,##0.000';
        newTotalRow.getCell(4).numFmt = '#,##0.00';

        summaryNew.getColumn(1).width = 12;
        summaryNew.getColumn(2).width = 16;
        summaryNew.getColumn(3).width = 16;
        summaryNew.getColumn(4).width = 16;
        summaryNew.getColumn(5).width = 60;
        summaryNew.views = [{ state: 'frozen', ySplit: 10 }];

        // Generate and download
        const buffer = await workbook.xlsx.writeBuffer();
        const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'IBSC_Steel_Calculator.xlsx';
        a.click();
        URL.revokeObjectURL(url);

        document.getElementById('igorConsole').textContent = '‚öñÔ∏è Excel downloaded! Empty rows with dropdowns, breakdown column in Summary.';
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // CHUCK FUNCTIONS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let chuckType = 'HY200R', chuckSize = 'M16';
    let chuckLat = null, chuckLon = null, chuckCurrentTemp = null;

    function chuckGetLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    chuckLat = position.coords.latitude;
                    chuckLon = position.coords.longitude;
                    chuckGetWeather();
                },
                (error) => {
                    console.log('Location error:', error);
                    document.getElementById('chuckLocation').textContent = 'üìç Location unavailable';
                    chuckLat = -33.87; // Sydney default
                    chuckLon = 151.21;
                    chuckGetWeather();
                }
            );
        }
    }

    async function chuckGetWeather() {
        if (!chuckLat || !chuckLon) return;

        try {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${chuckLat}&longitude=${chuckLon}&current=temperature_2m,relative_humidity_2m&timezone=auto`;
            const res = await fetch(url);
            const data = await res.json();

            if (data.current) {
                chuckCurrentTemp = Math.round(data.current.temperature_2m);
                document.getElementById('chuckCurrentTemp').textContent = chuckCurrentTemp;

                // Try to get location name
                try {
                    const geoUrl = `https://nominatim.openstreetmap.org/reverse?lat=${chuckLat}&lon=${chuckLon}&format=json`;
                    const geoRes = await fetch(geoUrl);
                    const geoData = await geoRes.json();
                    const suburb = geoData.address?.suburb || geoData.address?.city || geoData.address?.town || 'Your location';
                    document.getElementById('chuckLocation').textContent = `üìç ${suburb}`;
                } catch (e) {
                    document.getElementById('chuckLocation').textContent = 'üìç Your location';
                }

                // Update cure times display
                chuckUpdateCureTimes();
            }
        } catch (err) {
            console.log('Weather error:', err);
            document.getElementById('chuckCurrentTemp').textContent = '20';
            chuckCurrentTemp = 20;
        }
    }

    function getCureTimeLocal(product, temp) {
        const data = CURE_TIME_DATA[product] || CURE_TIME_DATA['HY200R'];
        for (const entry of data) {
            if (temp >= entry.min && temp <= entry.max) {
                return { work: formatCureTime(entry.work), cure: formatCureTime(entry.cure), cureMin: entry.cure };
            }
        }
        return { work: '15 min', cure: '1h', cureMin: 60 };
    }

    function formatCureTime(mins) {
        mins = Math.round(mins);
        if (mins < 60) return `${mins} min`;
        if (mins < 1440) {
            const h = mins / 60;
            return h === Math.floor(h) ? `${h}h` : `${h.toFixed(1)}h`;
        }
        return `${(mins/1440).toFixed(1)} days`;
    }

    function chuckUpdateCureTimes() {
        const temp = chuckCurrentTemp || 20;
        const cureData = getCureTimeLocal(chuckType, temp);

        document.getElementById('chuckCureTemp').textContent = temp;
        document.getElementById('cureWorkStd').textContent = `Work: ${cureData.work}`;
        document.getElementById('cureCureStd').textContent = cureData.cure;

        document.getElementById('cureWorkCoast').textContent = `Work: ${cureData.work}`;
        document.getElementById('cureCureCoast').textContent = formatCureTime(cureData.cureMin * 1.5);

        const shadeCure = getCureTimeLocal(chuckType, temp - 5);
        document.getElementById('cureWorkShade').textContent = `Work: ${shadeCure.work}`;
        document.getElementById('cureCureShade').textContent = shadeCure.cure;

        document.getElementById('chuckCureSection').style.display = 'block';
    }

    function chuckSetType(type, btn) {
        chuckType = type;
        document.querySelectorAll('#chuckTypeButtons .btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        chuckUpdateSizes();
        chuckCalculate();
    }

    function chuckUpdateSizes() {
        const sizes = Object.keys(HILTI_DATA[chuckType].sizes);
        const container = document.getElementById('chuckSizeButtons');
        container.innerHTML = sizes.map(s =>
            `<button class="btn${s === chuckSize ? ' active' : ''}" onclick="chuckSetSize('${s}', this)">${s}</button>`
        ).join('');
        if (!sizes.includes(chuckSize)) {
            chuckSize = sizes[Math.floor(sizes.length/2)];
        }
    }

    function chuckSetSize(size, btn) {
        chuckSize = size;
        document.querySelectorAll('#chuckSizeButtons .btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const sizeData = HILTI_DATA[chuckType].sizes[size];
        if (sizeData) document.getElementById('chuckDepth').value = sizeData.embed;
        chuckCalculate();
    }

    function chuckCalculate() {
        const depth = parseFloat(document.getElementById('chuckDepth').value) || 0;
        const qty = parseInt(document.getElementById('chuckQty').value) || 1;
        const chemical = HILTI_DATA[chuckType];
        const sizeData = chemical.sizes[chuckSize];

        if (!sizeData) return;

        const holeVol = Math.PI * Math.pow(sizeData.hole/2, 2) * depth / 1000;
        const totalVol = holeVol * qty * 1.15;

        // Calculate cartridge options
        const cart330 = Math.ceil(totalVol / 330);
        const cart500 = Math.ceil(totalVol / 500);
        const cart1400 = Math.ceil(totalVol / 1400);

        document.getElementById('chuckResults').innerHTML = `
            <div class="result-card"><div class="label">Hole Size</div><div class="value">${sizeData.hole}<span class="unit">mm</span></div></div>
            <div class="result-card"><div class="label">Min Embed</div><div class="value">${sizeData.embed}<span class="unit">mm</span></div></div>
            <div class="result-card"><div class="label">Vol/Hole</div><div class="value">${holeVol.toFixed(1)}<span class="unit">ml</span></div></div>
            <div class="result-card"><div class="label">Total Vol</div><div class="value">${totalVol.toFixed(0)}<span class="unit">ml</span></div></div>
            <div class="result-card"><div class="label">Cartridges</div><div class="value" style="color:#22c55e">${cart330}</div></div>
            <div class="result-card"><div class="label">Product</div><div class="value" style="font-size:0.9rem">${chemical.name}</div></div>
        `;

        // Show cartridge options
        document.getElementById('chuckCart330').textContent = cart330;
        document.getElementById('chuckCart500').textContent = cart500;
        document.getElementById('chuckCart1400').textContent = cart1400;
        document.getElementById('chuckCartOptions').style.display = 'flex';

        // Update cure times if temp available
        if (chuckCurrentTemp) {
            chuckUpdateCureTimes();
        }

        document.getElementById('chuckConsole').textContent = `üß™ ${chemical.name} ${chuckSize}: ${qty} holes √ó ${depth}mm = ${cart330} √ó 330ml cartridge${cart330>1?'s':''}`;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // BRITTANY FUNCTIONS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let brittanyType = 'dynabolt', brittanySize = 'M12';
    let brittanyTotalTension = 0, brittanyTotalShear = 0;

    function brittanySetType(type, btn) {
        brittanyType = type;
        document.querySelectorAll('#brittanyTypeButtons .btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        brittanyUpdateSizes();
        brittanyCalculate();
    }

    function brittanySetSize(size, btn) {
        brittanySize = size;
        document.querySelectorAll('#brittanySizeButtons .btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        brittanyCalculate();
    }

    function brittanyUpdateSizes() {
        const data = FIXING_DATA[brittanyType];
        const availableSizes = Object.keys(data.sizes);
        const container = document.getElementById('brittanySizeButtons');

        container.innerHTML = availableSizes.map(s =>
            `<button class="btn${s === brittanySize ? ' active' : ''}" onclick="brittanySetSize('${s}', this)">${s}</button>`
        ).join('');

        if (!availableSizes.includes(brittanySize)) {
            brittanySize = availableSizes[0];
        }

        // Update min values display
        if (data.sizes[brittanySize]) {
            const [t, s, embed, edge, spacing, hole] = data.sizes[brittanySize];
            document.getElementById('brittanyEmbedMin').textContent = `min: ${embed}`;
            document.getElementById('brittanyEdgeMin').textContent = `min: ${edge}`;
            document.getElementById('brittanySpacingMin').textContent = `min: ${spacing}`;
        }
    }

    function brittanyCalculate() {
        const qty = parseInt(document.getElementById('brittanyQty').value) || 1;
        const concrete = parseInt(document.getElementById('brittanyConcrete').value);
        const overhead = document.getElementById('brittanyOverhead').checked;
        const fixing = FIXING_DATA[brittanyType];
        const sizeData = fixing.sizes[brittanySize];

        if (!sizeData) return;

        const [tensionKn, shearKn, minEmbed, minEdge, minSpacing, holeSize] = sizeData;

        // Get custom params or use minimums
        const embedInput = document.getElementById('brittanyEmbed').value;
        const edgeInput = document.getElementById('brittanyEdge').value;
        const spacingInput = document.getElementById('brittanySpacing').value;

        const embed = embedInput ? parseInt(embedInput) : minEmbed;
        const edge = edgeInput ? parseInt(edgeInput) : minEdge;
        const spacing = spacingInput ? parseInt(spacingInput) : minSpacing;

        // Update min displays
        document.getElementById('brittanyEmbedMin').textContent = `min: ${minEmbed}`;
        document.getElementById('brittanyEdgeMin').textContent = `min: ${minEdge}`;
        document.getElementById('brittanySpacingMin').textContent = `min: ${minSpacing}`;

        // Calculate reduction factors
        const edgeFactor = edge < minEdge ? Math.max(0.5, edge / minEdge) : 1.0;
        const spacingFactor = spacing < minSpacing ? Math.max(0.5, spacing / minSpacing) : 1.0;
        let embedFactor = 1.0;
        if (brittanyType === 'chemset') {
            embedFactor = Math.min(2.0, Math.max(0.5, embed / minEmbed));
        } else if (embed < minEmbed) {
            embedFactor = Math.max(0.5, embed / minEmbed);
        }

        // Substrate factor - calculate based on MPa value relative to 32MPa baseline
        // Formula: sqrt(actual MPa / 32) gives reasonable scaling
        const concFactor = Math.sqrt(concrete / 32);

        // Get substrate name for display
        const substrateSelect = document.getElementById('brittanyConcrete');
        const substrateName = substrateSelect.options[substrateSelect.selectedIndex].text;
        const isWeakSubstrate = concrete < 10;
        const isMasonry = concrete <= 15 && !substrateName.includes('Concrete');

        // Overhead/cracked factor (50% reduction as shown in checkbox label)
        const overheadFactor = overhead ? 0.5 : 1.0;

        // Calculate
        let tensionPerKg = Math.round(tensionKn * concFactor * overheadFactor * edgeFactor * embedFactor * 102);
        let shearPerKg = Math.round(shearKn * concFactor * overheadFactor * edgeFactor * spacingFactor * 102);

        // Additional reduction for masonry - mechanical anchors less reliable
        if (isMasonry && (brittanyType === 'dynabolt' || brittanyType === 'trubolt' || brittanyType === 'hilti_hsl' || brittanyType === 'dropin')) {
            tensionPerKg = Math.round(tensionPerKg * 0.5);
            shearPerKg = Math.round(shearPerKg * 0.5);
        }

        brittanyTotalTension = tensionPerKg * qty;
        brittanyTotalShear = shearPerKg * qty;

        // Substrate warning for display
        let substrateWarning = '';
        if (isWeakSubstrate) {
            substrateWarning = '<div style="background:#ef4444;color:white;padding:8px;border-radius:6px;margin-bottom:10px;font-weight:bold">‚ö†Ô∏è WEAK SUBSTRATE - Consider chemical anchors only!</div>';
        } else if (isMasonry) {
            substrateWarning = '<div style="background:#f59e0b;color:white;padding:8px;border-radius:6px;margin-bottom:10px">‚ö†Ô∏è MASONRY - Use chemical anchors for best results</div>';
        }

        document.getElementById('brittanyResults').innerHTML = `
            ${substrateWarning}
            <div class="result-card"><div class="label">Tension (each)</div><div class="value">${tensionPerKg}<span class="unit">kg</span></div></div>
            <div class="result-card"><div class="label">Shear (each)</div><div class="value">${shearPerKg}<span class="unit">kg</span></div></div>
            <div class="result-card"><div class="label">Total Tension</div><div class="value" style="color:#22c55e">${brittanyTotalTension.toLocaleString()}<span class="unit">kg</span></div></div>
            <div class="result-card"><div class="label">Total Shear</div><div class="value" style="color:#22c55e">${brittanyTotalShear.toLocaleString()}<span class="unit">kg</span></div></div>
            <div class="result-card"><div class="label">Hole Size</div><div class="value">${holeSize}<span class="unit">mm</span></div></div>
            <div class="result-card"><div class="label">Substrate</div><div class="value" style="font-size:0.8rem">${substrateName}</div></div>
        `;

        // Show warnings for reduced factors
        let warnings = [];
        if (edgeFactor < 1.0) warnings.push(`Edge: ${Math.round(edgeFactor*100)}%`);
        if (spacingFactor < 1.0) warnings.push(`Spacing: ${Math.round(spacingFactor*100)}%`);
        if (embedFactor !== 1.0 && brittanyType === 'chemset') warnings.push(`Embed: ${Math.round(embedFactor*100)}%`);
        if (isMasonry && brittanyType !== 'chemset') warnings.push('Masonry: 50%');

        let consoleMsg = `üí™ ${qty}√ó ${fixing.name} ${brittanySize}: Holds ${brittanyTotalTension.toLocaleString()}kg tension, ${brittanyTotalShear.toLocaleString()}kg shear`;
        if (warnings.length > 0) consoleMsg += ` (Reduced: ${warnings.join(', ')})`;
        document.getElementById('brittanyConsole').textContent = consoleMsg;

        // Update load check if there's a value
        brittanyCheckLoad();
    }

    function brittanyCheckLoad() {
        const loadInput = document.getElementById('brittanyLoad').value;
        const loadType = document.getElementById('brittanyLoadType').value;
        const resultDiv = document.getElementById('brittanyLoadResult');
        const utilDisplay = document.getElementById('brittanyUtilDisplay');

        if (!loadInput) {
            resultDiv.style.display = 'none';
            utilDisplay.style.display = 'none';
            return;
        }

        const load = parseInt(loadInput);
        const capacity = loadType === 'tension' ? brittanyTotalTension : brittanyTotalShear;
        const utilisation = load / capacity;
        const percent = Math.min(utilisation * 100, 150);

        resultDiv.style.display = 'block';
        utilDisplay.style.display = 'block';

        const fill = document.getElementById('brittanyLoadFill');
        const status = document.getElementById('brittanyLoadStatus');
        const utilPercent = document.getElementById('brittanyUtilPercent');
        const utilStatus = document.getElementById('brittanyUtilStatus');
        const safetyFactor = document.getElementById('brittanySafetyFactor');

        fill.style.width = `${Math.min(percent, 100)}%`;
        utilPercent.textContent = `${Math.round(utilisation * 100)}%`;

        const sf = 1 / utilisation;
        safetyFactor.textContent = `Safety Factor: ${sf.toFixed(1)}√ó`;

        if (utilisation <= 0.8) {
            fill.style.background = '#22c55e';
            status.textContent = `‚úÖ OK - ${Math.round(utilisation * 100)}% utilised`;
            status.style.color = '#22c55e';
            utilPercent.className = 'utilisation-big ok';
            utilStatus.textContent = '‚úÖ YES - SAFE TO USE';
            utilStatus.style.color = '#22c55e';
        } else if (utilisation <= 1.0) {
            fill.style.background = '#f59e0b';
            status.textContent = `‚ö†Ô∏è OK - ${Math.round(utilisation * 100)}% utilised (close to limit)`;
            status.style.color = '#f59e0b';
            utilPercent.className = 'utilisation-big warning';
            utilStatus.textContent = '‚ö†Ô∏è MARGINAL - Consider larger size';
            utilStatus.style.color = '#f59e0b';
        } else {
            fill.style.background = '#ef4444';
            status.textContent = `‚ùå FAIL - ${Math.round(utilisation * 100)}% (exceeds capacity!)`;
            status.style.color = '#ef4444';
            utilPercent.className = 'utilisation-big fail';
            utilStatus.textContent = '‚ùå NO - WILL FAIL!';
            utilStatus.style.color = '#ef4444';
        }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // CHUCK TIMER FUNCTIONS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let chuckTimerInterval = null;
    let chuckTimerEndTime = null;
    let chuckCureMinutes = 60;

    function chuckStartTimer() {
        // Get current cure time
        const temp = chuckCurrentTemp || 20;
        const cureData = getCureTimeLocal(chuckType, temp);
        chuckCureMinutes = cureData.cureMin || 60;

        // Calculate end time
        const now = new Date();
        chuckTimerEndTime = new Date(now.getTime() + chuckCureMinutes * 60 * 1000);

        // Update UI
        document.getElementById('chuckTimerStart').style.display = 'none';
        document.getElementById('chuckTimerStop').style.display = 'inline-block';
        document.getElementById('chuckTimerProgress').style.display = 'block';
        document.getElementById('chuckTimerSection').classList.add('curing');

        // Show ready time
        const readyTime = chuckTimerEndTime.toLocaleTimeString('en-AU', { hour: '2-digit', minute: '2-digit' });
        document.getElementById('chuckReadyAt').textContent = `üéØ Ready at: ${readyTime}`;

        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Start countdown
        chuckTimerInterval = setInterval(chuckUpdateTimer, 1000);
        chuckUpdateTimer();

        document.getElementById('chuckConsole').textContent = `‚è±Ô∏è Timer started - Curing ${HILTI_DATA[chuckType].name} at ${temp}¬∞C`;
    }

    function chuckStopTimer() {
        if (chuckTimerInterval) {
            clearInterval(chuckTimerInterval);
            chuckTimerInterval = null;
        }

        document.getElementById('chuckTimerStart').style.display = 'inline-block';
        document.getElementById('chuckTimerStop').style.display = 'none';
        document.getElementById('chuckTimerProgress').style.display = 'none';
        document.getElementById('chuckTimerSection').classList.remove('curing');
        document.getElementById('chuckTimerDisplay').textContent = '--:--:--';
        document.getElementById('chuckReadyAt').textContent = 'Set anchors and start timer';
        document.getElementById('chuckTimerFill').style.width = '0%';

        document.getElementById('chuckConsole').textContent = 'üß™ Timer stopped';
    }

    function chuckUpdateTimer() {
        const now = new Date();
        const remaining = chuckTimerEndTime - now;

        if (remaining <= 0) {
            // Timer complete!
            clearInterval(chuckTimerInterval);
            chuckTimerInterval = null;

            document.getElementById('chuckTimerDisplay').textContent = '‚úÖ READY!';
            document.getElementById('chuckTimerDisplay').style.color = '#22c55e';
            document.getElementById('chuckReadyAt').textContent = 'üéâ Anchors fully cured!';
            document.getElementById('chuckTimerFill').style.width = '100%';
            document.getElementById('chuckTimerFill').style.background = '#22c55e';
            document.getElementById('chuckTimerSection').classList.remove('curing');
            document.getElementById('chuckTimerSection').style.borderColor = '#22c55e';

            // Send notification
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('‚ö° CHUCK says: Anchors Ready!', {
                    body: `${HILTI_DATA[chuckType].name} cure complete. Safe to load!`,
                    icon: 'üî©',
                    requireInteraction: true
                });
            }

            // Play sound alert (simple beep)
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                oscillator.start();
                setTimeout(() => { oscillator.stop(); audioCtx.close(); }, 300);
            } catch(e) {}

            document.getElementById('chuckConsole').textContent = '‚úÖ CURE COMPLETE! Anchors ready to load!';
            return;
        }

        // Calculate time remaining
        const hours = Math.floor(remaining / 3600000);
        const mins = Math.floor((remaining % 3600000) / 60000);
        const secs = Math.floor((remaining % 60000) / 1000);

        document.getElementById('chuckTimerDisplay').textContent =
            `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        document.getElementById('chuckTimerDisplay').style.color = '#f59e0b';

        // Update progress bar
        const totalMs = chuckCureMinutes * 60 * 1000;
        const elapsed = totalMs - remaining;
        const progress = (elapsed / totalMs) * 100;
        document.getElementById('chuckTimerFill').style.width = `${progress}%`;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // BRITTANY REPORT GENERATOR - Professional Engineering Report
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function brittanyGenerateReport() {
        const qty = parseInt(document.getElementById('brittanyQty').value) || 1;
        const concrete = parseInt(document.getElementById('brittanyConcrete').value);
        const substrateSelect = document.getElementById('brittanyConcrete');
        const substrateName = substrateSelect.options[substrateSelect.selectedIndex].text;
        const overhead = document.getElementById('brittanyOverhead').checked;
        const embedInput = document.getElementById('brittanyEmbed').value;
        const edgeInput = document.getElementById('brittanyEdge').value;
        const spacingInput = document.getElementById('brittanySpacing').value;
        const load = document.getElementById('brittanyLoad').value;
        const loadType = document.getElementById('brittanyLoadType').value;

        const fixing = FIXING_DATA[brittanyType];
        const sizeData = fixing.sizes[brittanySize];
        if (!sizeData) return;

        const [tensionKn, shearKn, minEmbed, minEdge, minSpacing, holeSize] = sizeData;
        const embed = embedInput ? parseInt(embedInput) : minEmbed;
        const edge = edgeInput ? parseInt(edgeInput) : minEdge;
        const spacing = spacingInput ? parseInt(spacingInput) : minSpacing;

        // Calculate all reduction factors for display
        const edgeFactor = edge < minEdge ? Math.max(0.5, edge / minEdge) : 1.0;
        const spacingFactor = spacing < minSpacing ? Math.max(0.5, spacing / minSpacing) : 1.0;
        let embedFactor = 1.0;
        if (brittanyType === 'chemset') {
            embedFactor = Math.min(2.0, Math.max(0.5, embed / minEmbed));
        } else if (embed < minEmbed) {
            embedFactor = Math.max(0.5, embed / minEmbed);
        }
        const concFactor = Math.sqrt(concrete / 32);
        const overheadFactor = overhead ? 0.5 : 1.0;
        const isMasonry = concrete <= 15 && !substrateName.includes('Concrete');
        const masonryFactor = (isMasonry && brittanyType !== 'chemset') ? 0.5 : 1.0;

        // Calculate per anchor values
        const tensionPerKg = Math.round(tensionKn * concFactor * overheadFactor * edgeFactor * embedFactor * masonryFactor * 102);
        const shearPerKg = Math.round(shearKn * concFactor * overheadFactor * edgeFactor * spacingFactor * masonryFactor * 102);

        const date = new Date();
        const dateStr = date.toLocaleDateString('en-AU', { year: 'numeric', month: 'long', day: 'numeric' });
        const timeStr = date.toLocaleTimeString('en-AU', { hour: '2-digit', minute: '2-digit' });
        const refNo = `JMS-${date.getFullYear()}${(date.getMonth()+1).toString().padStart(2,'0')}${date.getDate().toString().padStart(2,'0')}-${Math.random().toString(36).substr(2,6).toUpperCase()}`;

        let loadCheckHTML = '';
        let loadCheckCalcs = '';
        if (load) {
            const loadVal = parseInt(load);
            const capacity = loadType === 'tension' ? brittanyTotalTension : brittanyTotalShear;
            const util = (loadVal / capacity) * 100;
            const sf = capacity / loadVal;
            const passClass = util > 100 ? 'fail' : util > 80 ? 'warning' : 'pass';
            const passText = util > 100 ? 'FAILS' : 'PASSES';

            loadCheckHTML = `
            <div class="section">
                <h2>5. LOAD VERIFICATION</h2>
                <table>
                    <tr><th width="40%">Applied Load (P<sub>d</sub>)</th><td>${loadVal.toLocaleString()} kg (${loadType})</td></tr>
                    <tr><th>Design Capacity (œÜN<sub>Rd</sub>)</th><td>${capacity.toLocaleString()} kg</td></tr>
                    <tr><th>Utilisation Ratio</th><td class="${passClass}">${util.toFixed(1)}%</td></tr>
                    <tr><th>Safety Factor</th><td class="${passClass}">${sf.toFixed(2)}</td></tr>
                </table>
                <div class="result-box ${passClass}">
                    <strong>RESULT: ${passText}</strong><br>
                    ${util > 100 ? 'Applied load exceeds design capacity. Increase anchor size, quantity, or embedment.' :
                      util > 80 ? 'Utilisation within acceptable limits but close to capacity. Consider design margin.' :
                      'Applied load is within design capacity with adequate safety margin.'}
                </div>
            </div>`;

            loadCheckCalcs = `
                <tr><td>Load Check</td><td>P<sub>d</sub> ‚â§ œÜN<sub>Rd</sub></td><td>${loadVal.toLocaleString()} ‚â§ ${capacity.toLocaleString()}</td><td class="${passClass}">${passText}</td></tr>`;
        }

        const reportHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Anchor Design Report - Ref: ${refNo}</title>
    <style>
        @page { size: A4; margin: 20mm; }
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 11pt;
            line-height: 1.4;
            color: #1a1a1a;
            max-width: 210mm;
            margin: 0 auto;
            padding: 15mm;
            background: #fff;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 3px solid #1e40af;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .header-left h1 {
            margin: 0;
            font-size: 18pt;
            color: #1e40af;
            font-weight: 700;
        }
        .header-left p { margin: 5px 0 0 0; color: #666; font-size: 10pt; }
        .header-right { text-align: right; font-size: 9pt; color: #666; }
        .ref-number { font-size: 11pt; font-weight: bold; color: #1e40af; }

        /* Company Logo Area */
        .logo-area {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            margin-bottom: 5px;
            font-weight: bold;
        }

        /* Sections */
        .section { margin-bottom: 20px; page-break-inside: avoid; }
        .section h2 {
            font-size: 12pt;
            color: #1e40af;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 5px;
            margin: 0 0 10px 0;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 10pt;
        }
        th, td {
            padding: 8px 10px;
            text-align: left;
            border: 1px solid #d1d5db;
            vertical-align: top;
        }
        th {
            background: #f3f4f6;
            font-weight: 600;
            color: #374151;
        }

        /* Capacity highlight */
        .capacity-value {
            font-size: 14pt;
            font-weight: bold;
            color: #059669;
        }
        .capacity-table td:last-child {
            text-align: center;
            font-weight: bold;
        }

        /* Status colors */
        .pass { color: #059669; }
        .warning { color: #d97706; }
        .fail { color: #dc2626; }

        /* Result box */
        .result-box {
            padding: 12px 15px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 4px solid;
        }
        .result-box.pass { background: #ecfdf5; border-color: #059669; }
        .result-box.warning { background: #fffbeb; border-color: #d97706; }
        .result-box.fail { background: #fef2f2; border-color: #dc2626; }

        /* Calculation box */
        .calc-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            padding: 12px;
            margin: 10px 0;
            font-family: 'Consolas', monospace;
            font-size: 9pt;
        }
        .calc-box .formula { color: #1e40af; font-weight: bold; }
        .calc-box .value { color: #059669; }

        /* Two column layout */
        .two-col { display: flex; gap: 20px; }
        .two-col > div { flex: 1; }

        /* Reduction factors */
        .factor-table td:nth-child(2) { text-align: center; font-family: monospace; }
        .factor-table td:nth-child(3) { text-align: center; }
        .factor-reduced { background: #fef3c7 !important; }

        /* Footer */
        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 2px solid #e5e7eb;
            font-size: 9pt;
            color: #6b7280;
        }
        .footer-grid { display: flex; justify-content: space-between; }

        /* Disclaimer */
        .disclaimer {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 5px;
            padding: 12px;
            margin-top: 15px;
            font-size: 9pt;
        }
        .disclaimer strong { color: #92400e; }

        /* Standards reference */
        .standards {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 5px;
            padding: 10px;
            font-size: 9pt;
        }

        /* Print styles */
        @media print {
            body { padding: 0; }
            .section { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <div class="logo-area">J&M ART STEEL FABRICATION P/L</div>
            <div style="font-size:9pt;color:#374151;margin:5px 0;">
                Unit 2/ 28-30 Lillian Flower Place, Marrickville NSW 2204<br>
                T: 02 8021 6707 | M: 0421 470 043
            </div>
            <h1>ANCHOR DESIGN CALCULATION</h1>
            <p>Post-Installed Anchor Capacity Assessment</p>
        </div>
        <div class="header-right">
            <div class="ref-number">Ref: ${refNo}</div>
            <div>Date: ${dateStr}</div>
            <div>Time: ${timeStr}</div>
            <div>Page 1 of 1</div>
        </div>
    </div>

    <div class="section">
        <h2>1. PROJECT INFORMATION</h2>
        <div class="two-col">
            <table>
                <tr><th width="40%">Document Type</th><td>Anchor Capacity Calculation</td></tr>
                <tr><th>Calculation By</th><td>Scott Seeho - J&M Artsteel</td></tr>
                <tr><th>Status</th><td>For Construction / Reference</td></tr>
            </table>
            <table>
                <tr><th width="40%">Reference No.</th><td>${refNo}</td></tr>
                <tr><th>Date Issued</th><td>${dateStr}</td></tr>
                <tr><th>Revision</th><td>0 (Original Issue)</td></tr>
            </table>
        </div>
    </div>

    <div class="section">
        <h2>2. ANCHOR SPECIFICATION</h2>
        <table>
            <tr>
                <th width="25%">Anchor Type</th>
                <td width="25%">${fixing.name}</td>
                <th width="25%">Size</th>
                <td width="25%">${brittanySize}</td>
            </tr>
            <tr>
                <th>Quantity</th>
                <td>${qty} No.</td>
                <th>Drill Hole Size</th>
                <td>√ò${holeSize}mm</td>
            </tr>
            <tr>
                <th>Anchor Category</th>
                <td>${brittanyType === 'chemset' ? 'Chemical (Bonded)' : 'Mechanical (Expansion)'}</td>
                <th>Installation</th>
                <td>${overhead ? 'Overhead / Cracked Concrete' : 'Standard (Downward)'}</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <h2>3. BASE MATERIAL & INSTALLATION PARAMETERS</h2>
        <div class="two-col">
            <div>
                <table>
                    <tr><th colspan="2" style="background:#dbeafe">Substrate Properties</th></tr>
                    <tr><th width="50%">Material</th><td>${substrateName}</td></tr>
                    <tr><th>Compressive Strength</th><td>f'c = ${concrete} MPa</td></tr>
                    <tr><th>Condition</th><td>${overhead ? 'Cracked / Overhead' : 'Uncracked / Sound'}</td></tr>
                </table>
            </div>
            <div>
                <table>
                    <tr><th colspan="3" style="background:#dbeafe">Installation Geometry</th></tr>
                    <tr><th width="40%">Parameter</th><th width="30%">Actual</th><th width="30%">Min Req'd</th></tr>
                    <tr ${embed < minEmbed ? 'class="factor-reduced"' : ''}><td>Embedment (h<sub>ef</sub>)</td><td>${embed}mm</td><td>${minEmbed}mm</td></tr>
                    <tr ${edge < minEdge ? 'class="factor-reduced"' : ''}><td>Edge Distance (c)</td><td>${edge}mm</td><td>${minEdge}mm</td></tr>
                    <tr ${spacing < minSpacing ? 'class="factor-reduced"' : ''}><td>Spacing (s)</td><td>${spacing}mm</td><td>${minSpacing}mm</td></tr>
                </table>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>4. DESIGN CAPACITY CALCULATION</h2>

        <h3 style="font-size:11pt;color:#374151;margin:15px 0 10px 0;">4.1 Reduction Factors</h3>
        <table class="factor-table">
            <tr>
                <th width="35%">Factor</th>
                <th width="20%">Symbol</th>
                <th width="20%">Value</th>
                <th width="25%">Notes</th>
            </tr>
            <tr ${concFactor !== 1.0 ? 'class="factor-reduced"' : ''}>
                <td>Concrete Strength Factor</td>
                <td>œà<sub>c</sub></td>
                <td>${concFactor.toFixed(3)}</td>
                <td>‚àö(f'c/32) = ‚àö(${concrete}/32)</td>
            </tr>
            <tr ${edgeFactor < 1.0 ? 'class="factor-reduced"' : ''}>
                <td>Edge Distance Factor</td>
                <td>œà<sub>ed</sub></td>
                <td>${edgeFactor.toFixed(2)}</td>
                <td>${edgeFactor < 1.0 ? 'Reduced: c < c,min' : 'Full: c ‚â• c,min'}</td>
            </tr>
            <tr ${spacingFactor < 1.0 ? 'class="factor-reduced"' : ''}>
                <td>Spacing Factor</td>
                <td>œà<sub>s</sub></td>
                <td>${spacingFactor.toFixed(2)}</td>
                <td>${spacingFactor < 1.0 ? 'Reduced: s < s,min' : 'Full: s ‚â• s,min'}</td>
            </tr>
            <tr ${embedFactor !== 1.0 ? 'class="factor-reduced"' : ''}>
                <td>Embedment Factor</td>
                <td>œà<sub>h</sub></td>
                <td>${embedFactor.toFixed(2)}</td>
                <td>${brittanyType === 'chemset' ? 'Chemical anchor scaling' : embedFactor < 1.0 ? 'Reduced embedment' : 'Standard'}</td>
            </tr>
            <tr ${overheadFactor < 1.0 ? 'class="factor-reduced"' : ''}>
                <td>Overhead/Cracked Factor</td>
                <td>œà<sub>cr</sub></td>
                <td>${overheadFactor.toFixed(2)}</td>
                <td>${overhead ? 'Applied: 50% reduction' : 'Not applied'}</td>
            </tr>
            ${isMasonry ? `<tr class="factor-reduced">
                <td>Masonry Substrate Factor</td>
                <td>œà<sub>m</sub></td>
                <td>${masonryFactor.toFixed(2)}</td>
                <td>Mechanical anchor in masonry</td>
            </tr>` : ''}
        </table>

        <h3 style="font-size:11pt;color:#374151;margin:15px 0 10px 0;">4.2 Capacity Calculation</h3>
        <div class="calc-box">
            <div><span class="formula">Base Tension Capacity:</span> N<sub>Rk</sub> = ${tensionKn} kN (manufacturer data)</div>
            <div><span class="formula">Base Shear Capacity:</span> V<sub>Rk</sub> = ${shearKn} kN (manufacturer data)</div>
            <br>
            <div><span class="formula">Design Tension (per anchor):</span></div>
            <div>œÜN<sub>Rd</sub> = N<sub>Rk</sub> √ó œà<sub>c</sub> √ó œà<sub>ed</sub> √ó œà<sub>h</sub> √ó œà<sub>cr</sub> ${isMasonry ? '√ó œà<sub>m</sub>' : ''} √ó 102</div>
            <div>œÜN<sub>Rd</sub> = ${tensionKn} √ó ${concFactor.toFixed(3)} √ó ${edgeFactor.toFixed(2)} √ó ${embedFactor.toFixed(2)} √ó ${overheadFactor.toFixed(2)} ${isMasonry ? '√ó 0.50' : ''} √ó 102</div>
            <div><span class="value">œÜN<sub>Rd</sub> = ${tensionPerKg.toLocaleString()} kg</span></div>
            <br>
            <div><span class="formula">Design Shear (per anchor):</span></div>
            <div>œÜV<sub>Rd</sub> = V<sub>Rk</sub> √ó œà<sub>c</sub> √ó œà<sub>ed</sub> √ó œà<sub>s</sub> √ó œà<sub>cr</sub> ${isMasonry ? '√ó œà<sub>m</sub>' : ''} √ó 102</div>
            <div>œÜV<sub>Rd</sub> = ${shearKn} √ó ${concFactor.toFixed(3)} √ó ${edgeFactor.toFixed(2)} √ó ${spacingFactor.toFixed(2)} √ó ${overheadFactor.toFixed(2)} ${isMasonry ? '√ó 0.50' : ''} √ó 102</div>
            <div><span class="value">œÜV<sub>Rd</sub> = ${shearPerKg.toLocaleString()} kg</span></div>
        </div>

        <h3 style="font-size:11pt;color:#374151;margin:15px 0 10px 0;">4.3 Total Design Capacity</h3>
        <table class="capacity-table">
            <tr>
                <th width="30%">Load Type</th>
                <th width="25%">Per Anchor</th>
                <th width="20%">Quantity</th>
                <th width="25%">Total Capacity</th>
            </tr>
            <tr>
                <td><strong>Tension</strong></td>
                <td>${tensionPerKg.toLocaleString()} kg</td>
                <td>√ó ${qty}</td>
                <td class="capacity-value">${brittanyTotalTension.toLocaleString()} kg</td>
            </tr>
            <tr>
                <td><strong>Shear</strong></td>
                <td>${shearPerKg.toLocaleString()} kg</td>
                <td>√ó ${qty}</td>
                <td class="capacity-value">${brittanyTotalShear.toLocaleString()} kg</td>
            </tr>
        </table>
    </div>

    ${loadCheckHTML}

    <div class="section">
        <h2>${load ? '6' : '5'}. REFERENCES & STANDARDS</h2>
        <div class="standards">
            <strong>Applicable Standards:</strong>
            <ul style="margin:5px 0;padding-left:20px;">
                <li>AS 5216:2021 - Design of post-installed and cast-in fastenings in concrete</li>
                <li>AS 3600:2018 - Concrete structures</li>
                <li>Manufacturer technical data sheet for ${fixing.name}</li>
            </ul>
        </div>
    </div>

    <div class="disclaimer">
        <strong>‚ö†Ô∏è DISCLAIMER & LIMITATIONS:</strong>
        <ul style="margin:5px 0;padding-left:20px;">
            <li>This calculation is for preliminary design reference only and must be verified by a qualified structural engineer.</li>
            <li>Capacities are based on manufacturer published data for ${substrateName} substrate conditions.</li>
            <li>Site-specific factors including concrete quality, reinforcement proximity, and edge conditions must be verified.</li>
            <li>Installation must be performed in accordance with manufacturer specifications and relevant Australian Standards.</li>
            <li>Combined tension and shear loading requires interaction check per AS 5216.</li>
            <li>The designer accepts no liability for use of this document without independent verification.</li>
        </ul>
    </div>

    <div class="signature-section" style="margin-top:30px;padding:20px;border:2px solid #1e40af;border-radius:8px;background:#f8fafc;">
        <h3 style="margin:0 0 15px 0;color:#1e40af;font-size:12pt;">CERTIFICATION & APPROVAL</h3>
        <div style="display:flex;gap:40px;">
            <div style="flex:1;">
                <p style="margin:0 0 5px 0;font-size:10pt;color:#374151;"><strong>Prepared By:</strong></p>
                <div style="border-bottom:1px solid #000;height:50px;margin-bottom:5px;"></div>
                <p style="margin:0;font-size:10pt;"><strong>Scott Seeho</strong></p>
                <p style="margin:0;font-size:9pt;color:#6b7280;">Manager | J&M Art Steel Fabrication P/L</p>
            </div>
            <div style="flex:1;">
                <p style="margin:0 0 5px 0;font-size:10pt;color:#374151;"><strong>Date:</strong></p>
                <div style="border-bottom:1px solid #000;height:50px;margin-bottom:5px;"></div>
                <p style="margin:0;font-size:9pt;color:#6b7280;">${dateStr}</p>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="footer-grid">
            <div>
                <strong>J&M Art Steel Fabrication P/L</strong><br>
                Unit 2/ 28-30 Lillian Flower Place, Marrickville NSW 2204
            </div>
            <div style="text-align:center;">
                <strong>Document Reference:</strong><br>
                ${refNo}
            </div>
            <div style="text-align:right;">
                <strong>Issue Date:</strong> ${dateStr}<br>
                <strong>ABN:</strong> 94 164 562 207
            </div>
        </div>
    </div>
</body>
</html>`;

        // Create and download the report
        const blob = new Blob([reportHTML], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Anchor_Design_Report_${refNo}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        document.getElementById('brittanyConsole').textContent = `üìÑ Report ${refNo} downloaded! Open in browser ‚Üí Print ‚Üí Save as PDF`;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // INITIALIZATION
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    document.addEventListener('DOMContentLoaded', () => {
        hobartUpdate();
        // IGOR dropdowns are already in HTML
        chuckGetLocation(); // Get weather/temp on load
        chuckUpdateSizes(); // Set up size buttons for default type
        chuckCalculate();
        brittanyUpdateSizes(); // Set up size buttons for default type
        brittanyCalculate();
    });
    </script>
</body>
</html>

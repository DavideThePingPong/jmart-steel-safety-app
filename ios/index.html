<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>JMart Steel Safety</title>

  <!-- PWA Meta Tags -->
  <meta name="application-name" content="JMart Safety">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="JMart Safety">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#ea580c">
  <meta name="msapplication-TileColor" content="#ea580c">
  <meta name="msapplication-tap-highlight" content="no">

  <!-- App Description for SEO/Sharing -->
  <meta name="description" content="JMart Steel Safety Management App - Pre-Start Checklists, Site Inspections, ITP Forms, Toolbox Talks, and Incident Reports">

  <!-- Favicon and App Icons (Base64 embedded) -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23ea580c'/><text x='50' y='65' font-size='50' text-anchor='middle' fill='white'>ğŸ›¡ï¸</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' rx='40' fill='%23ea580c'/><text x='90' y='115' font-size='80' text-anchor='middle' fill='white'>ğŸ›¡ï¸</text></svg>">

  <!-- iOS PWA Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- iOS-specific Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon-180x180.png">
  <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-touch-icon-167x167.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120x120.png">

  <!-- iOS Safari Splash Screens -->
  <link rel="apple-touch-startup-image" href="icons/apple-splash-2048-2732.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="icons/apple-splash-1668-2388.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="icons/apple-splash-1536-2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)">
  <link rel="apple-touch-startup-image" href="icons/apple-splash-1290-2796.png" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="icons/apple-splash-1179-2556.png" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)">
  <link rel="apple-touch-startup-image" href="icons/apple-splash-1170-2532.png" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)">

  <!-- iOS Service Worker Registration -->
  <script>
    // Register Service Worker for iOS
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => {
            console.log('[iOS] Service Worker registered:', reg.scope);
            // Check for updates periodically
            setInterval(() => reg.update(), 60000);
          })
          .catch(err => console.log('[iOS] SW registration failed:', err));
      });
    }

    // iOS PWA Detection
    const isIOSPWA = window.navigator.standalone === true;
    if (isIOSPWA) {
      document.documentElement.classList.add('ios-pwa');
      console.log('[iOS] Running as installed PWA');
    }
  </script>

  <!-- Scripts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    /* Base styles */
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    * {
      -webkit-tap-highlight-color: transparent;
      box-sizing: border-box;
    }

    /* Safe area padding for notched devices */
    .safe-top { padding-top: env(safe-area-inset-top); }
    .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }

    /* Smooth scrolling */
    html { scroll-behavior: smooth; }

    /* Better touch targets */
    button, select, input, textarea {
      min-height: 44px;
      font-size: 16px; /* Prevents zoom on iOS */
    }

    /* Loading spinner */
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #ea580c;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Pull to refresh indicator */
    .pull-indicator {
      transition: transform 0.2s ease;
    }

    /* Prevent text selection on buttons */
    button {
      -webkit-user-select: none;
      user-select: none;
    }

    /* Better focus states for accessibility */
    button:focus, input:focus, select:focus, textarea:focus {
      outline: 2px solid #ea580c;
      outline-offset: 2px;
    }

    /* Hide scrollbar but keep functionality */
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* Install prompt banner */
    .install-banner {
      position: fixed;
      bottom: 70px;
      left: 10px;
      right: 10px;
      background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%);
      color: white;
      padding: 12px 16px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      z-index: 1000;
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp {
      from { transform: translateY(100px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* Offline indicator */
    .offline-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #fbbf24;
      color: #92400e;
      text-align: center;
      padding: 8px;
      font-size: 14px;
      font-weight: 500;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;
    const {
      Shield, ClipboardCheck, AlertTriangle, Users, Plus, ChevronRight, ChevronLeft,
      Check, X, Calendar, User, MapPin, Building, Wrench, AlertCircle, CheckCircle,
      Home, Menu, Bell, Settings, Trash2, Phone, Edit3, Copy, Clock, Download,
      FileText, Camera, Image, StickyNote, Clipboard
    } = lucide;

    // Icon component wrapper
    function Icon({ icon, size = 24, className = "" }) {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current && icon) {
          ref.current.innerHTML = '';
          const svg = icon;
          svg.setAttribute('width', size);
          svg.setAttribute('height', size);
          if (className) {
            className.split(' ').forEach(c => c && svg.classList.add(c));
          }
          ref.current.appendChild(svg.cloneNode(true));
        }
      }, [icon, size, className]);
      return <span ref={ref} style={{display: 'inline-flex', alignItems: 'center'}}></span>;
    }

    // Simple icon rendering function
    function LucideIcon({ name, size = 24, className = "" }) {
      const iconRef = useRef(null);
      useEffect(() => {
        if (iconRef.current) {
          iconRef.current.innerHTML = '';
          lucide.createIcons({
            icons: { [name]: lucide.icons[name] },
            attrs: { width: size, height: size, class: className }
          });
        }
      }, [name, size, className]);
      return <i ref={iconRef} data-lucide={name} style={{width: size, height: size}}></i>;
    }

    // Signature Pad Component
    function SignaturePad({ onSave, onCancel, name }) {
      const canvasRef = useRef(null);
      const [isDrawing, setIsDrawing] = useState(false);
      const [hasSignature, setHasSignature] = useState(false);

      const getCoordinates = (e) => {
        const canvas = canvasRef.current;
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        if (e.touches) {
          return { x: (e.touches[0].clientX - rect.left) * scaleX, y: (e.touches[0].clientY - rect.top) * scaleY };
        }
        return { x: (e.clientX - rect.left) * scaleX, y: (e.clientY - rect.top) * scaleY };
      };

      const startDrawing = (e) => {
        e.preventDefault();
        const ctx = canvasRef.current.getContext('2d');
        const { x, y } = getCoordinates(e);
        ctx.beginPath();
        ctx.moveTo(x, y);
        setIsDrawing(true);
      };

      const draw = (e) => {
        if (!isDrawing) return;
        e.preventDefault();
        const ctx = canvasRef.current.getContext('2d');
        const { x, y } = getCoordinates(e);
        ctx.lineTo(x, y);
        ctx.strokeStyle = '#1a1a1a';
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.stroke();
        setHasSignature(true);
      };

      const stopDrawing = () => setIsDrawing(false);
      const clearSignature = () => {
        const ctx = canvasRef.current.getContext('2d');
        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
        setHasSignature(false);
      };
      const saveSignature = () => onSave(canvasRef.current.toDataURL('image/png'));

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl w-full max-w-md">
            <div className="p-4 border-b">
              <h3 className="font-semibold text-gray-800">Sign: {name}</h3>
              <p className="text-sm text-gray-500">Draw your signature below</p>
            </div>
            <div className="p-4">
              <div className="border-2 border-gray-300 rounded-lg bg-gray-50 relative">
                <canvas ref={canvasRef} width={350} height={150} className="w-full touch-none"
                  onMouseDown={startDrawing} onMouseMove={draw} onMouseUp={stopDrawing} onMouseLeave={stopDrawing}
                  onTouchStart={startDrawing} onTouchMove={draw} onTouchEnd={stopDrawing} />
                <div className="absolute bottom-2 left-2 right-2 border-t border-gray-400"></div>
                <span className="absolute bottom-3 left-3 text-xs text-gray-400">Sign here</span>
              </div>
            </div>
            <div className="p-4 border-t flex gap-3">
              <button onClick={clearSignature} className="flex-1 border border-gray-300 text-gray-700 py-2 rounded-lg">Clear</button>
              <button onClick={onCancel} className="flex-1 border border-gray-300 text-gray-700 py-2 rounded-lg">Cancel</button>
              <button onClick={saveSignature} disabled={!hasSignature} className="flex-1 bg-green-600 text-white py-2 rounded-lg disabled:bg-gray-300">Save</button>
            </div>
          </div>
        </div>
      );
    }

    // Note Media Box Component
    function NoteMediaBox({ label, iconName, value, notes, media, onValueChange, onAddNote, onAddMedia, onRemoveNote, onRemoveMedia }) {
      const fileInputRef = useRef(null);
      const [showNoteInput, setShowNoteInput] = useState(false);
      const [newNote, setNewNote] = useState('');

      const handleAddNote = () => {
        if (newNote.trim()) {
          onAddNote(newNote.trim());
          setNewNote('');
          setShowNoteInput(false);
        }
      };

      const handleMediaCapture = (e) => {
        const files = e.target.files;
        if (files && files.length > 0) {
          Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = (event) => onAddMedia({ name: file.name, type: file.type, data: event.target.result });
            reader.readAsDataURL(file);
          });
        }
        e.target.value = '';
      };

      return (
        <div className="bg-white rounded-xl p-4 shadow-sm space-y-3">
          <h4 className="font-semibold text-gray-800 text-orange-600">{label}</h4>
          <textarea value={value} onChange={(e) => onValueChange(e.target.value)}
            className="w-full border border-gray-300 rounded-lg p-3 text-sm min-h-[80px]"
            placeholder={`Enter ${label.toLowerCase()}...`} />
          <div className="flex gap-2">
            <button onClick={() => setShowNoteInput(!showNoteInput)}
              className="flex-1 bg-blue-50 border border-blue-200 text-blue-700 py-2 px-3 rounded-lg text-sm font-medium">
              ğŸ“ Add Note
            </button>
            <button onClick={() => fileInputRef.current?.click()}
              className="flex-1 bg-purple-50 border border-purple-200 text-purple-700 py-2 px-3 rounded-lg text-sm font-medium">
              ğŸ“· Camera
            </button>
            <button onClick={() => fileInputRef.current?.click()}
              className="flex-1 bg-green-50 border border-green-200 text-green-700 py-2 px-3 rounded-lg text-sm font-medium">
              ğŸ–¼ï¸ Gallery
            </button>
            <input ref={fileInputRef} type="file" accept="image/*" capture="environment" multiple onChange={handleMediaCapture} className="hidden" />
          </div>
          {showNoteInput && (
            <div className="flex gap-2">
              <input type="text" value={newNote} onChange={(e) => setNewNote(e.target.value)}
                className="flex-1 border border-gray-300 rounded-lg p-2 text-sm" placeholder="Type your note..."
                onKeyPress={(e) => e.key === 'Enter' && handleAddNote()} />
              <button onClick={handleAddNote} className="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">Add</button>
            </div>
          )}
          {notes && notes.length > 0 && (
            <div className="space-y-2">
              <p className="text-xs font-medium text-gray-500 uppercase">Notes:</p>
              {notes.map((note, idx) => (
                <div key={idx} className="flex items-start justify-between bg-blue-50 p-2 rounded-lg">
                  <p className="text-sm text-blue-800">{note}</p>
                  <button onClick={() => onRemoveNote(idx)} className="text-blue-500 ml-2">âœ•</button>
                </div>
              ))}
            </div>
          )}
          {media && media.length > 0 && (
            <div className="space-y-2">
              <p className="text-xs font-medium text-gray-500 uppercase">Photos:</p>
              <div className="grid grid-cols-3 gap-2">
                {media.map((item, idx) => (
                  <div key={idx} className="relative">
                    <img src={item.data} alt={item.name} className="w-full h-20 object-cover rounded-lg" />
                    <button onClick={() => onRemoveMedia(idx)} className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs">âœ•</button>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    }

    // Main App
    function JMartSteelSafetyApp() {
      const [currentView, setCurrentView] = useState('dashboard');
      const [menuOpen, setMenuOpen] = useState(false);
      const [forms, setForms] = useState([]);
      const [sites, setSites] = useState([]);
      const [isOnline, setIsOnline] = useState(navigator.onLine);
      const [showInstallPrompt, setShowInstallPrompt] = useState(false);
      const [deferredPrompt, setDeferredPrompt] = useState(null);
      const [lastSynced, setLastSynced] = useState(null);

      // Load saved data
      useEffect(() => {
        const savedForms = localStorage.getItem('jmart-safety-forms');
        if (savedForms) setForms(JSON.parse(savedForms));
        const savedSites = localStorage.getItem('jmart-safety-sites');
        if (savedSites) setSites(JSON.parse(savedSites));
        const lastSync = localStorage.getItem('jmart-last-sync');
        if (lastSync) setLastSynced(lastSync);
      }, []);

      // Save forms
      useEffect(() => {
        if (forms.length > 0) {
          localStorage.setItem('jmart-safety-forms', JSON.stringify(forms));
          localStorage.setItem('jmart-last-sync', new Date().toISOString());
          setLastSynced(new Date().toISOString());
        }
      }, [forms]);

      // Save sites
      useEffect(() => {
        if (sites.length > 0) localStorage.setItem('jmart-safety-sites', JSON.stringify(sites));
      }, [sites]);

      // Online/Offline detection
      useEffect(() => {
        const handleOnline = () => setIsOnline(true);
        const handleOffline = () => setIsOnline(false);
        window.addEventListener('online', handleOnline);
        window.addEventListener('offline', handleOffline);
        return () => {
          window.removeEventListener('online', handleOnline);
          window.removeEventListener('offline', handleOffline);
        };
      }, []);

      // PWA Install prompt
      useEffect(() => {
        const handler = (e) => {
          e.preventDefault();
          setDeferredPrompt(e);
          // Show install prompt after 30 seconds if not dismissed
          const dismissed = localStorage.getItem('jmart-install-dismissed');
          if (!dismissed) {
            setTimeout(() => setShowInstallPrompt(true), 30000);
          }
        };
        window.addEventListener('beforeinstallprompt', handler);
        return () => window.removeEventListener('beforeinstallprompt', handler);
      }, []);

      const handleInstall = async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          if (outcome === 'accepted') {
            setShowInstallPrompt(false);
          }
          setDeferredPrompt(null);
        }
      };

      const dismissInstall = () => {
        setShowInstallPrompt(false);
        localStorage.setItem('jmart-install-dismissed', 'true');
      };

      const addForm = (formType, formData) => {
        const newForm = { id: Date.now(), type: formType, data: formData, createdAt: new Date().toISOString(), status: 'completed' };
        setForms([newForm, ...forms]);
      };

      const previousPrestarts = forms.filter(f => f.type === 'prestart');

      const navItems = [
        { id: 'dashboard', label: 'Dashboard', emoji: 'ğŸ ' },
        { id: 'training', label: 'Training', emoji: 'ğŸ“' },
        { id: 'prestart', label: 'Pre-Start Checks', emoji: 'ğŸ“‹' },
        { id: 'steel-itp', label: 'Steel ITP', emoji: 'ğŸ”©' },
        { id: 'inspection', label: 'Site Inspection', emoji: 'ğŸ”' },
        { id: 'itp', label: 'ITP Form', emoji: 'ğŸ“' },
        { id: 'incidents', label: 'Incident Reports', emoji: 'âš ï¸' },
        { id: 'toolbox', label: 'Toolbox Talks', emoji: 'ğŸ‘¥' },
        { id: 'emergency', label: 'Emergency Info', emoji: 'ğŸ“' },
        { id: 'settings', label: 'Settings', emoji: 'âš™ï¸' },
      ];

      return (
        <div className="min-h-screen bg-gray-100 flex flex-col safe-top">
          {/* Offline Banner */}
          {!isOnline && (
            <div className="offline-banner">
              âš ï¸ You're offline - Data will sync when connected
            </div>
          )}

          {/* Install Prompt Banner */}
          {showInstallPrompt && (
            <div className="install-banner">
              <div className="flex items-center gap-3">
                <span className="text-2xl">ğŸ“²</span>
                <div>
                  <p className="font-semibold text-sm">Install JMart Safety</p>
                  <p className="text-xs opacity-80">Quick access from home screen</p>
                </div>
              </div>
              <div className="flex gap-2">
                <button onClick={dismissInstall} className="text-white opacity-70 px-2 py-1 text-sm">Later</button>
                <button onClick={handleInstall} className="bg-white text-orange-600 px-3 py-1 rounded-lg text-sm font-semibold">Install</button>
              </div>
            </div>
          )}

          <header className="bg-orange-600 text-white p-4 flex items-center justify-between shadow-lg sticky top-0 z-50 safe-top">
            <button onClick={() => setMenuOpen(!menuOpen)} className="p-2 hover:bg-orange-700 rounded-lg text-xl" aria-label="Menu">â˜°</button>
            <div className="flex items-center gap-2">
              <span className="text-2xl">ğŸ›¡ï¸</span>
              <div>
                <h1 className="font-bold text-lg leading-tight">JMart Steel</h1>
                <p className="text-xs text-orange-200">{isOnline ? 'Safety Management' : 'ğŸ“´ Offline Mode'}</p>
              </div>
            </div>
            <div className="flex items-center gap-1">
              {!isOnline && <span className="text-yellow-300 text-sm">â—</span>}
              <button className="p-2 hover:bg-orange-700 rounded-lg text-xl" aria-label="Notifications">ğŸ””</button>
            </div>
          </header>

          {menuOpen && (
            <div className="fixed inset-0 z-40 flex">
              <div className="fixed inset-0 bg-black bg-opacity-50" onClick={() => setMenuOpen(false)}></div>
              <div className="relative w-72 bg-white shadow-xl">
                <div className="p-4 bg-orange-600 text-white">
                  <p className="font-semibold">JMart Steel</p>
                  <p className="text-sm text-orange-200">NSW Operations</p>
                </div>
                <nav className="p-2">
                  {navItems.map((item) => (
                    <button key={item.id} onClick={() => { setCurrentView(item.id); setMenuOpen(false); }}
                      className={`w-full flex items-center gap-3 p-3 rounded-lg text-left ${currentView === item.id ? 'bg-orange-100 text-orange-600' : 'text-gray-700 hover:bg-gray-100'}`}>
                      <span>{item.emoji}</span>
                      <span className="font-medium">{item.label}</span>
                    </button>
                  ))}
                </nav>
              </div>
            </div>
          )}

          <main className="flex-1 p-4 pb-20">
            {currentView === 'dashboard' && <Dashboard setCurrentView={setCurrentView} forms={forms} />}
            {currentView === 'training' && <TrainingView />}
            {currentView === 'prestart' && <PrestartView onSubmit={(data) => addForm('prestart', data)} previousPrestarts={previousPrestarts} sites={sites} />}
            {currentView === 'steel-itp' && <SteelITPView onSubmit={(data) => addForm('steel-itp', data)} sites={sites} />}
            {currentView === 'inspection' && <SubcontractorInspectionView onSubmit={(data) => addForm('inspection', data)} sites={sites} />}
            {currentView === 'itp' && <ITPFormView onSubmit={(data) => addForm('itp', data)} sites={sites} />}
            {currentView === 'incidents' && <IncidentView onSubmit={(data) => addForm('incident', data)} />}
            {currentView === 'toolbox' && <ToolboxView onSubmit={(data) => addForm('toolbox', data)} sites={sites} />}
            {currentView === 'emergency' && <EmergencyView />}
            {currentView === 'settings' && <SettingsView sites={sites} onUpdateSites={setSites} />}
          </main>

          <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around py-2 px-1 z-30">
            {[
              { id: 'dashboard', emoji: 'ğŸ ', label: 'Home' },
              { id: 'training', emoji: 'ğŸ“', label: 'Training' },
              { id: 'prestart', emoji: 'ğŸ“‹', label: 'Pre-Start' },
              { id: 'incidents', emoji: 'âš ï¸', label: 'Incidents' },
              { id: 'emergency', emoji: 'ğŸ“', label: 'Emergency' },
            ].map((item) => (
              <button key={item.id} onClick={() => setCurrentView(item.id)}
                className={`flex flex-col items-center p-2 rounded-lg ${currentView === item.id ? 'text-orange-600' : 'text-gray-500'}`}>
                <span className="text-xl">{item.emoji}</span>
                <span className="text-xs mt-1">{item.label}</span>
              </button>
            ))}
          </nav>
        </div>
      );
    }

    // Dashboard
    function Dashboard({ setCurrentView, forms }) {
      const todayDate = new Date().toLocaleDateString('en-AU', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });

      return (
        <div className="space-y-6">
          <div className="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-4 text-white">
            <h2 className="text-xl font-bold">Welcome Back!</h2>
            <p className="text-orange-100 text-sm mt-1">Stay safe on site today</p>
            <div className="mt-3 flex items-center gap-2 text-sm">
              <span>ğŸ“…</span>
              <span>{todayDate}</span>
            </div>
          </div>

          <div className="grid grid-cols-5 gap-2">
            <div className="bg-white rounded-xl p-2 shadow-sm">
              <div className="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center mb-1">
                <span className="text-white font-bold text-xs">{forms.filter(f => f.type === 'prestart').length}</span>
              </div>
              <p className="text-gray-600 text-xs">Pre-Start</p>
            </div>
            <div className="bg-white rounded-xl p-2 shadow-sm">
              <div className="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center mb-1">
                <span className="text-white font-bold text-xs">{forms.filter(f => f.type === 'inspection').length}</span>
              </div>
              <p className="text-gray-600 text-xs">Inspect</p>
            </div>
            <div className="bg-white rounded-xl p-2 shadow-sm">
              <div className="w-8 h-8 bg-indigo-500 rounded-lg flex items-center justify-center mb-1">
                <span className="text-white font-bold text-xs">{forms.filter(f => f.type === 'itp').length}</span>
              </div>
              <p className="text-gray-600 text-xs">ITP</p>
            </div>
            <div className="bg-white rounded-xl p-2 shadow-sm">
              <div className="w-8 h-8 bg-red-500 rounded-lg flex items-center justify-center mb-1">
                <span className="text-white font-bold text-xs">{forms.filter(f => f.type === 'incident').length}</span>
              </div>
              <p className="text-gray-600 text-xs">Incident</p>
            </div>
            <div className="bg-white rounded-xl p-2 shadow-sm">
              <div className="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center mb-1">
                <span className="text-white font-bold text-xs">{forms.filter(f => f.type === 'toolbox').length}</span>
              </div>
              <p className="text-gray-600 text-xs">Toolbox</p>
            </div>
          </div>

          <div>
            <h3 className="font-semibold text-gray-800 mb-3">Quick Actions</h3>
            <div className="grid grid-cols-3 gap-2">
              <button onClick={() => setCurrentView('prestart')} className="bg-white rounded-xl p-2 shadow-sm flex flex-col items-center gap-1 hover:shadow-md">
                <div className="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-lg">ğŸ“‹</div>
                <span className="text-xs font-medium text-gray-700 text-center">Pre-Start</span>
              </button>
              <button onClick={() => setCurrentView('steel-itp')} className="bg-white rounded-xl p-2 shadow-sm flex flex-col items-center gap-1 hover:shadow-md">
                <div className="w-10 h-10 bg-slate-600 rounded-full flex items-center justify-center text-lg">ğŸ”©</div>
                <span className="text-xs font-medium text-gray-700 text-center">Steel ITP</span>
              </button>
              <button onClick={() => setCurrentView('inspection')} className="bg-white rounded-xl p-2 shadow-sm flex flex-col items-center gap-1 hover:shadow-md">
                <div className="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-lg">ğŸ”</div>
                <span className="text-xs font-medium text-gray-700 text-center">Inspect</span>
              </button>
              <button onClick={() => setCurrentView('itp')} className="bg-white rounded-xl p-2 shadow-sm flex flex-col items-center gap-1 hover:shadow-md">
                <div className="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center text-lg">ğŸ“</div>
                <span className="text-xs font-medium text-gray-700 text-center">ITP</span>
              </button>
              <button onClick={() => setCurrentView('incidents')} className="bg-white rounded-xl p-2 shadow-sm flex flex-col items-center gap-1 hover:shadow-md">
                <div className="w-10 h-10 bg-red-500 rounded-full flex items-center justify-center text-lg">âš ï¸</div>
                <span className="text-xs font-medium text-gray-700 text-center">Incident</span>
              </button>
              <button onClick={() => setCurrentView('toolbox')} className="bg-white rounded-xl p-2 shadow-sm flex flex-col items-center gap-1 hover:shadow-md">
                <div className="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center text-lg">ğŸ‘¥</div>
                <span className="text-xs font-medium text-gray-700 text-center">Toolbox</span>
              </button>
            </div>
          </div>

          <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
            <div className="flex items-start gap-3">
              <span className="text-2xl">âš ï¸</span>
              <div>
                <h4 className="font-semibold text-yellow-800">Daily Safety Reminder</h4>
                <p className="text-sm text-yellow-700 mt-1">Always wear appropriate PPE including safety glasses, steel-capped boots, and high-vis clothing when on site.</p>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Training View Component
    function TrainingView() {
      const [selectedCourse, setSelectedCourse] = useState(null);
      const [currentQuestion, setCurrentQuestion] = useState(0);
      const [answers, setAnswers] = useState({});
      const [showResults, setShowResults] = useState(false);
      const [showSignature, setShowSignature] = useState(false);
      const [workerName, setWorkerName] = useState('');
      const [showCertificate, setShowCertificate] = useState(false);
      const [signatureData, setSignatureData] = useState(null);
      const [showQRCode, setShowQRCode] = useState(false);
      const [viewingStandards, setViewingStandards] = useState(null);
      const [completedCourses, setCompletedCourses] = useState(() => {
        const saved = localStorage.getItem('jmart-completed-training');
        return saved ? JSON.parse(saved) : [];
      });

      const courses = [
        {
          id: 'manual-handling',
          title: 'Manual Handling / äººå·¥æ¬è¿',
          description: 'Learn safe lifting techniques and prevent workplace injuries / å­¦ä¹ å®‰å…¨æ¬è¿æŠ€æœ¯ï¼Œé¢„é˜²å·¥ä¼¤',
          duration: '15 min',
          image: 'ğŸ‹ï¸',
          standards: [
            { code: 'Safe Work Australia - Hazardous Manual Tasks COP 2018', url: 'https://www.safeworkaustralia.gov.au/doc/model-code-practice-hazardous-manual-tasks' },
            { code: 'AS/NZS 4422:1996 - Manual Handling', url: 'https://www.standards.org.au/' }
          ],
          questions: [
            {
              question: 'What is the recommended maximum weight for one person to lift without assistance? / å»ºè®®ä¸€äººæ¬è¿çš„æœ€å¤§é‡é‡æ˜¯å¤šå°‘ï¼Ÿ',
              options: ['10kg / 10å…¬æ–¤', '16kg / 16å…¬æ–¤', '25kg / 25å…¬æ–¤', '35kg / 35å…¬æ–¤'],
              correct: 2,
              explanation: 'Safe Work Australia recommends a maximum of 25kg for most workers in ideal conditions. / æ¾³å¤§åˆ©äºšå®‰å…¨å·¥ä½œå±€å»ºè®®åœ¨ç†æƒ³æ¡ä»¶ä¸‹ï¼Œå¤§å¤šæ•°å·¥äººæœ€å¤šæ¬è¿25å…¬æ–¤ã€‚'
            },
            {
              question: 'Before lifting a heavy object, you should: / æ¬è¿é‡ç‰©å‰ï¼Œä½ åº”è¯¥ï¼š',
              options: ['Lift quickly to get it over with / å¿«é€Ÿæ¬èµ·æ¥å®Œæˆä»»åŠ¡', 'Assess the load and plan your lift / è¯„ä¼°è´Ÿè½½å¹¶è®¡åˆ’æ¬è¿', 'Always use your back muscles / æ€»æ˜¯ç”¨èƒŒéƒ¨è‚Œè‚‰', 'Hold your breath / å±ä½å‘¼å¸'],
              correct: 1,
              explanation: 'Always assess the load, check the path, and plan your lift before moving any object. / åœ¨æ¬è¿ä»»ä½•ç‰©å“å‰ï¼Œå§‹ç»ˆè¯„ä¼°è´Ÿè½½ã€æ£€æŸ¥è·¯å¾„å¹¶è®¡åˆ’æ¬è¿ã€‚'
            },
            {
              question: 'When lifting, you should bend at your: / æ¬è¿æ—¶ï¼Œä½ åº”è¯¥å¼¯æ›²ï¼š',
              options: ['Back / èƒŒéƒ¨', 'Waist / è…°éƒ¨', 'Knees and hips / è†ç›–å’Œè‡€éƒ¨', 'Shoulders / è‚©è†€'],
              correct: 2,
              explanation: 'Bending at the knees and hips keeps your back straight and uses your stronger leg muscles. / å¼¯æ›²è†ç›–å’Œè‡€éƒ¨å¯ä»¥ä¿æŒèƒŒéƒ¨æŒºç›´ï¼Œå¹¶ä½¿ç”¨æ›´å¼ºå£®çš„è…¿éƒ¨è‚Œè‚‰ã€‚'
            },
            {
              question: 'How close should you hold a load to your body when carrying? / æ¬è¿æ—¶åº”è¯¥æŠŠè´Ÿè½½é èº«ä½“å¤šè¿‘ï¼Ÿ',
              options: ['At arm\'s length / æ‰‹è‡‚é•¿åº¦', 'As close as possible / å°½å¯èƒ½é è¿‘', 'It doesn\'t matter / æ— æ‰€è°“', 'About 30cm away / çº¦30å˜ç±³è¿œ'],
              correct: 1,
              explanation: 'Holding loads close to your body reduces strain on your back and gives you better control. / å°†è´Ÿè½½é è¿‘èº«ä½“å¯ä»¥å‡å°‘èƒŒéƒ¨å‹åŠ›ï¼Œå¹¶ç»™ä½ æ›´å¥½çš„æ§åˆ¶ã€‚'
            },
            {
              question: 'If a load is too heavy, you should: / å¦‚æœè´Ÿè½½å¤ªé‡ï¼Œä½ åº”è¯¥ï¼š',
              options: ['Try harder / æ›´åŠ åŠªåŠ›', 'Use a team lift or mechanical aid / ä½¿ç”¨å›¢é˜Ÿæ¬è¿æˆ–æœºæ¢°è¾…åŠ©', 'Drag it instead / æ”¹ä¸ºæ‹–æ‹½', 'Lift in stages / åˆ†é˜¶æ®µæ¬è¿'],
              correct: 1,
              explanation: 'Always use team lifting or mechanical aids like trolleys for loads that are too heavy. / å¯¹äºè¿‡é‡çš„è´Ÿè½½ï¼Œå§‹ç»ˆä½¿ç”¨å›¢é˜Ÿæ¬è¿æˆ–æ‰‹æ¨è½¦ç­‰æœºæ¢°è¾…åŠ©å·¥å…·ã€‚'
            },
            {
              question: 'What is the best foot position when lifting? / æ¬è¿æ—¶æœ€ä½³çš„è„šéƒ¨å§¿åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ',
              options: ['Feet together / åŒè„šå¹¶æ‹¢', 'Feet shoulder-width apart, one slightly forward / åŒè„šä¸è‚©åŒå®½ï¼Œä¸€è„šç¨å‘å‰', 'Standing on tiptoes / è¸®è„šç«™ç«‹', 'Legs crossed / åŒè…¿äº¤å‰'],
              correct: 1,
              explanation: 'A stable base with feet shoulder-width apart and one foot slightly forward provides the best balance. / åŒè„šä¸è‚©åŒå®½ã€ä¸€è„šç¨å‘å‰çš„ç¨³å®šå§¿åŠ¿æä¾›æœ€ä½³å¹³è¡¡ã€‚'
            },
            {
              question: 'Twisting while carrying a load is dangerous because: / æ¬è¿æ—¶æ‰­è½¬èº«ä½“å¾ˆå±é™©ï¼Œå› ä¸ºï¼š',
              options: ['It makes you dizzy / ä¼šè®©ä½ å¤´æ™•', 'It puts excessive strain on your spine / ä¼šå¯¹è„ŠæŸ±é€ æˆè¿‡åº¦å‹åŠ›', 'It\'s not dangerous / ä¸å±é™©', 'It wastes time / æµªè´¹æ—¶é—´'],
              correct: 1,
              explanation: 'Twisting under load can cause serious spinal injuries. Move your feet to turn instead. / è´Ÿé‡æ‰­è½¬å¯èƒ½å¯¼è‡´ä¸¥é‡çš„è„ŠæŸ±æŸä¼¤ã€‚åº”è¯¥ç§»åŠ¨è„šæ­¥æ¥è½¬å‘ã€‚'
            },
            {
              question: 'What should you do if you experience back pain after lifting? / å¦‚æœæ¬è¿åèƒŒéƒ¨ç–¼ç—›ï¼Œä½ åº”è¯¥æ€ä¹ˆåšï¼Ÿ',
              options: ['Ignore it and continue working / å¿½ç•¥å¹¶ç»§ç»­å·¥ä½œ', 'Report it and seek first aid / æŠ¥å‘Šå¹¶å¯»æ±‚æ€¥æ•‘', 'Take painkillers and keep working / åƒæ­¢ç—›è¯ç»§ç»­å·¥ä½œ', 'Wait until after your shift / ç­‰åˆ°ä¸‹ç­å'],
              correct: 1,
              explanation: 'Always report injuries immediately. Early treatment prevents more serious damage. / å§‹ç»ˆç«‹å³æŠ¥å‘Šå—ä¼¤ã€‚æ—©æœŸæ²»ç–—å¯ä»¥é˜²æ­¢æ›´ä¸¥é‡çš„æŸä¼¤ã€‚'
            }
          ]
        },
        {
          id: 'working-at-heights',
          title: 'Working at Heights / é«˜ç©ºä½œä¸š',
          description: 'Safety procedures for elevated work areas / é«˜ç©ºä½œä¸šåŒºåŸŸçš„å®‰å…¨ç¨‹åº',
          duration: '20 min',
          image: 'ğŸªœ',
          standards: [
            { code: 'Safe Work Australia - Managing Falls COP 2022', url: 'https://www.safeworkaustralia.gov.au/doc/model-code-practice-managing-risk-falls-workplaces' },
            { code: 'AS/NZS 1891.4 - Industrial Fall Arrest Systems', url: 'https://www.standards.org.au/' },
            { code: 'AS/NZS 1892.1 - Portable Ladders', url: 'https://www.standards.org.au/' }
          ],
          questions: [
            {
              question: 'At what height does work become "working at heights" in Australia? / åœ¨æ¾³å¤§åˆ©äºšï¼Œå¤šé«˜ç®—"é«˜ç©ºä½œä¸š"ï¼Ÿ',
              options: ['1 metre / 1ç±³', '2 metres / 2ç±³', '3 metres / 3ç±³', 'Any height where you could be injured by a fall / ä»»ä½•å¯èƒ½å› è·Œè½å—ä¼¤çš„é«˜åº¦'],
              correct: 3,
              explanation: 'Working at heights is any work where a person could fall and be injured, regardless of the height. / é«˜ç©ºä½œä¸šæ˜¯æŒ‡ä»»ä½•å¯èƒ½è·Œè½å¹¶å—ä¼¤çš„å·¥ä½œï¼Œæ— è®ºé«˜åº¦å¦‚ä½•ã€‚'
            },
            {
              question: 'What is the hierarchy of control for fall prevention? / é¢„é˜²è·Œè½çš„æ§åˆ¶å±‚çº§æ˜¯ä»€ä¹ˆï¼Ÿ',
              options: ['PPE first, then eliminate / å…ˆç”¨PPEï¼Œå†æ¶ˆé™¤', 'Eliminate, substitute, isolate, admin controls, PPE / æ¶ˆé™¤ã€æ›¿ä»£ã€éš”ç¦»ã€ç®¡ç†æ§åˆ¶ã€PPE', 'Admin controls only / ä»…ç®¡ç†æ§åˆ¶', 'Just use harnesses / åªç”¨å®‰å…¨å¸¦'],
              correct: 1,
              explanation: 'Always try to eliminate the risk first, then substitute, isolate, use admin controls, and finally PPE as last resort. / å§‹ç»ˆå…ˆå°è¯•æ¶ˆé™¤é£é™©ï¼Œç„¶åæ›¿ä»£ã€éš”ç¦»ã€ä½¿ç”¨ç®¡ç†æ§åˆ¶ï¼Œæœ€åå°†PPEä½œä¸ºæœ€åæ‰‹æ®µã€‚'
            },
            {
              question: 'Before using a ladder, you should: / ä½¿ç”¨æ¢¯å­å‰ï¼Œä½ åº”è¯¥ï¼š',
              options: ['Just climb up quickly / å¿«é€Ÿçˆ¬ä¸Šå»', 'Inspect it for damage and ensure it\'s the right type / æ£€æŸ¥æ˜¯å¦æŸåå¹¶ç¡®ä¿ç±»å‹æ­£ç¡®', 'Only check if it looks old / åªæœ‰çœ‹èµ·æ¥æ—§æ‰æ£€æŸ¥', 'Ladders don\'t need inspection / æ¢¯å­ä¸éœ€è¦æ£€æŸ¥'],
              correct: 1,
              explanation: 'Always inspect ladders for damage, check the rating, and ensure it\'s suitable for the task. / å§‹ç»ˆæ£€æŸ¥æ¢¯å­æ˜¯å¦æŸåï¼Œæ£€æŸ¥é¢å®šå€¼ï¼Œå¹¶ç¡®ä¿é€‚åˆè¯¥ä»»åŠ¡ã€‚'
            },
            {
              question: 'What is the correct angle for a ladder against a wall? / æ¢¯å­é å¢™çš„æ­£ç¡®è§’åº¦æ˜¯å¤šå°‘ï¼Ÿ',
              options: ['Straight up (90 degrees) / å‚ç›´ï¼ˆ90åº¦ï¼‰', '1:4 ratio (75 degrees) / 1:4æ¯”ä¾‹ï¼ˆ75åº¦ï¼‰', 'As steep as possible / å°½å¯èƒ½é™¡', 'Lying almost flat / å‡ ä¹å¹³æ”¾'],
              correct: 1,
              explanation: 'The 1:4 ratio (for every 4m up, 1m out at base) provides the safest angle. / 1:4æ¯”ä¾‹ï¼ˆæ¯ä¸Šå‡4ç±³ï¼Œåº•éƒ¨å¤–ç§»1ç±³ï¼‰æä¾›æœ€å®‰å…¨çš„è§’åº¦ã€‚'
            },
            {
              question: 'When must you use a harness and lanyard? / ä»€ä¹ˆæ—¶å€™å¿…é¡»ä½¿ç”¨å®‰å…¨å¸¦å’Œç³»ç»³ï¼Ÿ',
              options: ['Only if you feel scared / åªæœ‰æ„Ÿåˆ°å®³æ€•æ—¶', 'When there\'s no edge protection and you could fall 2m+ / å½“æ²¡æœ‰è¾¹ç¼˜ä¿æŠ¤ä¸”å¯èƒ½è·Œè½2ç±³ä»¥ä¸Šæ—¶', 'Harnesses are optional / å®‰å…¨å¸¦æ˜¯å¯é€‰çš„', 'Only on roofs / åªåœ¨å±‹é¡¶ä¸Š'],
              correct: 1,
              explanation: 'Fall arrest systems are required when other controls cannot adequately protect against falls. / å½“å…¶ä»–æ§åˆ¶æªæ–½æ— æ³•å……åˆ†ä¿æŠ¤é˜²æ­¢è·Œè½æ—¶ï¼Œéœ€è¦ä½¿ç”¨é˜²å è½ç³»ç»Ÿã€‚'
            }
          ]
        },
        {
          id: 'ppe',
          title: 'Personal Protective Equipment / ä¸ªäººé˜²æŠ¤è£…å¤‡',
          description: 'Proper selection and use of PPE / æ­£ç¡®é€‰æ‹©å’Œä½¿ç”¨PPE',
          duration: '10 min',
          image: 'ğŸ¦º',
          standards: [
            { code: 'AS/NZS 1337.1 - Eye & Face Protectors', url: 'https://www.standards.org.au/' },
            { code: 'AS/NZS 2210.3 - Safety Footwear', url: 'https://www.standards.org.au/' },
            { code: 'AS/NZS 1801 - Occupational Helmets', url: 'https://www.standards.org.au/' },
            { code: 'AS/NZS 4602.1 - High Visibility Clothing', url: 'https://www.standards.org.au/' }
          ],
          questions: [
            {
              question: 'PPE should be used: / PPEåº”è¯¥ç”¨äºï¼š',
              options: ['As the first line of defence / ä½œä¸ºç¬¬ä¸€é“é˜²çº¿', 'Only when convenient / åªåœ¨æ–¹ä¾¿æ—¶', 'As a last resort after other controls / ä½œä¸ºå…¶ä»–æ§åˆ¶æªæ–½åçš„æœ€åæ‰‹æ®µ', 'Only for dangerous jobs / åªç”¨äºå±é™©å·¥ä½œ'],
              correct: 2,
              explanation: 'PPE is the last line of defence in the hierarchy of controls, not the first. / PPEæ˜¯æ§åˆ¶å±‚çº§ä¸­çš„æœ€åä¸€é“é˜²çº¿ï¼Œè€Œéç¬¬ä¸€é“ã€‚'
            },
            {
              question: 'Hard hats should be replaced: / å®‰å…¨å¸½åº”è¯¥åœ¨ä½•æ—¶æ›´æ¢ï¼š',
              options: ['Never, they last forever / æ°¸è¿œä¸ç”¨ï¼Œå®ƒä»¬æ°¸ä¹…è€ç”¨', 'Only if cracked / åªæœ‰ç ´è£‚æ—¶', 'After any significant impact or as per manufacturer guidelines / ä»»ä½•é‡å¤§æ’å‡»åæˆ–æŒ‰åˆ¶é€ å•†æŒ‡å—', 'Every 10 years / æ¯10å¹´'],
              correct: 2,
              explanation: 'Hard hats must be replaced after any impact, if damaged, or as specified by the manufacturer (usually 2-5 years). / å®‰å…¨å¸½å¿…é¡»åœ¨ä»»ä½•æ’å‡»åã€æŸåæ—¶æˆ–æŒ‰åˆ¶é€ å•†è§„å®šï¼ˆé€šå¸¸2-5å¹´ï¼‰æ›´æ¢ã€‚'
            },
            {
              question: 'Safety glasses should: / å®‰å…¨çœ¼é•œåº”è¯¥ï¼š',
              options: ['Fit loosely for comfort / æ¾æ¾åœ°æˆ´ç€èˆ’æœ', 'Fit snugly and have side protection / ç´§è´´å¹¶æœ‰ä¾§é¢ä¿æŠ¤', 'Be worn only sometimes / åªå¶å°”æˆ´', 'Only be clear lenses / åªç”¨é€æ˜é•œç‰‡'],
              correct: 1,
              explanation: 'Safety glasses must fit properly and provide adequate coverage including side protection. / å®‰å…¨çœ¼é•œå¿…é¡»æ­£ç¡®ä½©æˆ´ï¼Œå¹¶æä¾›åŒ…æ‹¬ä¾§é¢ä¿æŠ¤åœ¨å†…çš„è¶³å¤Ÿè¦†ç›–ã€‚'
            },
            {
              question: 'Who is responsible for maintaining PPE? / è°è´Ÿè´£ç»´æŠ¤PPEï¼Ÿ',
              options: ['Only the employer / åªæœ‰é›‡ä¸»', 'Only the worker / åªæœ‰å·¥äºº', 'Both employer and worker have responsibilities / é›‡ä¸»å’Œå·¥äººéƒ½æœ‰è´£ä»»', 'No one / æ²¡æœ‰äºº'],
              correct: 2,
              explanation: 'Employers must provide and maintain PPE, while workers must use it properly and report damage. / é›‡ä¸»å¿…é¡»æä¾›å’Œç»´æŠ¤PPEï¼Œè€Œå·¥äººå¿…é¡»æ­£ç¡®ä½¿ç”¨å¹¶æŠ¥å‘ŠæŸåã€‚'
            },
            {
              question: 'What class of safety boots is required for construction? / å»ºç­‘å·¥åœ°éœ€è¦ä»€ä¹ˆç±»å‹çš„å®‰å…¨é´ï¼Ÿ',
              options: ['Any comfortable shoes / ä»»ä½•èˆ’é€‚çš„é‹å­', 'Steel cap boots meeting AS/NZS 2210.3 / ç¬¦åˆAS/NZS 2210.3çš„é’¢å¤´é´', 'Rubber boots only / åªç”¨æ©¡èƒ¶é´', 'Sneakers with good grip / é˜²æ»‘è¿åŠ¨é‹'],
              correct: 1,
              explanation: 'Construction sites typically require safety footwear meeting Australian Standards with toe protection. / å»ºç­‘å·¥åœ°é€šå¸¸éœ€è¦ç¬¦åˆæ¾³å¤§åˆ©äºšæ ‡å‡†å¹¶æœ‰è„šè¶¾ä¿æŠ¤çš„å®‰å…¨é‹ã€‚'
            }
          ]
        },
        {
          id: 'hazard-identification',
          title: 'Hazard Identification / å±å®³è¯†åˆ«',
          description: 'Identifying and reporting workplace hazards / è¯†åˆ«å’ŒæŠ¥å‘Šå·¥ä½œåœºæ‰€å±å®³',
          duration: '15 min',
          image: 'âš ï¸',
          standards: [
            { code: 'Safe Work Australia - Risk Management COP 2022', url: 'https://www.safeworkaustralia.gov.au/doc/model-code-practice-how-manage-work-health-and-safety-risks' },
            { code: 'AS/NZS ISO 31000 - Risk Management', url: 'https://www.standards.org.au/' },
            { code: 'WHS Act 2011 - Duty of Care', url: 'https://www.safeworkaustralia.gov.au/law-and-regulation/model-whs-laws' }
          ],
          questions: [
            {
              question: 'A hazard is: / å±å®³æ˜¯ï¼š',
              options: ['An accident that happened / å·²å‘ç”Ÿçš„äº‹æ•…', 'Something that could cause harm / å¯èƒ½é€ æˆä¼¤å®³çš„ä¸œè¥¿', 'A type of PPE / ä¸€ç§PPE', 'A safety meeting / å®‰å…¨ä¼šè®®'],
              correct: 1,
              explanation: 'A hazard is anything with the potential to cause harm, injury, or illness. / å±å®³æ˜¯ä»»ä½•å¯èƒ½é€ æˆä¼¤å®³ã€å—ä¼¤æˆ–ç–¾ç—…çš„äº‹ç‰©ã€‚'
            },
            {
              question: 'Who is responsible for identifying hazards? / è°è´Ÿè´£è¯†åˆ«å±å®³ï¼Ÿ',
              options: ['Only supervisors / åªæœ‰ä¸»ç®¡', 'Only safety officers / åªæœ‰å®‰å…¨å‘˜', 'Everyone on site / ç°åœºæ¯ä¸ªäºº', 'Only management / åªæœ‰ç®¡ç†å±‚'],
              correct: 2,
              explanation: 'Everyone has a responsibility to identify and report hazards in their workplace. / æ¯ä¸ªäººéƒ½æœ‰è´£ä»»è¯†åˆ«å’ŒæŠ¥å‘Šå·¥ä½œåœºæ‰€çš„å±å®³ã€‚'
            },
            {
              question: 'When you identify a hazard, you should: / å½“ä½ è¯†åˆ«åˆ°å±å®³æ—¶ï¼Œä½ åº”è¯¥ï¼š',
              options: ['Ignore it if it\'s not your area / å¦‚æœä¸æ˜¯ä½ çš„åŒºåŸŸå°±å¿½ç•¥', 'Report it immediately to your supervisor / ç«‹å³å‘ä¸»ç®¡æŠ¥å‘Š', 'Wait until the safety meeting / ç­‰åˆ°å®‰å…¨ä¼šè®®', 'Only report serious hazards / åªæŠ¥å‘Šä¸¥é‡å±å®³'],
              correct: 1,
              explanation: 'All hazards should be reported immediately so they can be assessed and controlled. / æ‰€æœ‰å±å®³éƒ½åº”ç«‹å³æŠ¥å‘Šï¼Œä»¥ä¾¿è¿›è¡Œè¯„ä¼°å’Œæ§åˆ¶ã€‚'
            },
            {
              question: 'A risk assessment considers: / é£é™©è¯„ä¼°è€ƒè™‘ï¼š',
              options: ['Only the likelihood of harm / åªè€ƒè™‘ä¼¤å®³çš„å¯èƒ½æ€§', 'Only the severity of harm / åªè€ƒè™‘ä¼¤å®³çš„ä¸¥é‡ç¨‹åº¦', 'Both likelihood and severity of harm / åŒæ—¶è€ƒè™‘ä¼¤å®³çš„å¯èƒ½æ€§å’Œä¸¥é‡ç¨‹åº¦', 'Only financial impact / åªè€ƒè™‘è´¢åŠ¡å½±å“'],
              correct: 2,
              explanation: 'Risk is assessed by considering both how likely harm is to occur and how severe it would be. / é£é™©æ˜¯é€šè¿‡è€ƒè™‘ä¼¤å®³å‘ç”Ÿçš„å¯èƒ½æ€§å’Œä¸¥é‡ç¨‹åº¦æ¥è¯„ä¼°çš„ã€‚'
            },
            {
              question: 'JSA stands for: / JSAä»£è¡¨ï¼š',
              options: ['Job Safety Analysis / å·¥ä½œå®‰å…¨åˆ†æ', 'Just Safety Awareness / ä»…å®‰å…¨æ„è¯†', 'Joint Safety Agreement / è”åˆå®‰å…¨åè®®', 'Job Start Approval / å·¥ä½œå¼€å§‹æ‰¹å‡†'],
              correct: 0,
              explanation: 'A Job Safety Analysis breaks down tasks to identify hazards and controls for each step. / å·¥ä½œå®‰å…¨åˆ†æåˆ†è§£ä»»åŠ¡ä»¥è¯†åˆ«æ¯ä¸ªæ­¥éª¤çš„å±å®³å’Œæ§åˆ¶æªæ–½ã€‚'
            }
          ]
        },
        {
          id: 'hot-works',
          title: 'Hot Works Safety / çƒ­å·¥ä½œä¸šå®‰å…¨',
          description: 'Welding, grinding & oxy cutting - Australian Standards compliant / ç„Šæ¥ã€æ‰“ç£¨å’Œæ°§æ°”åˆ‡å‰² - ç¬¦åˆæ¾³å¤§åˆ©äºšæ ‡å‡†',
          duration: '25 min',
          image: 'ğŸ”¥',
          standards: [
            { code: 'AS 1674.1 - Safety in Welding (Fire Precautions)', url: 'https://www.standards.org.au/' },
            { code: 'AS/NZS 1338.1 - Welding Helmets', url: 'https://www.standards.org.au/' },
            { code: 'AS/NZS 1337.1 - Eye & Face Protectors', url: 'https://www.standards.org.au/' },
            { code: 'AS 4839-2001 - Oxy-Fuel Gas Systems', url: 'https://www.standards.org.au/' },
            { code: 'AS 4332-2004 - Gas Cylinder Storage', url: 'https://www.standards.org.au/' }
          ],
          questions: [
            {
              question: 'Under AS 1674.1, a Hot Work Permit is required when: / æ ¹æ®AS 1674.1ï¼Œä½•æ—¶éœ€è¦çƒ­å·¥ä½œè®¸å¯è¯ï¼š',
              options: ['Only for indoor welding / ä»…å®¤å†…ç„Šæ¥', 'Any work that produces flames, sparks or heat / ä»»ä½•äº§ç”Ÿç«ç„°ã€ç«èŠ±æˆ–çƒ­é‡çš„å·¥ä½œ', 'Only when working near flammables / ä»…åœ¨æ˜“ç‡ƒç‰©é™„è¿‘å·¥ä½œæ—¶', 'Only for certified welders / ä»…æŒè¯ç„Šå·¥'],
              correct: 1,
              explanation: 'AS 1674.1 requires a Hot Work Permit for any work producing flames, sparks, or heat that could ignite nearby materials. / AS 1674.1è¦æ±‚ä»»ä½•äº§ç”Ÿç«ç„°ã€ç«èŠ±æˆ–å¯èƒ½ç‚¹ç‡ƒé™„è¿‘ææ–™çš„çƒ­é‡çš„å·¥ä½œéƒ½éœ€è¦çƒ­å·¥ä½œè®¸å¯è¯ã€‚'
            },
            {
              question: 'According to AS/NZS 1338.1, auto-darkening welding helmets must have a minimum shade of: / æ ¹æ®AS/NZS 1338.1ï¼Œè‡ªåŠ¨å˜å…‰ç„Šæ¥å¤´ç›”å¿…é¡»å…·æœ‰æœ€ä½é®å…‰åº¦ï¼š',
              options: ['Shade 5 / 5å·', 'Shade 8 / 8å·', 'Shade 10 / 10å·', 'Shade 14 / 14å·'],
              correct: 2,
              explanation: 'AS/NZS 1338.1 specifies welding helmets must have minimum shade 10 for arc welding to protect against UV and infrared radiation. / AS/NZS 1338.1è§„å®šç”µå¼§ç„Šæ¥å¤´ç›”å¿…é¡»è‡³å°‘æœ‰10å·é®å…‰åº¦ï¼Œä»¥ä¿æŠ¤å…å—ç´«å¤–çº¿å’Œçº¢å¤–è¾å°„ã€‚'
            },
            {
              question: 'When grinding steel, what eye protection standard applies? / æ‰“ç£¨é’¢ææ—¶ï¼Œé€‚ç”¨ä»€ä¹ˆçœ¼éƒ¨ä¿æŠ¤æ ‡å‡†ï¼Ÿ',
              options: ['AS/NZS 1337.1 - High Impact Rated / AS/NZS 1337.1 - é«˜å†²å‡»ç­‰çº§', 'AS 1674.1', 'AS 4839-2001', 'No specific standard applies / æ²¡æœ‰ç‰¹å®šæ ‡å‡†é€‚ç”¨'],
              correct: 0,
              explanation: 'AS/NZS 1337.1 requires high-impact rated safety glasses or face shields for grinding to protect against flying particles. / AS/NZS 1337.1è¦æ±‚æ‰“ç£¨æ—¶ä½¿ç”¨é«˜å†²å‡»ç­‰çº§çš„å®‰å…¨çœ¼é•œæˆ–é¢ç½©ï¼Œä»¥ä¿æŠ¤å…å—é£æº…é¢—ç²’ä¼¤å®³ã€‚'
            },
            {
              question: 'AS 4839-2001 requires flashback arrestors on oxy-acetylene equipment at: / AS 4839-2001è¦æ±‚æ°§ä¹™ç‚”è®¾å¤‡ä¸Šçš„å›ç«é˜²æ­¢å™¨å®‰è£…åœ¨ï¼š',
              options: ['Only the torch / ä»…åœ¨ç„Šæª', 'Only the regulators / ä»…åœ¨è°ƒèŠ‚å™¨', 'Both torch and regulator ends / ç„Šæªå’Œè°ƒèŠ‚å™¨ä¸¤ç«¯', 'They are optional / å®ƒä»¬æ˜¯å¯é€‰çš„'],
              correct: 2,
              explanation: 'AS 4839-2001 mandates flashback arrestors at BOTH the torch handle AND the regulator to prevent flashback explosions. / AS 4839-2001è§„å®šç„Šæªæ‰‹æŸ„å’Œè°ƒèŠ‚å™¨ä¸¤ç«¯éƒ½å¿…é¡»å®‰è£…å›ç«é˜²æ­¢å™¨ï¼Œä»¥é˜²æ­¢å›ç«çˆ†ç‚¸ã€‚'
            },
            {
              question: 'The maximum working pressure for acetylene is: / ä¹™ç‚”çš„æœ€å¤§å·¥ä½œå‹åŠ›æ˜¯ï¼š',
              options: ['5 psi / 5 psi', '10 psi / 10 psi', '15 psi / 15 psi', '25 psi / 25 psi'],
              correct: 2,
              explanation: 'Acetylene becomes unstable above 15 psi (103 kPa) and can spontaneously decompose. Never exceed this limit. / ä¹™ç‚”åœ¨è¶…è¿‡15 psiï¼ˆ103 kPaï¼‰æ—¶å˜å¾—ä¸ç¨³å®šï¼Œå¯èƒ½è‡ªå‘åˆ†è§£ã€‚åˆ‡å‹¿è¶…è¿‡æ­¤é™åˆ¶ã€‚'
            },
            {
              question: 'Under AS 4332-2004, the minimum separation between oxygen and fuel gas cylinders in storage is: / æ ¹æ®AS 4332-2004ï¼Œå‚¨å­˜æ—¶æ°§æ°”å’Œç‡ƒæ°”é’¢ç“¶ä¹‹é—´çš„æœ€å°é—´éš”æ˜¯ï¼š',
              options: ['1 metre / 1ç±³', '2 metres / 2ç±³', '3 metres / 3ç±³', '5 metres / 5ç±³'],
              correct: 2,
              explanation: 'AS 4332-2004 requires a minimum 3-metre separation between oxygen and fuel gas cylinders, or a fire-resistant barrier. / AS 4332-2004è¦æ±‚æ°§æ°”å’Œç‡ƒæ°”é’¢ç“¶ä¹‹é—´è‡³å°‘é—´éš”3ç±³ï¼Œæˆ–è®¾ç½®é˜²ç«å±éšœã€‚'
            },
            {
              question: 'Before starting hot work, the area must be cleared of combustibles for a radius of: / å¼€å§‹çƒ­å·¥ä½œä¸šå‰ï¼Œå¿…é¡»æ¸…é™¤å¯ç‡ƒç‰©çš„åŠå¾„ä¸ºï¼š',
              options: ['3 metres / 3ç±³', '6 metres / 6ç±³', '10 metres / 10ç±³', '15 metres / 15ç±³'],
              correct: 2,
              explanation: 'A minimum 10-metre radius should be cleared of combustible materials, or they must be protected with fire-resistant covers. / åº”æ¸…é™¤è‡³å°‘10ç±³åŠå¾„å†…çš„å¯ç‡ƒææ–™ï¼Œæˆ–ç”¨é˜²ç«è¦†ç›–ç‰©ä¿æŠ¤å®ƒä»¬ã€‚'
            },
            {
              question: 'A fire watch must remain at the hot work area after work completion for: / çƒ­å·¥ä½œä¸šå®Œæˆåï¼Œé˜²ç«ç›‘æŠ¤äººå¿…é¡»åœ¨å·¥ä½œåŒºåŸŸåœç•™ï¼š',
              options: ['15 minutes / 15åˆ†é’Ÿ', '30 minutes / 30åˆ†é’Ÿ', '60 minutes / 60åˆ†é’Ÿ', '2 hours / 2å°æ—¶'],
              correct: 1,
              explanation: 'Fire watch must continue for at least 30 minutes after hot work completion to detect any smouldering materials. / çƒ­å·¥ä½œä¸šå®Œæˆåï¼Œé˜²ç«ç›‘æŠ¤å¿…é¡»æŒç»­è‡³å°‘30åˆ†é’Ÿï¼Œä»¥æ£€æµ‹ä»»ä½•é˜´ç‡ƒææ–™ã€‚'
            },
            {
              question: 'When welding galvanized steel, you must: / ç„Šæ¥é•€é”Œé’¢æ—¶ï¼Œä½ å¿…é¡»ï¼š',
              options: ['Weld faster to reduce fumes / å¿«é€Ÿç„Šæ¥ä»¥å‡å°‘çƒŸé›¾', 'Use respiratory protection and ensure ventilation / ä½¿ç”¨å‘¼å¸ä¿æŠ¤è£…ç½®å¹¶ç¡®ä¿é€šé£', 'Only weld outdoors / åªåœ¨å®¤å¤–ç„Šæ¥', 'Apply anti-spatter spray / ä½¿ç”¨é˜²é£æº…å–·å‰‚'],
              correct: 1,
              explanation: 'Welding galvanized steel releases zinc oxide fumes. Use appropriate respiratory protection (P2 minimum) and ensure adequate ventilation. / ç„Šæ¥é•€é”Œé’¢ä¼šé‡Šæ”¾æ°§åŒ–é”ŒçƒŸé›¾ã€‚ä½¿ç”¨é€‚å½“çš„å‘¼å¸ä¿æŠ¤è£…ç½®ï¼ˆè‡³å°‘P2çº§åˆ«ï¼‰å¹¶ç¡®ä¿å……åˆ†é€šé£ã€‚'
            },
            {
              question: 'The correct way to open a gas cylinder valve is: / æ‰“å¼€æ°”ç“¶é˜€é—¨çš„æ­£ç¡®æ–¹æ³•æ˜¯ï¼š',
              options: ['Fully open quickly / å¿«é€Ÿå®Œå…¨æ‰“å¼€', 'Open slowly, stand to the side / ç¼“æ…¢æ‰“å¼€ï¼Œç«™åœ¨ä¾§é¢', 'Open halfway only / åªæ‰“å¼€ä¸€åŠ', 'Open with the regulator attached first / å…ˆè¿æ¥è°ƒèŠ‚å™¨å†æ‰“å¼€'],
              correct: 1,
              explanation: 'Always stand to the side and open cylinder valves slowly to prevent sudden pressure surges and allow for controlled gas flow. / å§‹ç»ˆç«™åœ¨ä¾§é¢ç¼“æ…¢æ‰“å¼€é’¢ç“¶é˜€é—¨ï¼Œä»¥é˜²æ­¢çªç„¶çš„å‹åŠ›æ¿€å¢å¹¶å…è®¸å—æ§çš„æ°”ä½“æµåŠ¨ã€‚'
            },
            {
              question: 'If an angle grinder disc is cracked or chipped, you should: / å¦‚æœè§’ç£¨æœºç ‚è½®ç‰‡ç ´è£‚æˆ–ç¼ºæŸï¼Œä½ åº”è¯¥ï¼š',
              options: ['Use it carefully at lower speed / ä½é€Ÿå°å¿ƒä½¿ç”¨', 'Mark it and continue for the current job / æ ‡è®°åç»§ç»­å½“å‰å·¥ä½œ', 'Remove and destroy it immediately / ç«‹å³å–ä¸‹å¹¶é”€æ¯', 'Apply tape to reinforce it / ç”¨èƒ¶å¸¦åŠ å›º'],
              correct: 2,
              explanation: 'Damaged discs can shatter at high speed causing serious injury. Remove and destroy any cracked or chipped discs immediately. / æŸåçš„ç ‚è½®ç‰‡å¯èƒ½åœ¨é«˜é€Ÿä¸‹ç ´ç¢é€ æˆä¸¥é‡ä¼¤å®³ã€‚ç«‹å³å–ä¸‹å¹¶é”€æ¯ä»»ä½•ç ´è£‚æˆ–ç¼ºæŸçš„ç ‚è½®ç‰‡ã€‚'
            },
            {
              question: 'The correct PPE for hot works includes: / çƒ­å·¥ä½œä¸šçš„æ­£ç¡®PPEåŒ…æ‹¬ï¼š',
              options: ['Safety glasses only / ä»…å®‰å…¨çœ¼é•œ', 'Gloves and long sleeves / æ‰‹å¥—å’Œé•¿è¢–', 'Welding helmet, leather gloves, fire-resistant clothing, safety boots / ç„Šæ¥å¤´ç›”ã€çš®æ‰‹å¥—ã€é˜²ç«æœè£…ã€å®‰å…¨é´', 'Hard hat and hi-vis / å®‰å…¨å¸½å’Œåå…‰æœ'],
              correct: 2,
              explanation: 'Full PPE includes: appropriate eye protection, leather welding gloves, fire-resistant clothing, leather apron, and steel-capped boots. / å®Œæ•´çš„PPEåŒ…æ‹¬ï¼šé€‚å½“çš„çœ¼éƒ¨ä¿æŠ¤ã€çš®é©ç„Šæ¥æ‰‹å¥—ã€é˜²ç«æœè£…ã€çš®é©å›´è£™å’Œé’¢å¤´é´ã€‚'
            },
            {
              question: 'When oxy-cutting, the flame should be adjusted to: / æ°§æ°”åˆ‡å‰²æ—¶ï¼Œç«ç„°åº”è°ƒèŠ‚ä¸ºï¼š',
              options: ['A large orange flame / å¤§çš„æ©™è‰²ç«ç„°', 'A neutral flame with equal cone / ç­‰æ¯”ä¾‹é”¥å½¢çš„ä¸­æ€§ç«ç„°', 'Maximum oxygen for speed / æœ€å¤§æ°§æ°”ä»¥æé«˜é€Ÿåº¦', 'Minimum flame to save gas / æœ€å°ç«ç„°ä»¥èŠ‚çœæ°”ä½“'],
              correct: 1,
              explanation: 'A neutral flame (equal acetylene and oxygen) provides the cleanest cut. Adjust until the inner cone is clearly defined. / ä¸­æ€§ç«ç„°ï¼ˆä¹™ç‚”å’Œæ°§æ°”ç›¸ç­‰ï¼‰æä¾›æœ€å¹²å‡€çš„åˆ‡å‰²ã€‚è°ƒèŠ‚ç›´åˆ°å†…é”¥æ¸…æ™°å¯è§ã€‚'
            },
            {
              question: 'Gas cylinders must be stored: / æ°”ç“¶å¿…é¡»å‚¨å­˜ï¼š',
              options: ['Lying flat for stability / å¹³æ”¾ä»¥ä¿æŒç¨³å®š', 'Upright and secured with chains or straps / ç›´ç«‹å¹¶ç”¨é“¾æ¡æˆ–ç»‘å¸¦å›ºå®š', 'In direct sunlight for visibility / åœ¨é˜³å…‰ç›´å°„ä¸‹ä»¥ä¾¿å¯è§', 'Near emergency exits for quick access / åœ¨ç´§æ€¥å‡ºå£é™„è¿‘ä»¥ä¾¿å¿«é€Ÿå–ç”¨'],
              correct: 1,
              explanation: 'Cylinders must be stored upright and secured to prevent falling. Keep away from heat sources and direct sunlight. / æ°”ç“¶å¿…é¡»ç›´ç«‹å­˜æ”¾å¹¶å›ºå®šä»¥é˜²å€¾å€’ã€‚è¿œç¦»çƒ­æºå’Œé˜³å…‰ç›´å°„ã€‚'
            },
            {
              question: 'The 2025 Australian WHS exposure standard for aluminium welding fumes is: / 2025å¹´æ¾³å¤§åˆ©äºšWHSé“ç„Šæ¥çƒŸé›¾æš´éœ²æ ‡å‡†æ˜¯ï¼š',
              options: ['1 mg/mÂ³', '2 mg/mÂ³', '5 mg/mÂ³', '10 mg/mÂ³'],
              correct: 0,
              explanation: 'The workplace exposure standard for welding fumes (including aluminium) is 1 mg/mÂ³ TWA, requiring adequate ventilation or RPE. / ç„Šæ¥çƒŸé›¾ï¼ˆåŒ…æ‹¬é“ï¼‰çš„å·¥ä½œåœºæ‰€æš´éœ²æ ‡å‡†æ˜¯1 mg/mÂ³ TWAï¼Œéœ€è¦å……åˆ†é€šé£æˆ–ä½¿ç”¨å‘¼å¸é˜²æŠ¤è®¾å¤‡ã€‚'
            },
            {
              question: 'If a flashback occurs during oxy-acetylene work, the FIRST action is: / å¦‚æœæ°§ä¹™ç‚”ä½œä¸šä¸­å‘ç”Ÿå›ç«ï¼Œç¬¬ä¸€æ­¥æ˜¯ï¼š',
              options: ['Turn off the torch valves / å…³é—­ç„Šæªé˜€é—¨', 'Turn off the cylinder valves immediately / ç«‹å³å…³é—­é’¢ç“¶é˜€é—¨', 'Run water over the hoses / ç”¨æ°´å†²æ´—è½¯ç®¡', 'Call emergency services / å‘¼å«ç´§æ€¥æœåŠ¡'],
              correct: 1,
              explanation: 'In a flashback, immediately close the cylinder valves (oxygen first, then fuel). The flashback arrestors should prevent flame reaching cylinders. / å‘ç”Ÿå›ç«æ—¶ï¼Œç«‹å³å…³é—­é’¢ç“¶é˜€é—¨ï¼ˆå…ˆå…³æ°§æ°”ï¼Œå†å…³ç‡ƒæ°”ï¼‰ã€‚å›ç«é˜²æ­¢å™¨åº”é˜²æ­¢ç«ç„°åˆ°è¾¾é’¢ç“¶ã€‚'
            }
          ]
        },
        {
          id: 'glass-suction-cups',
          title: 'Glass Suction Cups / ç»ç’ƒå¸ç›˜',
          description: 'Safe use of manual glass suction cups and suckers / æ‰‹åŠ¨ç»ç’ƒå¸ç›˜çš„å®‰å…¨ä½¿ç”¨',
          duration: '10 min',
          image: 'ğŸªŸ',
          standards: [
            { code: 'Safe Work Australia - Hazardous Manual Tasks COP', url: 'https://www.safeworkaustralia.gov.au/doc/model-code-practice-hazardous-manual-tasks' },
            { code: 'AS 4991 - Lifting Equipment for Glass', url: 'https://www.standards.org.au/' },
            { code: 'Manufacturer Guidelines - Trojan Tools', url: 'https://www.trojantools.com.au/' }
          ],
          questions: [
            {
              question: 'Before using a suction cup, what should you always do first? / ä½¿ç”¨å¸ç›˜å‰ï¼Œä½ åº”è¯¥é¦–å…ˆåšä»€ä¹ˆï¼Ÿ',
              options: ['Just start using it / ç›´æ¥å¼€å§‹ä½¿ç”¨', 'Inspect for wear, cracks or damage / æ£€æŸ¥ç£¨æŸã€è£‚ç¼æˆ–æŸå', 'Wet it with water / ç”¨æ°´å¼„æ¹¿', 'Heat it up / åŠ çƒ­'],
              correct: 1,
              explanation: 'Before each use, check the suction cup for any signs of wear, cracks, or damage. Ensure the rubber pad is clean. / æ¯æ¬¡ä½¿ç”¨å‰ï¼Œæ£€æŸ¥å¸ç›˜æ˜¯å¦æœ‰ç£¨æŸã€è£‚ç¼æˆ–æŸåçš„è¿¹è±¡ã€‚ç¡®ä¿æ©¡èƒ¶å«æ¸…æ´ã€‚'
            },
            {
              question: 'The glass surface should be: / ç»ç’ƒè¡¨é¢åº”è¯¥æ˜¯ï¼š',
              options: ['Wet and oily / æ½®æ¹¿å’Œæ²¹è…»çš„', 'Clean, dry and free from dust / æ¸…æ´ã€å¹²ç‡¥ä¸”æ— ç°å°˜', 'Warm to the touch / æ‘¸èµ·æ¥æ¸©çƒ­', 'Rough textured / ç²—ç³™çº¹ç†çš„'],
              correct: 1,
              explanation: 'A clean, dry surface free from dust, oil or contaminants ensures a better seal and reduces slippage risk. / æ¸…æ´ã€å¹²ç‡¥ã€æ— ç°å°˜ã€æ²¹è„‚æˆ–æ±¡æŸ“ç‰©çš„è¡¨é¢å¯ç¡®ä¿æ›´å¥½çš„å¯†å°å¹¶é™ä½æ»‘è„±é£é™©ã€‚'
            },
            {
              question: 'After applying the suction cup, what should you do before lifting? / å®‰è£…å¸ç›˜åï¼Œæèµ·å‰åº”è¯¥åšä»€ä¹ˆï¼Ÿ',
              options: ['Immediately lift the glass / ç«‹å³æèµ·ç»ç’ƒ', 'Test the seal with a gentle tug / è½»è½»æ‹‰åŠ¨æµ‹è¯•å¯†å°', 'Twist it back and forth / æ¥å›æ‰­åŠ¨', 'Wait 10 minutes / ç­‰å¾…10åˆ†é’Ÿ'],
              correct: 1,
              explanation: 'Gently tug on the suction cup to ensure it has a secure grip. If loose, repeat the application process. / è½»è½»æ‹‰åŠ¨å¸ç›˜ä»¥ç¡®ä¿å…¶ç‰¢å›ºæŠ“ç´§ã€‚å¦‚æœæ¾åŠ¨ï¼Œè¯·é‡å¤å®‰è£…è¿‡ç¨‹ã€‚'
            },
            {
              question: 'What is the static load rating for a Trojan Double Cup Suction Holder? / TrojanåŒæ¯å¸ç›˜çš„é™æ€è´Ÿè½½é¢å®šå€¼æ˜¯å¤šå°‘ï¼Ÿ',
              options: ['20kg / 20å…¬æ–¤', '40kg / 40å…¬æ–¤', '60kg / 60å…¬æ–¤', '100kg / 100å…¬æ–¤'],
              correct: 2,
              explanation: 'The Trojan Double Cup Suction Holder has a static load rating of 60kg for safe handling of materials. / TrojanåŒæ¯å¸ç›˜çš„é™æ€è´Ÿè½½é¢å®šå€¼ä¸º60å…¬æ–¤ï¼Œå¯å®‰å…¨æ¬è¿ææ–™ã€‚'
            },
            {
              question: 'How should you clean the suction cup rubber pad after use? / ä½¿ç”¨åå¦‚ä½•æ¸…æ´å¸ç›˜æ©¡èƒ¶å«ï¼Ÿ',
              options: ['With harsh chemicals / ç”¨å¼ºåŠ›åŒ–å­¦å“', 'With mild detergent and water / ç”¨æ¸©å’Œæ´—æ¶¤å‰‚å’Œæ°´', 'With abrasive materials / ç”¨ç ”ç£¨ææ–™', 'No cleaning needed / ä¸éœ€è¦æ¸…æ´'],
              correct: 1,
              explanation: 'Clean with mild detergent and water. Avoid harsh chemicals or abrasives that could damage the rubber. / ç”¨æ¸©å’Œæ´—æ¶¤å‰‚å’Œæ°´æ¸…æ´ã€‚é¿å…ä½¿ç”¨å¯èƒ½æŸåæ©¡èƒ¶çš„å¼ºåŠ›åŒ–å­¦å“æˆ–ç ”ç£¨ææ–™ã€‚'
            },
            {
              question: 'Where should suction cups be stored? / å¸ç›˜åº”è¯¥å­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ',
              options: ['In direct sunlight / é˜³å…‰ç›´å°„å¤„', 'In a cool, dry place away from sunlight / é˜´å‡‰å¹²ç‡¥ã€é¿å…é˜³å…‰ç›´å°„çš„åœ°æ–¹', 'In water / æ°´ä¸­', 'Outside in the weather / æˆ·å¤–æš´éœ²åœ¨å¤©æ°”ä¸­'],
              correct: 1,
              explanation: 'Store in a cool, dry place away from direct sunlight. Heat and UV rays can degrade the rubber material. / å­˜æ”¾åœ¨é˜´å‡‰å¹²ç‡¥ã€é¿å…é˜³å…‰ç›´å°„çš„åœ°æ–¹ã€‚é«˜æ¸©å’Œç´«å¤–çº¿ä¼šé™è§£æ©¡èƒ¶ææ–™ã€‚'
            },
            {
              question: 'When moving materials with suction cups, you should: / ä½¿ç”¨å¸ç›˜ç§»åŠ¨ææ–™æ—¶ï¼Œä½ åº”è¯¥ï¼š',
              options: ['Move quickly to get it done / å¿«é€Ÿç§»åŠ¨ä»¥å®Œæˆä»»åŠ¡', 'Move slowly and smoothly with safe lifting techniques / ä½¿ç”¨å®‰å…¨æ¬è¿æŠ€æœ¯ç¼“æ…¢å¹³ç¨³ç§»åŠ¨', 'Swing the material around / æ‘†åŠ¨ææ–™', 'Drag it across surfaces / åœ¨è¡¨é¢ä¸Šæ‹–æ‹½'],
              correct: 1,
              explanation: 'Handle materials slowly and smoothly, using safe lifting techniques to avoid injury or damage. / ç¼“æ…¢å¹³ç¨³åœ°æ¬è¿ææ–™ï¼Œä½¿ç”¨å®‰å…¨æ¬è¿æŠ€æœ¯ä»¥é¿å…å—ä¼¤æˆ–æŸåã€‚'
            },
            {
              question: 'When should you replace a suction cup? / ä½•æ—¶åº”è¯¥æ›´æ¢å¸ç›˜ï¼Ÿ',
              options: ['Only when it completely fails / åªæœ‰å®Œå…¨å¤±æ•ˆæ—¶', 'When you notice cracks, deformations or loss of suction / å½“ä½ å‘ç°è£‚ç¼ã€å˜å½¢æˆ–å¸åŠ›ä¸‹é™æ—¶', 'Every week / æ¯å‘¨', 'Never, they last forever / æ°¸è¿œä¸ç”¨ï¼Œå®ƒä»¬æ°¸ä¹…è€ç”¨'],
              correct: 1,
              explanation: 'Replace immediately if you notice any cracks, deformations, or loss of suction capability. / å¦‚æœå‘ç°ä»»ä½•è£‚ç¼ã€å˜å½¢æˆ–å¸åŠ›ä¸‹é™ï¼Œè¯·ç«‹å³æ›´æ¢ã€‚'
            }
          ]
        }
      ];

      const handleAnswer = (questionIndex, answerIndex) => {
        setAnswers({...answers, [questionIndex]: answerIndex});
      };

      const calculateScore = () => {
        if (!selectedCourse) return 0;
        let correct = 0;
        selectedCourse.questions.forEach((q, i) => {
          if (answers[i] === q.correct) correct++;
        });
        return Math.round((correct / selectedCourse.questions.length) * 100);
      };

      const completeCourse = () => {
        const score = calculateScore();
        if (score >= 80) {
          const newCompleted = [...completedCourses, {
            courseId: selectedCourse.id,
            completedAt: new Date().toISOString(),
            score: score
          }];
          setCompletedCourses(newCompleted);
          localStorage.setItem('jmart-completed-training', JSON.stringify(newCompleted));
        }
        setShowResults(true);
      };

      const resetCourse = () => {
        setSelectedCourse(null);
        setCurrentQuestion(0);
        setAnswers({});
        setShowResults(false);
      };

      const isCompleted = (courseId) => completedCourses.some(c => c.courseId === courseId);

      // Generate PDF Certificate
      const generateCertificate = () => {
        const now = new Date();
        const dateStr = now.toLocaleDateString('en-AU', { day: 'numeric', month: 'long', year: 'numeric' });
        const timeStr = now.toLocaleTimeString('en-AU', { hour: '2-digit', minute: '2-digit' });
        const certId = 'JMS-' + now.getFullYear() + '-' + Math.random().toString(36).substr(2, 8).toUpperCase();

        const standardsList = selectedCourse.standards ? selectedCourse.standards.map(s => s.code).join('\\nâ€¢ ') : '';

        const htmlContent = `
          <!DOCTYPE html>
          <html>
          <head>
            <title>Training Certificate - ${selectedCourse.title}</title>
            <style>
              @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
              body { font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
              .header { text-align: center; border-bottom: 3px solid #f97316; padding-bottom: 20px; }
              .logo { font-size: 32px; font-weight: bold; color: #f97316; }
              .cert-title { font-size: 28px; color: #1f2937; margin: 30px 0; text-align: center; }
              .content { padding: 30px 0; }
              .field { margin: 15px 0; }
              .label { font-weight: bold; color: #6b7280; font-size: 12px; text-transform: uppercase; }
              .value { font-size: 18px; color: #1f2937; margin-top: 5px; }
              .standards { background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0; }
              .standards h4 { margin: 0 0 10px 0; color: #374151; }
              .standards ul { margin: 0; padding-left: 20px; }
              .standards li { margin: 5px 0; font-size: 14px; }
              .signature-box { margin-top: 40px; display: flex; gap: 40px; }
              .sig-area { flex: 1; }
              .sig-line { border-top: 2px solid #1f2937; margin-top: 60px; padding-top: 5px; }
              .sig-image { height: 60px; }
              .footer { margin-top: 40px; text-align: center; font-size: 12px; color: #9ca3af; }
              .pass-badge { background: #22c55e; color: white; padding: 10px 20px; border-radius: 50px; display: inline-block; font-weight: bold; }
              .cert-id { font-size: 11px; color: #9ca3af; }
            </style>
          </head>
          <body>
            <div class="header">
              <div class="logo">ğŸ—ï¸ JMart Steel</div>
              <p style="margin:5px 0;color:#6b7280;">Safety Training Certificate</p>
            </div>

            <h1 class="cert-title">${selectedCourse.title}</h1>

            <div style="text-align:center;margin:20px 0;">
              <span class="pass-badge">âœ“ PASSED - ${calculateScore()}%</span>
            </div>

            <div class="content">
              <div class="field">
                <div class="label">Certificate Awarded To</div>
                <div class="value">${workerName || 'Worker Name'}</div>
              </div>

              <div class="field">
                <div class="label">Course Completed</div>
                <div class="value">${selectedCourse.title}</div>
              </div>

              <div class="field">
                <div class="label">Date & Time</div>
                <div class="value">${dateStr} at ${timeStr}</div>
              </div>

              <div class="field">
                <div class="label">Duration</div>
                <div class="value">${selectedCourse.duration} â€¢ ${selectedCourse.questions.length} questions</div>
              </div>

              <div class="standards">
                <h4>ğŸ“‹ Australian Standards Referenced:</h4>
                <ul>
                  ${selectedCourse.standards ? selectedCourse.standards.map(s => '<li>' + s.code + '</li>').join('') : '<li>General WHS Guidelines</li>'}
                </ul>
              </div>

              <div class="signature-box">
                <div class="sig-area">
                  <div class="label">Worker Signature</div>
                  ${signatureData ? '<img src="' + signatureData + '" class="sig-image" />' : ''}
                  <div class="sig-line">${workerName || 'Worker Name'}</div>
                </div>
                <div class="sig-area">
                  <div class="label">Supervisor</div>
                  <div class="sig-line">JMart Steel Safety</div>
                </div>
              </div>
            </div>

            <div class="footer">
              <p class="cert-id">Certificate ID: ${certId}</p>
              <p>This certificate confirms completion of safety training in accordance with WHS requirements.</p>
              <p>Keep this record for compliance purposes. Valid for 12 months from date of issue.</p>
            </div>
          </body>
          </html>
        `;

        const blob = new Blob([htmlContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'JMart-Training-Certificate-' + selectedCourse.id + '-' + dateStr.replace(/ /g, '-') + '.html';
        a.click();
        URL.revokeObjectURL(url);
      };

      // Get QR Code URL for sharing
      const getAppUrl = () => window.location.href;

      // Course List View
      if (!selectedCourse) {
        return (
          <div className="space-y-4">
            {showQRCode && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={() => setShowQRCode(false)}>
                <div className="bg-white rounded-xl p-6 max-w-sm text-center" onClick={e => e.stopPropagation()}>
                  <h3 className="font-bold text-lg mb-3">ğŸ“± Share Training App</h3>
                  <p className="text-sm text-gray-600 mb-4">Workers can scan this QR code or use the link to access training on their phone</p>
                  <div className="bg-gray-100 p-4 rounded-lg mb-4">
                    <img src={'https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=' + encodeURIComponent(getAppUrl())} alt="QR Code" className="mx-auto" />
                  </div>
                  <div className="bg-gray-50 p-3 rounded-lg text-xs break-all text-gray-600 mb-4">{getAppUrl()}</div>
                  <button onClick={() => {navigator.clipboard.writeText(getAppUrl()); alert('Link copied!');}} className="w-full bg-orange-600 text-white p-3 rounded-lg font-semibold mb-2">ğŸ“‹ Copy Link</button>
                  <button onClick={() => setShowQRCode(false)} className="w-full bg-gray-200 p-3 rounded-lg font-semibold">Close</button>
                </div>
              </div>
            )}

            {viewingStandards && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={() => setViewingStandards(null)}>
                <div className="bg-white rounded-xl p-4 max-w-md w-full max-h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                  <h3 className="font-bold text-lg mb-3">ğŸ“‹ {viewingStandards.title} - Standards</h3>
                  <p className="text-sm text-gray-600 mb-4">This training references the following Australian Standards:</p>
                  <div className="space-y-3">
                    {viewingStandards.standards && viewingStandards.standards.map((s, i) => (
                      <a key={i} href={s.url} target="_blank" rel="noopener noreferrer" className="block bg-blue-50 p-3 rounded-lg hover:bg-blue-100 transition-colors">
                        <p className="font-medium text-blue-800 text-sm">{s.code}</p>
                        <p className="text-xs text-blue-600 mt-1">ğŸ”— View Standard â†’</p>
                      </a>
                    ))}
                  </div>
                  <button onClick={() => setViewingStandards(null)} className="w-full bg-gray-200 p-3 rounded-lg font-semibold mt-4">Close</button>
                </div>
              </div>
            )}

            <div className="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-4 rounded-xl">
              <div className="flex items-center justify-between">
                <div>
                  <h2 className="text-xl font-bold">ğŸ“š Training Courses</h2>
                  <p className="text-sm opacity-90 mt-1">Complete courses to stay safe on site</p>
                </div>
                <button onClick={() => setShowQRCode(true)} className="bg-white bg-opacity-20 p-2 rounded-lg hover:bg-opacity-30" title="Share with workers">
                  <span className="text-2xl">ğŸ“±</span>
                </button>
              </div>
            </div>

            <div className="grid gap-3">
              {courses.map(course => (
                <div key={course.id} className="bg-white p-4 rounded-xl shadow-sm">
                  <div className="flex items-center gap-4">
                    <div className="text-4xl">{course.image}</div>
                    <div className="flex-1">
                      <div className="flex items-center gap-2">
                        <h3 className="font-semibold text-gray-900">{course.title}</h3>
                        {isCompleted(course.id) && <span className="text-green-500 text-lg">âœ…</span>}
                      </div>
                      <p className="text-sm text-gray-600">{course.description}</p>
                      <p className="text-xs text-gray-400 mt-1">â±ï¸ {course.duration} â€¢ {course.questions.length} questions</p>
                    </div>
                  </div>
                  <div className="flex gap-2 mt-3">
                    <button onClick={() => setSelectedCourse(course)} className="flex-1 bg-orange-600 text-white p-2 rounded-lg font-semibold text-sm">
                      Start Course â–¶
                    </button>
                    {course.standards && (
                      <button onClick={() => setViewingStandards(course)} className="bg-blue-100 text-blue-700 p-2 rounded-lg text-sm font-medium">
                        ğŸ“‹ Standards
                      </button>
                    )}
                  </div>
                </div>
              ))}
            </div>

            {completedCourses.length > 0 && (
              <div className="bg-green-50 border border-green-200 p-4 rounded-xl mt-4">
                <h3 className="font-semibold text-green-800">ğŸ‰ Completed Training</h3>
                <p className="text-sm text-green-600">{completedCourses.length} of {courses.length} courses completed</p>
              </div>
            )}
          </div>
        );
      }

      // Results View
      if (showResults) {
        const score = calculateScore();
        const passed = score >= 80;

        // Show signature pad
        if (showSignature) {
          return (
            <SignaturePad
              name={workerName}
              onSave={(sig) => {
                setSignatureData(sig);
                setShowSignature(false);
                setShowCertificate(true);
              }}
              onCancel={() => setShowSignature(false)}
            />
          );
        }

        // Show certificate ready screen
        if (showCertificate) {
          return (
            <div className="space-y-4">
              <div className="bg-green-500 text-white p-6 rounded-xl text-center">
                <div className="text-6xl mb-4">ğŸ“</div>
                <h2 className="text-2xl font-bold">Certificate Ready!</h2>
                <p className="mt-2">Your training certificate has been prepared</p>
              </div>

              <div className="bg-white rounded-xl p-4 space-y-4">
                <div className="text-center">
                  <p className="text-4xl mb-2">{selectedCourse.image}</p>
                  <h3 className="font-bold text-lg">{selectedCourse.title}</h3>
                  <p className="text-green-600 font-semibold">Score: {score}% âœ“</p>
                </div>

                <div className="border-t pt-4">
                  <p className="text-sm text-gray-600 mb-2"><strong>Worker:</strong> {workerName}</p>
                  <p className="text-sm text-gray-600 mb-2"><strong>Date:</strong> {new Date().toLocaleDateString('en-AU')}</p>
                  {signatureData && (
                    <div className="mt-3">
                      <p className="text-xs text-gray-500 mb-1">Signature:</p>
                      <img src={signatureData} alt="Signature" className="h-12 border rounded" />
                    </div>
                  )}
                </div>

                {selectedCourse.standards && (
                  <div className="bg-blue-50 p-3 rounded-lg">
                    <p className="text-xs font-semibold text-blue-800 mb-2">ğŸ“‹ Standards Referenced:</p>
                    {selectedCourse.standards.map((s, i) => (
                      <p key={i} className="text-xs text-blue-700">â€¢ {s.code}</p>
                    ))}
                  </div>
                )}
              </div>

              <button onClick={generateCertificate} className="w-full bg-green-600 text-white p-4 rounded-xl font-semibold">
                ğŸ“¥ Download Certificate
              </button>

              <button onClick={resetCourse} className="w-full bg-gray-200 text-gray-700 p-4 rounded-xl font-semibold">
                Back to Courses
              </button>
            </div>
          );
        }

        return (
          <div className="space-y-4">
            <div className={`${passed ? 'bg-green-500' : 'bg-red-500'} text-white p-6 rounded-xl text-center`}>
              <div className="text-6xl mb-4">{passed ? 'ğŸ‰' : 'ğŸ“š'}</div>
              <h2 className="text-2xl font-bold">{passed ? 'Congratulations!' : 'Keep Learning!'}</h2>
              <p className="text-4xl font-bold mt-2">{score}%</p>
              <p className="mt-2">{passed ? 'You passed the course!' : 'You need 80% to pass. Try again!'}</p>
            </div>

            {passed && (
              <div className="bg-white rounded-xl p-4 space-y-3">
                <h3 className="font-semibold">ğŸ“ Sign & Get Certificate</h3>
                <p className="text-sm text-gray-600">Enter your name and sign to receive your training certificate.</p>
                <input
                  type="text"
                  placeholder="Enter your full name"
                  value={workerName}
                  onChange={(e) => setWorkerName(e.target.value)}
                  className="w-full p-3 border rounded-lg"
                />
                <button
                  onClick={() => setShowSignature(true)}
                  disabled={!workerName.trim()}
                  className={`w-full p-3 rounded-lg font-semibold ${workerName.trim() ? 'bg-blue-600 text-white' : 'bg-gray-300 text-gray-500'}`}
                >
                  âœï¸ Sign Certificate
                </button>
              </div>
            )}

            <div className="bg-white rounded-xl p-4 space-y-3">
              <h3 className="font-semibold">Review Your Answers</h3>
              {selectedCourse.questions.map((q, i) => (
                <div key={i} className={`p-3 rounded-lg ${answers[i] === q.correct ? 'bg-green-50' : 'bg-red-50'}`}>
                  <p className="font-medium text-sm">{q.question}</p>
                  <p className="text-xs mt-1">Your answer: {q.options[answers[i]]}</p>
                  {answers[i] !== q.correct && (
                    <p className="text-xs text-green-700 mt-1">Correct: {q.options[q.correct]}</p>
                  )}
                  <p className="text-xs text-gray-500 mt-1 italic">{q.explanation}</p>
                </div>
              ))}
            </div>

            <button onClick={resetCourse} className="w-full bg-orange-600 text-white p-4 rounded-xl font-semibold">
              Back to Courses
            </button>
          </div>
        );
      }

      // Quiz View
      const question = selectedCourse.questions[currentQuestion];
      const progress = ((currentQuestion + 1) / selectedCourse.questions.length) * 100;

      return (
        <div className="space-y-4">
          <div className="bg-white rounded-xl p-4 shadow-sm">
            <div className="flex items-center justify-between mb-2">
              <button onClick={resetCourse} className="text-gray-500">âœ• Exit</button>
              <span className="text-sm text-gray-500">{currentQuestion + 1} / {selectedCourse.questions.length}</span>
            </div>
            <div className="w-full bg-gray-200 rounded-full h-2">
              <div className="bg-orange-500 h-2 rounded-full transition-all" style={{width: `${progress}%`}}></div>
            </div>
          </div>

          <div className="bg-white rounded-xl p-4 shadow-sm">
            <div className="text-center mb-4">
              <span className="text-4xl">{selectedCourse.image}</span>
              <h2 className="font-bold text-lg mt-2">{selectedCourse.title}</h2>
            </div>

            <div className="bg-gray-50 p-4 rounded-lg mb-4">
              <p className="font-medium text-gray-900">{question.question}</p>
            </div>

            <div className="space-y-2">
              {question.options.map((option, i) => (
                <button
                  key={i}
                  onClick={() => handleAnswer(currentQuestion, i)}
                  className={`w-full p-3 rounded-lg text-left transition-colors ${
                    answers[currentQuestion] === i
                      ? 'bg-orange-500 text-white'
                      : 'bg-gray-100 hover:bg-gray-200'
                  }`}
                >
                  {option}
                </button>
              ))}
            </div>
          </div>

          <div className="flex gap-3">
            {currentQuestion > 0 && (
              <button
                onClick={() => setCurrentQuestion(currentQuestion - 1)}
                className="flex-1 bg-gray-200 p-4 rounded-xl font-semibold"
              >
                â† Previous
              </button>
            )}
            {currentQuestion < selectedCourse.questions.length - 1 ? (
              <button
                onClick={() => setCurrentQuestion(currentQuestion + 1)}
                disabled={answers[currentQuestion] === undefined}
                className={`flex-1 p-4 rounded-xl font-semibold ${
                  answers[currentQuestion] !== undefined
                    ? 'bg-orange-600 text-white'
                    : 'bg-gray-300 text-gray-500'
                }`}
              >
                Next â†’
              </button>
            ) : (
              <button
                onClick={completeCourse}
                disabled={answers[currentQuestion] === undefined}
                className={`flex-1 p-4 rounded-xl font-semibold ${
                  answers[currentQuestion] !== undefined
                    ? 'bg-green-600 text-white'
                    : 'bg-gray-300 text-gray-500'
                }`}
              >
                Complete âœ“
              </button>
            )}
          </div>
        </div>
      );
    }

    // Pre-Start View
    function PrestartView({ onSubmit, previousPrestarts = [], sites = [] }) {
      const [step, setStep] = useState(1);
      const [checkType, setCheckType] = useState(null);
      const [checks, setChecks] = useState({});
      const [notes, setNotes] = useState('');
      const [submitted, setSubmitted] = useState(false);
      const [signingWorker, setSigningWorker] = useState(null);
      const [showPreviousList, setShowPreviousList] = useState(false);
      const [supervisorName, setSupervisorName] = useState('');
      const [siteConducted, setSiteConducted] = useState('');
      const [builder, setBuilder] = useState('');
      const [address, setAddress] = useState('');
      const [isLocating, setIsLocating] = useState(false);

      const [workAreas, setWorkAreas] = useState({ value: '', notes: [], media: [] });
      const [tasksThisShift, setTasksThisShift] = useState({ value: '', notes: [], media: [] });
      const [machineryControls, setMachineryControls] = useState({ value: '', notes: [], media: [] });
      const [siteHazards, setSiteHazards] = useState({ value: '', notes: [], media: [] });
      const [permitsRequired, setPermitsRequired] = useState({ value: '', notes: [], media: [] });

      // New fields
      const [isPlantEquipmentUsed, setIsPlantEquipmentUsed] = useState(null); // yes/no
      const [highRiskWorks, setHighRiskWorks] = useState(null); // yes/no/na
      const [worksCoveredBySWMS, setWorksCoveredBySWMS] = useState(null); // yes/no/na
      const [hasSafetyIssues, setHasSafetyIssues] = useState(null); // yes/no
      const [safetyIssuesPreviousShift, setSafetyIssuesPreviousShift] = useState({ value: '', notes: [], media: [] });
      const [translatorRequired, setTranslatorRequired] = useState(null); // yes/no
      const [translatorSignature, setTranslatorSignature] = useState(null);
      const [translatorName, setTranslatorName] = useState('');
      const [signingTranslator, setSigningTranslator] = useState(false);

      const [signatures, setSignatures] = useState({
        'Jeff Fu': null, 'Scott Seeho': null, 'Davide Casolini': null,
        'Zonggang Jiang': null, 'Leon Yu': null, 'Wang Jia': null, 'Gen Bao': null,
      });

      const todayDate = new Date().toLocaleDateString('en-AU', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
      const builders = ['Fdc Fitout and Refurbishment', 'Fdc Construction', 'Hunter Mason', 'Built', 'Landlease'];
      const defaultSites = ['Site 1 - Sydney CBD', 'Site 2 - Parramatta', 'Site 3 - North Sydney', 'Site 4 - Chatswood', 'Site 5 - Liverpool'];
      const sitesList = sites.length > 0 ? sites : defaultSites;
      const teamMembers = ['Jeff Fu', 'Scott Seeho', 'Davide Casolini', 'Zonggang Jiang', 'Leon Yu', 'Wang Jia', 'Gen Bao'];

      const checklistTypes = [
        { id: 'site', label: 'Site Pre-Start', emoji: 'ğŸ—ï¸', color: 'bg-blue-500' },
        { id: 'crane', label: 'Crane/Hoist', emoji: 'ğŸ—ï¸', color: 'bg-orange-500' },
        { id: 'forklift', label: 'Forklift', emoji: 'ğŸšœ', color: 'bg-green-500' },
        { id: 'vehicle', label: 'Vehicle', emoji: 'ğŸš—', color: 'bg-purple-500' },
        { id: 'welding', label: 'Welding Equipment', emoji: 'ğŸ”¥', color: 'bg-red-500' },
        { id: 'scaffold', label: 'Scaffold', emoji: 'ğŸªœ', color: 'bg-yellow-500' },
      ];

      const checklistItems = {
        site: [
          { id: 's1', text: 'Site access and egress points clear' },
          { id: 's2', text: 'Exclusion zones and barriers in place' },
          { id: 's3', text: 'First aid kit available and stocked' },
          { id: 's4', text: 'Emergency assembly point identified' },
          { id: 's5', text: 'Fire extinguishers available' },
          { id: 's6', text: 'Site amenities available' },
          { id: 's7', text: 'Electrical leads safe' },
          { id: 's8', text: 'Work area clean and tidy' },
          { id: 's9', text: 'Weather conditions suitable' },
          { id: 's10', text: 'All workers inducted' },
        ],
        crane: [
          { id: 'c1', text: 'Visual inspection completed' },
          { id: 'c2', text: 'Safety devices operational' },
          { id: 'c3', text: 'Load chart available' },
          { id: 'c4', text: 'Wire ropes in good condition' },
          { id: 'c5', text: 'Hooks and latches functioning' },
        ],
        forklift: [
          { id: 'f1', text: 'Pre-operational walk around done' },
          { id: 'f2', text: 'Tyres in good condition' },
          { id: 'f3', text: 'Forks not bent or cracked' },
          { id: 'f4', text: 'Brakes functioning' },
          { id: 'f5', text: 'Horn and lights working' },
        ],
        vehicle: [
          { id: 'v1', text: 'Lights and indicators working' },
          { id: 'v2', text: 'Tyres in good condition' },
          { id: 'v3', text: 'Brakes functioning' },
          { id: 'v4', text: 'Windscreen clear' },
          { id: 'v5', text: 'First aid kit present' },
        ],
        welding: [
          { id: 'w1', text: 'Welding leads inspected' },
          { id: 'w2', text: 'Earth clamp secure' },
          { id: 'w3', text: 'Gas bottles secured' },
          { id: 'w4', text: 'Fire extinguisher nearby' },
          { id: 'w5', text: 'PPE available' },
        ],
        scaffold: [
          { id: 'sc1', text: 'Scaffold tag current' },
          { id: 'sc2', text: 'Base plates in place' },
          { id: 'sc3', text: 'Guardrails in place' },
          { id: 'sc4', text: 'Safe access provided' },
          { id: 'sc5', text: 'No overloading' },
        ],
      };

      const getLocation = () => {
        setIsLocating(true);
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            async (position) => {
              try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${position.coords.latitude}&lon=${position.coords.longitude}`);
                const data = await response.json();
                setAddress(data.display_name || `${position.coords.latitude}, ${position.coords.longitude}`);
              } catch (e) {
                setAddress(`${position.coords.latitude}, ${position.coords.longitude}`);
              }
              setIsLocating(false);
            },
            () => { alert('Unable to get location'); setIsLocating(false); },
            { enableHighAccuracy: true, timeout: 10000 }
          );
        }
      };

      const handleSubmit = () => {
        onSubmit({
          type: checkType, checks, notes, signatures, supervisorName, siteConducted, builder, address,
          workAreas, tasksThisShift, machineryControls, siteHazards, permitsRequired,
          isPlantEquipmentUsed, highRiskWorks, worksCoveredBySWMS, hasSafetyIssues, safetyIssuesPreviousShift,
          translatorRequired, translatorSignature, translatorName,
          date: new Date().toISOString()
        });
        setSubmitted(true);
      };

      const resetForm = () => {
        setStep(1); setCheckType(null); setChecks({}); setNotes('');
        setSupervisorName(''); setSiteConducted(''); setBuilder(''); setAddress('');
        setWorkAreas({ value: '', notes: [], media: [] });
        setTasksThisShift({ value: '', notes: [], media: [] });
        setMachineryControls({ value: '', notes: [], media: [] });
        setSiteHazards({ value: '', notes: [], media: [] });
        setPermitsRequired({ value: '', notes: [], media: [] });
        setIsPlantEquipmentUsed(null);
        setHighRiskWorks(null);
        setWorksCoveredBySWMS(null);
        setHasSafetyIssues(null);
        setSafetyIssuesPreviousShift({ value: '', notes: [], media: [] });
        setTranslatorRequired(null);
        setTranslatorSignature(null);
        setTranslatorName('');
        setSigningTranslator(false);
        setSignatures({ 'Jeff Fu': null, 'Scott Seeho': null, 'Davide Casolini': null, 'Zonggang Jiang': null, 'Leon Yu': null, 'Wang Jia': null, 'Gen Bao': null });
        setSubmitted(false);
      };

      if (submitted) {
        const signedCount = Object.values(signatures).filter(s => s !== null).length;
        return (
          <div className="text-center py-12">
            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">âœ…</div>
            <h2 className="text-2xl font-bold text-gray-800 mb-2">Pre-Start Complete!</h2>
            <p className="text-gray-600 mb-2">Your checklist has been recorded.</p>
            <p className="text-sm text-gray-500 mb-6">{signedCount} worker(s) signed on</p>
            <button onClick={resetForm} className="bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold">Start Another Check</button>
          </div>
        );
      }

      if (step === 1) {
        return (
          <div className="space-y-4">
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">ğŸ“‹ Pre-Start Checklists</h2>
              <p className="text-gray-500 text-sm mt-1">Select the type of pre-start check</p>
            </div>
            <div className="grid grid-cols-2 gap-3">
              {checklistTypes.map((type) => (
                <button key={type.id} onClick={() => { setCheckType(type.id); setStep(2); }}
                  className="bg-white rounded-xl p-4 shadow-sm flex flex-col items-center gap-3 hover:shadow-md">
                  <div className={`w-14 h-14 ${type.color} rounded-full flex items-center justify-center text-2xl`}>{type.emoji}</div>
                  <span className="font-medium text-gray-700 text-center">{type.label}</span>
                </button>
              ))}
            </div>
          </div>
        );
      }

      const items = checklistItems[checkType] || [];
      const allChecked = items.every(item => checks[item.id] !== undefined);
      const signedCount = Object.values(signatures).filter(s => s !== null).length;

      if (step === 2) {
        return (
          <div className="space-y-4">
            {signingWorker && <SignaturePad name={signingWorker} onSave={(data) => { setSignatures({...signatures, [signingWorker]: data}); setSigningWorker(null); }} onCancel={() => setSigningWorker(null)} />}

            <div className="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-4 text-white">
              <div className="flex items-center gap-2">
                <span>ğŸ“…</span>
                <span className="font-bold text-lg">{todayDate}</span>
              </div>
            </div>

            <div className="bg-white rounded-xl p-4 shadow-sm">
              <div className="flex items-center justify-between">
                <h2 className="text-xl font-bold text-gray-800">{checklistTypes.find(t => t.id === checkType)?.label}</h2>
                <button onClick={() => setStep(1)} className="text-gray-500 text-xl">âœ•</button>
              </div>
            </div>

            <div className="bg-white rounded-xl p-4 shadow-sm space-y-4">
              <h3 className="font-semibold text-gray-800">Site Details</h3>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ğŸ‘¤ Supervisor Name *</label>
                <input type="text" value={supervisorName} onChange={(e) => setSupervisorName(e.target.value)}
                  className="w-full border border-gray-300 rounded-lg p-3" placeholder="Enter supervisor name" />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Site Conducted *</label>
                <select value={siteConducted} onChange={(e) => setSiteConducted(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 bg-white">
                  <option value="">Select Site</option>
                  {sitesList.map((site) => <option key={site} value={site}>{site}</option>)}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Builder *</label>
                <select value={builder} onChange={(e) => setBuilder(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 bg-white">
                  <option value="">Select Builder</option>
                  {builders.map((b) => <option key={b} value={b}>{b}</option>)}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ğŸ“ Address *</label>
                <div className="flex gap-2">
                  <input type="text" value={address} onChange={(e) => setAddress(e.target.value)}
                    className="flex-1 border border-gray-300 rounded-lg p-3" placeholder="Enter site address" />
                  <button onClick={getLocation} disabled={isLocating}
                    className="bg-blue-600 text-white px-4 rounded-lg disabled:bg-blue-400">
                    {isLocating ? '...' : 'ğŸ“'}
                  </button>
                </div>
              </div>
            </div>

            <NoteMediaBox label="Work Areas" value={workAreas.value} notes={workAreas.notes} media={workAreas.media}
              onValueChange={(val) => setWorkAreas({...workAreas, value: val})}
              onAddNote={(note) => setWorkAreas({...workAreas, notes: [...workAreas.notes, note]})}
              onAddMedia={(item) => setWorkAreas({...workAreas, media: [...workAreas.media, item]})}
              onRemoveNote={(idx) => setWorkAreas({...workAreas, notes: workAreas.notes.filter((_, i) => i !== idx)})}
              onRemoveMedia={(idx) => setWorkAreas({...workAreas, media: workAreas.media.filter((_, i) => i !== idx)})} />

            <NoteMediaBox label="Task to be Completed this Shift" value={tasksThisShift.value} notes={tasksThisShift.notes} media={tasksThisShift.media}
              onValueChange={(val) => setTasksThisShift({...tasksThisShift, value: val})}
              onAddNote={(note) => setTasksThisShift({...tasksThisShift, notes: [...tasksThisShift.notes, note]})}
              onAddMedia={(item) => setTasksThisShift({...tasksThisShift, media: [...tasksThisShift.media, item]})}
              onRemoveNote={(idx) => setTasksThisShift({...tasksThisShift, notes: tasksThisShift.notes.filter((_, i) => i !== idx)})}
              onRemoveMedia={(idx) => setTasksThisShift({...tasksThisShift, media: tasksThisShift.media.filter((_, i) => i !== idx)})} />

            {/* Is Plant/Equipment to be used? */}
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <h4 className="font-semibold text-gray-800 mb-3">ğŸšœ Is Plant/Equipment to be used?</h4>
              <div className="flex gap-3">
                <button onClick={() => setIsPlantEquipmentUsed(true)}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${isPlantEquipmentUsed === true ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  Yes
                </button>
                <button onClick={() => setIsPlantEquipmentUsed(false)}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${isPlantEquipmentUsed === false ? 'bg-red-500 border-red-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  No
                </button>
              </div>
            </div>

            {/* Conditional Machinery Controls - only shows if Plant/Equipment is Yes */}
            {isPlantEquipmentUsed === true && (
              <NoteMediaBox label="Controls Required for Machinery / Plants" value={machineryControls.value} notes={machineryControls.notes} media={machineryControls.media}
                onValueChange={(val) => setMachineryControls({...machineryControls, value: val})}
                onAddNote={(note) => setMachineryControls({...machineryControls, notes: [...machineryControls.notes, note]})}
                onAddMedia={(item) => setMachineryControls({...machineryControls, media: [...machineryControls.media, item]})}
                onRemoveNote={(idx) => setMachineryControls({...machineryControls, notes: machineryControls.notes.filter((_, i) => i !== idx)})}
                onRemoveMedia={(idx) => setMachineryControls({...machineryControls, media: machineryControls.media.filter((_, i) => i !== idx)})} />
            )}

            {/* Site Specific Hazards - text box only */}
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <h4 className="font-semibold text-gray-800 text-orange-600 mb-3">Site Specific Hazards</h4>
              <textarea value={siteHazards.value} onChange={(e) => setSiteHazards({...siteHazards, value: e.target.value})}
                className="w-full border border-gray-300 rounded-lg p-3 text-sm min-h-[80px]"
                placeholder="Enter site specific hazards..." />
            </div>

            {/* Site Specific Permits Required - text box only */}
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <h4 className="font-semibold text-gray-800 text-orange-600 mb-3">Site Specific Permits Required</h4>
              <textarea value={permitsRequired.value} onChange={(e) => setPermitsRequired({...permitsRequired, value: e.target.value})}
                className="w-full border border-gray-300 rounded-lg p-3 text-sm min-h-[80px]"
                placeholder="Enter permits required..." />
            </div>

            {/* High Risk Works? */}
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <h4 className="font-semibold text-gray-800 mb-3">âš ï¸ High Risk Works?</h4>
              <div className="flex gap-3">
                <button onClick={() => setHighRiskWorks('yes')}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${highRiskWorks === 'yes' ? 'bg-red-500 border-red-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  Yes
                </button>
                <button onClick={() => setHighRiskWorks('no')}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${highRiskWorks === 'no' ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  No
                </button>
                <button onClick={() => setHighRiskWorks('na')}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${highRiskWorks === 'na' ? 'bg-gray-500 border-gray-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  N/A
                </button>
              </div>
            </div>

            {/* Works performed are covered by SWMS? */}
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <h4 className="font-semibold text-gray-800 mb-3">ğŸ“‹ Works performed are covered by SWMS?</h4>
              <div className="flex gap-3">
                <button onClick={() => setWorksCoveredBySWMS('yes')}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${worksCoveredBySWMS === 'yes' ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  Yes
                </button>
                <button onClick={() => setWorksCoveredBySWMS('no')}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${worksCoveredBySWMS === 'no' ? 'bg-red-500 border-red-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  No
                </button>
                <button onClick={() => setWorksCoveredBySWMS('na')}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${worksCoveredBySWMS === 'na' ? 'bg-gray-500 border-gray-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  N/A
                </button>
              </div>
            </div>

            {/* Safety issues/incidents from previous shift */}
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <h4 className="font-semibold text-gray-800 mb-3">âš ï¸ Safety Issues/Incidents from Previous Shift or Industry Safety Notices?</h4>
              <div className="flex gap-3">
                <button onClick={() => setHasSafetyIssues(true)}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${hasSafetyIssues === true ? 'bg-red-500 border-red-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  Yes
                </button>
                <button onClick={() => { setHasSafetyIssues(false); setSafetyIssuesPreviousShift({ value: '', notes: [], media: [] }); }}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${hasSafetyIssues === false ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  No
                </button>
              </div>
            </div>

            {/* Conditional Safety Issues Box - only shows if Yes */}
            {hasSafetyIssues === true && (
              <NoteMediaBox label="Safety Issues/Incidents Details" value={safetyIssuesPreviousShift.value} notes={safetyIssuesPreviousShift.notes} media={safetyIssuesPreviousShift.media}
                onValueChange={(val) => setSafetyIssuesPreviousShift({...safetyIssuesPreviousShift, value: val})}
                onAddNote={(note) => setSafetyIssuesPreviousShift({...safetyIssuesPreviousShift, notes: [...safetyIssuesPreviousShift.notes, note]})}
                onAddMedia={(item) => setSafetyIssuesPreviousShift({...safetyIssuesPreviousShift, media: [...safetyIssuesPreviousShift.media, item]})}
                onRemoveNote={(idx) => setSafetyIssuesPreviousShift({...safetyIssuesPreviousShift, notes: safetyIssuesPreviousShift.notes.filter((_, i) => i !== idx)})}
                onRemoveMedia={(idx) => setSafetyIssuesPreviousShift({...safetyIssuesPreviousShift, media: safetyIssuesPreviousShift.media.filter((_, i) => i !== idx)})} />
            )}

            <div className="bg-white rounded-xl shadow-sm divide-y">
              {items.map((item, idx) => (
                <div key={item.id} className="p-4">
                  <div className="flex items-start justify-between gap-3">
                    <span className="text-gray-700">{idx + 1}. {item.text}</span>
                    <div className="flex gap-2">
                      <button onClick={() => setChecks({...checks, [item.id]: true})}
                        className={`w-10 h-10 rounded-lg flex items-center justify-center border-2 ${checks[item.id] === true ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300'}`}>âœ“</button>
                      <button onClick={() => setChecks({...checks, [item.id]: false})}
                        className={`w-10 h-10 rounded-lg flex items-center justify-center border-2 ${checks[item.id] === false ? 'bg-red-500 border-red-500 text-white' : 'border-gray-300'}`}>âœ•</button>
                    </div>
                  </div>
                </div>
              ))}
            </div>

            <div className="bg-white rounded-xl p-4 shadow-sm">
              <label className="block text-sm font-medium text-gray-700 mb-2">Notes / Issues</label>
              <textarea value={notes} onChange={(e) => setNotes(e.target.value)}
                className="w-full border border-gray-300 rounded-lg p-3" rows={3} placeholder="Record any issues..." />
            </div>

            <button onClick={() => setStep(3)} disabled={!allChecked || !supervisorName || !siteConducted || !builder || !address}
              className="w-full bg-orange-600 text-white py-4 rounded-xl font-semibold disabled:bg-gray-300">
              Next: Worker Sign-On â†’
            </button>
          </div>
        );
      }

      if (step === 3) {
        return (
          <div className="space-y-4">
            {signingWorker && <SignaturePad name={signingWorker} onSave={(data) => { setSignatures({...signatures, [signingWorker]: data}); setSigningWorker(null); }} onCancel={() => setSigningWorker(null)} />}
            {signingTranslator && <SignaturePad name={translatorName || "Translator"} onSave={(data) => { setTranslatorSignature(data); setSigningTranslator(false); }} onCancel={() => setSigningTranslator(false)} />}

            <div className="bg-white rounded-xl p-4 shadow-sm">
              <div className="flex items-center justify-between">
                <h2 className="text-xl font-bold text-gray-800">Worker Sign-On</h2>
                <button onClick={() => setStep(2)} className="text-gray-500">â† Back</button>
              </div>
              <p className="text-gray-500 text-sm mt-1">Tap on a signature box to sign</p>
            </div>

            {/* Translator Required? */}
            <div className="bg-white rounded-xl p-4 shadow-sm">
              <h4 className="font-semibold text-gray-800 mb-3">ğŸŒ Translator Required?</h4>
              <div className="flex gap-3 mb-4">
                <button onClick={() => setTranslatorRequired(true)}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${translatorRequired === true ? 'bg-blue-500 border-blue-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  Yes
                </button>
                <button onClick={() => { setTranslatorRequired(false); setTranslatorSignature(null); setTranslatorName(''); }}
                  className={`flex-1 py-3 rounded-lg font-medium border-2 ${translatorRequired === false ? 'bg-gray-500 border-gray-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                  No
                </button>
              </div>

              {/* Translator Signoff - only shows if Translator Required is Yes */}
              {translatorRequired === true && (
                <div className="border-t pt-4 space-y-3">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Translator Name *</label>
                    <input type="text" value={translatorName} onChange={(e) => setTranslatorName(e.target.value)}
                      className="w-full border border-gray-300 rounded-lg p-3" placeholder="Enter translator name" />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Translator Signature *</label>
                    {translatorSignature ? (
                      <div className="relative inline-block">
                        <div className="border-2 border-green-500 rounded-lg p-2 bg-green-50 h-20 w-40">
                          <img src={translatorSignature} alt="translator signature" className="h-full w-full object-contain" />
                        </div>
                        <button onClick={() => setTranslatorSignature(null)}
                          className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-sm">âœ•</button>
                      </div>
                    ) : (
                      <button onClick={() => setSigningTranslator(true)}
                        className="h-20 w-40 border-2 border-dashed border-blue-300 rounded-lg text-blue-500 hover:border-blue-500">
                        Tap to sign
                      </button>
                    )}
                  </div>
                </div>
              )}
            </div>

            <div className="bg-white rounded-xl shadow-sm divide-y">
              {teamMembers.map((name) => (
                <div key={name} className="p-4 flex items-center justify-between">
                  <span className="font-medium text-gray-800">{name}</span>
                  {signatures[name] ? (
                    <div className="relative">
                      <div className="border-2 border-green-500 rounded-lg p-2 bg-green-50 h-16 w-32">
                        <img src={signatures[name]} alt="signature" className="h-full w-full object-contain" />
                      </div>
                      <button onClick={() => setSignatures({...signatures, [name]: null})}
                        className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-sm">âœ•</button>
                    </div>
                  ) : (
                    <button onClick={() => setSigningWorker(name)}
                      className="h-16 w-32 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-orange-500">
                      Tap to sign
                    </button>
                  )}
                </div>
              ))}
            </div>

            <div className="bg-blue-50 border border-blue-200 rounded-xl p-4">
              <p className="text-blue-800 font-medium">{signedCount} of {teamMembers.length} workers signed</p>
            </div>

            <div className="flex gap-3">
              <button onClick={() => setStep(2)} className="flex-1 border border-gray-300 text-gray-700 py-4 rounded-xl font-semibold">â† Back</button>
              <button onClick={handleSubmit} disabled={signedCount === 0} className="flex-1 bg-green-600 text-white py-4 rounded-xl font-semibold disabled:bg-gray-300">
                âœ“ Complete Pre-Start
              </button>
            </div>
          </div>
        );
      }

      return null;
    }

    // Incident View
    function IncidentView({ onSubmit }) {
      const [step, setStep] = useState(1);
      const [formData, setFormData] = useState({
        type: '', date: new Date().toISOString().split('T')[0], time: new Date().toTimeString().slice(0, 5),
        location: '', description: '', injuries: 'none', injuryDetails: '', witnesses: '', immediateActions: '', reportedBy: '',
      });

      const incidentTypes = [
        { id: 'nearmiss', label: 'Near Miss', description: 'Could have caused injury', color: 'bg-yellow-500' },
        { id: 'injury', label: 'Injury', description: 'Resulted in injury', color: 'bg-red-500' },
        { id: 'damage', label: 'Property Damage', description: 'Equipment/property damage', color: 'bg-orange-500' },
        { id: 'environmental', label: 'Environmental', description: 'Spill/leak/environmental', color: 'bg-green-500' },
      ];

      if (step === 4) {
        return (
          <div className="text-center py-12">
            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">âœ…</div>
            <h2 className="text-2xl font-bold text-gray-800 mb-2">Report Submitted!</h2>
            <p className="text-gray-600 mb-6">Reference: INC-{Date.now().toString().slice(-6)}</p>
            <button onClick={() => setStep(1)} className="bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold">Submit Another</button>
          </div>
        );
      }

      return (
        <div className="space-y-4">
          <div className="bg-white rounded-xl p-4 shadow-sm">
            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">âš ï¸ Incident / Near Miss Report</h2>
            <p className="text-gray-500 text-sm mt-1">Report all incidents within 24 hours</p>
          </div>

          {step === 1 && (
            <div className="space-y-3">
              {incidentTypes.map((type) => (
                <button key={type.id} onClick={() => { setFormData({...formData, type: type.id}); setStep(2); }}
                  className="w-full bg-white rounded-xl p-4 shadow-sm flex items-center gap-4">
                  <div className={`w-12 h-12 ${type.color} rounded-full flex items-center justify-center text-white text-xl`}>âš ï¸</div>
                  <div className="text-left">
                    <p className="font-semibold text-gray-800">{type.label}</p>
                    <p className="text-sm text-gray-500">{type.description}</p>
                  </div>
                </button>
              ))}
            </div>
          )}

          {step === 2 && (
            <div className="bg-white rounded-xl p-4 shadow-sm space-y-4">
              <h3 className="font-semibold text-gray-800">Incident Details</h3>
              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Date *</label>
                  <input type="date" value={formData.date} onChange={(e) => setFormData({...formData, date: e.target.value})} className="w-full border rounded-lg p-3" />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Time *</label>
                  <input type="time" value={formData.time} onChange={(e) => setFormData({...formData, time: e.target.value})} className="w-full border rounded-lg p-3" />
                </div>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Location *</label>
                <input type="text" value={formData.location} onChange={(e) => setFormData({...formData, location: e.target.value})} className="w-full border rounded-lg p-3" placeholder="Where did this occur?" />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Description *</label>
                <textarea value={formData.description} onChange={(e) => setFormData({...formData, description: e.target.value})} className="w-full border rounded-lg p-3" rows={4} placeholder="Describe what happened..." />
              </div>
              <div className="flex gap-3">
                <button onClick={() => setStep(1)} className="flex-1 border border-gray-300 text-gray-700 py-3 rounded-lg">Back</button>
                <button onClick={() => setStep(3)} disabled={!formData.location || !formData.description} className="flex-1 bg-orange-600 text-white py-3 rounded-lg disabled:bg-gray-300">Next</button>
              </div>
            </div>
          )}

          {step === 3 && (
            <div className="bg-white rounded-xl p-4 shadow-sm space-y-4">
              <h3 className="font-semibold text-gray-800">Additional Information</h3>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Reported By *</label>
                <input type="text" value={formData.reportedBy} onChange={(e) => setFormData({...formData, reportedBy: e.target.value})} className="w-full border rounded-lg p-3" placeholder="Your name" />
              </div>
              <div className="flex gap-3">
                <button onClick={() => setStep(2)} className="flex-1 border border-gray-300 text-gray-700 py-3 rounded-lg">Back</button>
                <button onClick={() => { onSubmit(formData); setStep(4); }} disabled={!formData.reportedBy} className="flex-1 bg-red-600 text-white py-3 rounded-lg disabled:bg-gray-300">Submit Report</button>
              </div>
            </div>
          )}
        </div>
      );
    }

    // Toolbox View
    function ToolboxView({ onSubmit, sites = [] }) {
      const [step, setStep] = useState(1);
      const [signingWorker, setSigningWorker] = useState(null);
      const [siteConducted, setSiteConducted] = useState('');
      const [builder, setBuilder] = useState('');
      const [address, setAddress] = useState('');
      const [isLocating, setIsLocating] = useState(false);
      const [preparedBy, setPreparedBy] = useState('');
      const [selectedTopics, setSelectedTopics] = useState([]);
      const [otherTopic, setOtherTopic] = useState('');
      const [correctiveAction, setCorrectiveAction] = useState('');
      const [feedbackResponses, setFeedbackResponses] = useState('');
      const [signatures, setSignatures] = useState({ 'Jeff Fu': null, 'Scott Seeho': null, 'Davide Casolini': null, 'Zonggang Jiang': null, 'Leon Yu': null, 'Wang Jia': null, 'Gen Bao': null });

      const todayDate = new Date().toLocaleDateString('en-AU', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
      const teamMembers = ['Jeff Fu', 'Scott Seeho', 'Davide Casolini', 'Zonggang Jiang', 'Leon Yu', 'Wang Jia', 'Gen Bao'];
      const preparers = ['Scott Seeho', 'Davide Casolini'];
      const builders = ['Fdc Fitout and Refurbishment', 'Fdc Construction', 'Hunter Mason', 'Built', 'Landlease'];
      const defaultSites = ['Site 1 - Sydney CBD', 'Site 2 - Parramatta', 'Site 3 - North Sydney', 'Site 4 - Chatswood', 'Site 5 - Liverpool'];
      const sitesList = sites.length > 0 ? sites : defaultSites;

      const topics = [
        'Manual Handling', 'Working at Heights', 'Hot Work Safety', 'PPE Requirements',
        'Emergency Procedures', 'Electrical Safety', 'Housekeeping', 'Slips, Trips & Falls',
        'Fire Safety', 'First Aid', 'Hazard Identification', 'Risk Assessment',
        'Confined Spaces', 'Scaffolding Safety', 'Crane & Lifting Operations', 'Welding Safety',
        'Chemical Handling', 'Noise & Hearing Protection', 'Sun & Heat Safety', 'Mental Health & Wellbeing',
        'Tool Safety', 'Mobile Plant Safety', 'Traffic Management', 'Asbestos Awareness',
        'Lock Out Tag Out (LOTO)', 'Incident Reporting', 'Near Miss Reporting', 'Safe Work Method Statements (SWMS)'
      ];

      const signedCount = Object.values(signatures).filter(s => s !== null).length;

      const toggleTopic = (topic) => {
        if (selectedTopics.includes(topic)) {
          setSelectedTopics(selectedTopics.filter(t => t !== topic));
        } else {
          setSelectedTopics([...selectedTopics, topic]);
        }
      };

      const getLocation = () => {
        setIsLocating(true);
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            async (position) => {
              try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${position.coords.latitude}&lon=${position.coords.longitude}`);
                const data = await response.json();
                setAddress(data.display_name || `${position.coords.latitude}, ${position.coords.longitude}`);
              } catch (e) {
                setAddress(`${position.coords.latitude}, ${position.coords.longitude}`);
              }
              setIsLocating(false);
            },
            () => { alert('Unable to get location'); setIsLocating(false); },
            { enableHighAccuracy: true, timeout: 10000 }
          );
        }
      };

      const handleSubmit = () => {
        onSubmit({
          siteConducted, builder, address, preparedBy,
          topics: selectedTopics, otherTopic, correctiveAction, feedbackResponses,
          signatures, date: new Date().toISOString()
        });
        setStep(3);
      };

      const resetForm = () => {
        setStep(1);
        setSiteConducted(''); setBuilder(''); setAddress(''); setPreparedBy('');
        setSelectedTopics([]); setOtherTopic(''); setCorrectiveAction(''); setFeedbackResponses('');
        setSignatures({ 'Jeff Fu': null, 'Scott Seeho': null, 'Davide Casolini': null, 'Zonggang Jiang': null, 'Leon Yu': null, 'Wang Jia': null, 'Gen Bao': null });
      };

      if (step === 3) {
        return (
          <div className="text-center py-12">
            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">âœ…</div>
            <h2 className="text-2xl font-bold text-gray-800 mb-2">Toolbox Talk Recorded!</h2>
            <p className="text-gray-600 mb-6">{signedCount} attendees signed on</p>
            <button onClick={resetForm} className="bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold">Record Another</button>
          </div>
        );
      }

      return (
        <div className="space-y-4">
          {signingWorker && <SignaturePad name={signingWorker} onSave={(data) => { setSignatures({...signatures, [signingWorker]: data}); setSigningWorker(null); }} onCancel={() => setSigningWorker(null)} />}

          {/* Date Banner */}
          <div className="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-4 text-white">
            <div className="flex items-center gap-2">
              <span>ğŸ“…</span>
              <span className="font-bold text-lg">{todayDate}</span>
            </div>
          </div>

          <div className="bg-white rounded-xl p-4 shadow-sm">
            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">ğŸ‘¥ Toolbox Talk</h2>
            <p className="text-gray-500 text-sm mt-1">Daily safety briefing record</p>
          </div>

          {step === 1 && (
            <div className="space-y-4">
              {/* Site Details */}
              <div className="bg-white rounded-xl p-4 shadow-sm space-y-4">
                <h3 className="font-semibold text-gray-800">Site Details</h3>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Site Conducted *</label>
                  <select value={siteConducted} onChange={(e) => setSiteConducted(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 bg-white">
                    <option value="">Select Site</option>
                    {sitesList.map((site) => <option key={site} value={site}>{site}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Builder *</label>
                  <select value={builder} onChange={(e) => setBuilder(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 bg-white">
                    <option value="">Select Builder</option>
                    {builders.map((b) => <option key={b} value={b}>{b}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">ğŸ“ Site Address *</label>
                  <div className="flex gap-2">
                    <input type="text" value={address} onChange={(e) => setAddress(e.target.value)}
                      className="flex-1 border border-gray-300 rounded-lg p-3" placeholder="Enter site address" />
                    <button onClick={getLocation} disabled={isLocating}
                      className="bg-blue-600 text-white px-4 rounded-lg disabled:bg-blue-400">
                      {isLocating ? '...' : 'ğŸ“'}
                    </button>
                  </div>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Prepared By *</label>
                  <select value={preparedBy} onChange={(e) => setPreparedBy(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 bg-white">
                    <option value="">Select Preparer</option>
                    {preparers.map((p) => <option key={p} value={p}>{p}</option>)}
                  </select>
                </div>
              </div>

              {/* Topics Discussed */}
              <div className="bg-white rounded-xl p-4 shadow-sm">
                <h3 className="font-semibold text-gray-800 mb-3">ğŸ“‹ Topics Discussed</h3>
                <p className="text-sm text-gray-500 mb-3">Select all topics covered in this toolbox talk</p>
                <div className="grid grid-cols-2 gap-2">
                  {topics.map((topic) => (
                    <button key={topic} onClick={() => toggleTopic(topic)}
                      className={`p-2 rounded-lg text-sm text-left border-2 ${selectedTopics.includes(topic) ? 'bg-purple-100 border-purple-500 text-purple-700' : 'border-gray-200 text-gray-700'}`}>
                      {selectedTopics.includes(topic) ? 'âœ“ ' : ''}{topic}
                    </button>
                  ))}
                </div>
                <div className="mt-4">
                  <label className="block text-sm font-medium text-gray-700 mb-2">Other Topics</label>
                  <textarea value={otherTopic} onChange={(e) => setOtherTopic(e.target.value)}
                    className="w-full border border-gray-300 rounded-lg p-3 text-sm" rows={2}
                    placeholder="Enter any other topics discussed..." />
                </div>
              </div>

              {/* Corrective Action Required */}
              <div className="bg-white rounded-xl p-4 shadow-sm">
                <h4 className="font-semibold text-gray-800 text-orange-600 mb-3">Corrective Action Required</h4>
                <textarea value={correctiveAction} onChange={(e) => setCorrectiveAction(e.target.value)}
                  className="w-full border border-gray-300 rounded-lg p-3 text-sm min-h-[80px]"
                  placeholder="Enter any corrective actions required..." />
              </div>

              {/* Feedback and Responses */}
              <div className="bg-white rounded-xl p-4 shadow-sm">
                <h4 className="font-semibold text-gray-800 text-orange-600 mb-3">Feedback and Responses</h4>
                <textarea value={feedbackResponses} onChange={(e) => setFeedbackResponses(e.target.value)}
                  className="w-full border border-gray-300 rounded-lg p-3 text-sm min-h-[80px]"
                  placeholder="Enter feedback and responses from attendees..." />
              </div>

              <button onClick={() => setStep(2)}
                disabled={!siteConducted || !builder || !address || !preparedBy || selectedTopics.length === 0}
                className="w-full bg-orange-600 text-white py-4 rounded-xl font-semibold disabled:bg-gray-300">
                Next: Attendance & Signatures â†’
              </button>
            </div>
          )}

          {step === 2 && (
            <div className="space-y-4">
              <div className="bg-white rounded-xl p-4 shadow-sm">
                <div className="flex items-center justify-between">
                  <h2 className="text-xl font-bold text-gray-800">Attendance & Signatures</h2>
                  <button onClick={() => setStep(1)} className="text-gray-500">â† Back</button>
                </div>
                <p className="text-gray-500 text-sm mt-1">Tap on a signature box to sign</p>
              </div>

              <div className="bg-purple-50 border border-purple-200 rounded-xl p-3">
                <p className="text-sm text-purple-800"><strong>Topics:</strong> {selectedTopics.join(', ')}</p>
                {otherTopic && <p className="text-sm text-purple-800 mt-1"><strong>Other:</strong> {otherTopic}</p>}
              </div>

              <div className="bg-white rounded-xl shadow-sm divide-y">
                {teamMembers.map((name) => (
                  <div key={name} className="p-4 flex items-center justify-between">
                    <span className="font-medium text-gray-800">{name}</span>
                    {signatures[name] ? (
                      <div className="relative">
                        <div className="border-2 border-green-500 rounded-lg p-2 bg-green-50 h-16 w-32">
                          <img src={signatures[name]} alt="signature" className="h-full w-full object-contain" />
                        </div>
                        <button onClick={() => setSignatures({...signatures, [name]: null})}
                          className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-sm">âœ•</button>
                      </div>
                    ) : (
                      <button onClick={() => setSigningWorker(name)}
                        className="h-16 w-32 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-purple-500">
                        Tap to sign
                      </button>
                    )}
                  </div>
                ))}
              </div>

              <div className="bg-blue-50 border border-blue-200 rounded-xl p-4">
                <p className="text-blue-800 font-medium">{signedCount} of {teamMembers.length} attendees signed</p>
              </div>

              <div className="flex gap-3">
                <button onClick={() => setStep(1)} className="flex-1 border border-gray-300 text-gray-700 py-4 rounded-xl font-semibold">â† Back</button>
                <button onClick={handleSubmit} disabled={signedCount === 0} className="flex-1 bg-green-600 text-white py-4 rounded-xl font-semibold disabled:bg-gray-300">
                  âœ“ Complete Toolbox Talk
                </button>
              </div>
            </div>
          )}
        </div>
      );
    }

    // Subcontractor Site Inspection View
    function SubcontractorInspectionView({ onSubmit, sites = [] }) {
      const [step, setStep] = useState(1);
      const [submitted, setSubmitted] = useState(false);
      const [siteConducted, setSiteConducted] = useState('');
      const [preparedBy, setPreparedBy] = useState('');
      const [location, setLocation] = useState('');
      const [isLocating, setIsLocating] = useState(false);
      const [completedBy, setCompletedBy] = useState('');
      const [completedBySignature, setCompletedBySignature] = useState(null);
      const [signingInspector, setSigningInspector] = useState(false);

      // Inspection items with Yes/No/N/A
      const [inspectionItems, setInspectionItems] = useState({
        siteBoxes: null,
        electricalLeads: null,
        toolsRetagging: null,
        exclusionZones: null,
        permitsCompleted: null,
        permitsActive: null,
        penetrationsCovered: null,
        equipmentInspection: null,
        workerSafetyConcerns: null,
        builderRequests: null,
      });

      const todayDate = new Date().toLocaleDateString('en-AU', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
      const preparers = ['Scott Seeho', 'Davide Casolini'];
      const inspectors = ['Scott Seeho', 'Davide Casolini'];
      const defaultSites = ['Site 1 - Sydney CBD', 'Site 2 - Parramatta', 'Site 3 - North Sydney', 'Site 4 - Chatswood', 'Site 5 - Liverpool'];
      const sitesList = sites.length > 0 ? sites : defaultSites;

      const inspectionQuestions = [
        { id: 'siteBoxes', text: 'Site boxes in good condition and lockable' },
        { id: 'electricalLeads', text: 'Electrical leads and tools are tagged and tested up to date' },
        { id: 'toolsRetagging', text: 'Tools or Equipment needed retagging or testing soon' },
        { id: 'exclusionZones', text: 'Exclusion zones set up around work areas (as required)' },
        { id: 'permitsCompleted', text: 'Permits are completed (as required)' },
        { id: 'permitsActive', text: 'Permits Active during inspection' },
        { id: 'penetrationsCovered', text: 'Penetrations are covered or have barriers around them' },
        { id: 'equipmentInspection', text: 'Equipment onsite has recent inspection completed' },
        { id: 'workerSafetyConcerns', text: 'Any worker reports of safety concerns or improvements' },
        { id: 'builderRequests', text: 'Any request from Builder' },
      ];

      const getLocation = () => {
        setIsLocating(true);
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            async (position) => {
              try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${position.coords.latitude}&lon=${position.coords.longitude}`);
                const data = await response.json();
                setLocation(data.display_name || `${position.coords.latitude}, ${position.coords.longitude}`);
              } catch (e) {
                setLocation(`${position.coords.latitude}, ${position.coords.longitude}`);
              }
              setIsLocating(false);
            },
            () => { alert('Unable to get location'); setIsLocating(false); },
            { enableHighAccuracy: true, timeout: 10000 }
          );
        }
      };

      const setInspectionValue = (id, value) => {
        setInspectionItems({ ...inspectionItems, [id]: value });
      };

      const allAnswered = Object.values(inspectionItems).every(v => v !== null);

      const handleSubmit = () => {
        onSubmit({
          siteConducted, preparedBy, location, completedBy, completedBySignature, inspectionItems,
          date: new Date().toISOString()
        });
        setSubmitted(true);
      };

      const resetForm = () => {
        setSiteConducted(''); setPreparedBy(''); setLocation(''); setCompletedBy('');
        setCompletedBySignature(null); setSigningInspector(false);
        setInspectionItems({
          siteBoxes: null, electricalLeads: null, toolsRetagging: null, exclusionZones: null,
          permitsCompleted: null, permitsActive: null, penetrationsCovered: null,
          equipmentInspection: null, workerSafetyConcerns: null, builderRequests: null,
        });
        setSubmitted(false);
      };

      if (submitted) {
        return (
          <div className="text-center py-12">
            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">âœ…</div>
            <h2 className="text-2xl font-bold text-gray-800 mb-2">Inspection Complete!</h2>
            <p className="text-gray-600 mb-6">Site inspection has been recorded.</p>
            <button onClick={resetForm} className="bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold">Start Another Inspection</button>
          </div>
        );
      }

      return (
        <div className="space-y-4">
          {signingInspector && <SignaturePad name={completedBy || "Inspector"} onSave={(data) => { setCompletedBySignature(data); setSigningInspector(false); }} onCancel={() => setSigningInspector(false)} />}

          {/* Date Banner */}
          <div className="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4 text-white">
            <div className="flex items-center gap-2">
              <span>ğŸ“…</span>
              <span className="font-bold text-lg">{todayDate}</span>
            </div>
          </div>

          <div className="bg-white rounded-xl p-4 shadow-sm">
            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">ğŸ” Subcontractor Site Inspection</h2>
            <p className="text-gray-500 text-sm mt-1">Complete site safety inspection</p>
          </div>

          {/* Site Details */}
          <div className="bg-white rounded-xl p-4 shadow-sm space-y-4">
            <h3 className="font-semibold text-gray-800">Site Details</h3>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Site Conducted *</label>
              <select value={siteConducted} onChange={(e) => setSiteConducted(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 bg-white">
                <option value="">Select Site</option>
                {sitesList.map((site) => <option key={site} value={site}>{site}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Prepared By *</label>
              <select value={preparedBy} onChange={(e) => setPreparedBy(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 bg-white">
                <option value="">Select Preparer</option>
                {preparers.map((p) => <option key={p} value={p}>{p}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">ğŸ“ Location *</label>
              <div className="flex gap-2">
                <input type="text" value={location} onChange={(e) => setLocation(e.target.value)}
                  className="flex-1 border border-gray-300 rounded-lg p-3" placeholder="Enter location" />
                <button onClick={getLocation} disabled={isLocating}
                  className="bg-blue-600 text-white px-4 rounded-lg disabled:bg-blue-400">
                  {isLocating ? '...' : 'ğŸ“'}
                </button>
              </div>
            </div>
          </div>

          {/* Inspection Questions */}
          <div className="bg-white rounded-xl p-4 shadow-sm">
            <h3 className="font-semibold text-gray-800 mb-4">ğŸ“‹ Inspection Checklist</h3>
            <div className="space-y-4">
              {inspectionQuestions.map((item, idx) => (
                <div key={item.id} className="border-b border-gray-100 pb-4 last:border-0 last:pb-0">
                  <p className="text-gray-700 mb-2 text-sm">{idx + 1}. {item.text}</p>
                  <div className="flex gap-2">
                    <button onClick={() => setInspectionValue(item.id, 'yes')}
                      className={`flex-1 py-2 rounded-lg font-medium text-sm border-2 ${inspectionItems[item.id] === 'yes' ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                      Yes
                    </button>
                    <button onClick={() => setInspectionValue(item.id, 'no')}
                      className={`flex-1 py-2 rounded-lg font-medium text-sm border-2 ${inspectionItems[item.id] === 'no' ? 'bg-red-500 border-red-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                      No
                    </button>
                    <button onClick={() => setInspectionValue(item.id, 'na')}
                      className={`flex-1 py-2 rounded-lg font-medium text-sm border-2 ${inspectionItems[item.id] === 'na' ? 'bg-gray-500 border-gray-500 text-white' : 'border-gray-300 text-gray-700'}`}>
                      N/A
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* Inspection Completed By */}
          <div className="bg-white rounded-xl p-4 shadow-sm space-y-4">
            <h3 className="font-semibold text-gray-800">âœ… Inspection Completed By *</h3>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Name *</label>
              <select value={completedBy} onChange={(e) => { setCompletedBy(e.target.value); setCompletedBySignature(null); }} className="w-full border border-gray-300 rounded-lg p-3 bg-white">
                <option value="">Select Inspector</option>
                {inspectors.map((i) => <option key={i} value={i}>{i}</option>)}
              </select>
            </div>
            {completedBy && (
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Signature *</label>
                {completedBySignature ? (
                  <div className="relative inline-block">
                    <div className="border-2 border-green-500 rounded-lg p-2 bg-green-50 h-20 w-40">
                      <img src={completedBySignature} alt="inspector signature" className="h-full w-full object-contain" />
                    </div>
                    <button onClick={() => setCompletedBySignature(null)}
                      className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-sm">âœ•</button>
                  </div>
                ) : (
                  <button onClick={() => setSigningInspector(true)}
                    className="h-20 w-40 border-2 border-dashed border-blue-300 rounded-lg text-blue-500 hover:border-blue-500">
                    Tap to sign
                  </button>
                )}
              </div>
            )}
          </div>

          <button onClick={handleSubmit}
            disabled={!siteConducted || !preparedBy || !location || !allAnswered || !completedBy || !completedBySignature}
            className="w-full bg-green-600 text-white py-4 rounded-xl font-semibold disabled:bg-gray-300">
            âœ“ Complete Inspection
          </button>
        </div>
      );
    }

    // ITP Form View
    function ITPFormView({ onSubmit, sites = [] }) {
      const [page, setPage] = useState(1);
      const [submitted, setSubmitted] = useState(false);
      const [signingPerson, setSigningPerson] = useState(null);

      // Page 1 - Title Page
      const [siteConducted, setSiteConducted] = useState('');
      const [conductedOn, setConductedOn] = useState(new Date().toISOString().slice(0, 16));
      const [preparedBy, setPreparedBy] = useState('');
      const [location, setLocation] = useState('');
      const [isLocating, setIsLocating] = useState(false);

      // Page 2 - Inspection Items
      const [preConstructionMeeting, setPreConstructionMeeting] = useState('');
      const [highRiskWorkshop, setHighRiskWorkshop] = useState(null);
      const [shopdrawingsApproved, setShopdrawingsApproved] = useState(null);
      const [allItemsSignedOff, setAllItemsSignedOff] = useState(null);

      // Procurement section
      const [shopdrawingRevision, setShopdrawingRevision] = useState('');
      const [orderedGlassFrom, setOrderedGlassFrom] = useState('');
      const [glassSpecification, setGlassSpecification] = useState('');

      // Installation of Glass section
      const [glassFreeFromDamage, setGlassFreeFromDamage] = useState(null);
      const [specificationOfFixings, setSpecificationOfFixings] = useState('');
      const [setoutCompletedBy, setSetoutCompletedBy] = useState('');
      const [installationMethod, setInstallationMethod] = useState('');
      const [glassInstalledCorrectRL, setGlassInstalledCorrectRL] = useState(null);
      const [glassLockedWedgedGlued, setGlassLockedWedgedGlued] = useState(null);
      const [removeWedgesCaulk, setRemoveWedgesCaulk] = useState('');

      // Installation of Handrails section
      const [handrailSpecConfirmed, setHandrailSpecConfirmed] = useState(null);
      const [spigotsCouplingsTight, setSpigotsCouplingsTight] = useState(null);
      const [handrailCompliantHeight, setHandrailCompliantHeight] = useState(null);
      const [threadOnFixings, setThreadOnFixings] = useState(null);
      const [fullWeldingJunctions, setFullWeldingJunctions] = useState(null);

      // Handover section
      const [allGlassNoDefects, setAllGlassNoDefects] = useState(null);
      const [allHandrailNoDefects, setAllHandrailNoDefects] = useState(null);
      const [balustradeAsPerDesign, setBalustradeAsPerDesign] = useState(null);

      // Page 3 - Sign off
      const [builderSignoffName, setBuilderSignoffName] = useState('');
      const [builderSignature, setBuilderSignature] = useState(null);
      const [futureCorrespondence, setFutureCorrespondence] = useState('');

      const todayDate = new Date().toLocaleDateString('en-AU', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
      const preparers = ['Scott Seeho', 'Davide Casolini'];
      const defaultSites = ['Site 1 - Sydney CBD', 'Site 2 - Parramatta', 'Site 3 - North Sydney'];
      const sitesList = sites.length > 0 ? sites : defaultSites;

      const getLocation = () => {
        setIsLocating(true);
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            async (position) => {
              try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${position.coords.latitude}&lon=${position.coords.longitude}`);
                const data = await response.json();
                setLocation(data.display_name || `${position.coords.latitude}, ${position.coords.longitude}`);
              } catch (e) {
                setLocation(`${position.coords.latitude}, ${position.coords.longitude}`);
              }
              setIsLocating(false);
            },
            () => { alert('Unable to get location'); setIsLocating(false); },
            { enableHighAccuracy: true, timeout: 10000 }
          );
        }
      };

      // Yes/No/NA Button Component
      const YesNoNAButtons = ({ value, onChange, label }) => (
        <div className="bg-white rounded-xl p-4 shadow-sm">
          <p className="text-gray-700 mb-3 font-medium">{label}</p>
          <div className="flex gap-2">
            <button onClick={() => onChange('yes')}
              className={`flex-1 py-2 rounded-lg font-medium text-sm border-2 ${value === 'yes' ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 text-gray-700'}`}>
              Yes
            </button>
            <button onClick={() => onChange('no')}
              className={`flex-1 py-2 rounded-lg font-medium text-sm border-2 ${value === 'no' ? 'bg-red-500 border-red-500 text-white' : 'border-gray-300 text-gray-700'}`}>
              No
            </button>
            <button onClick={() => onChange('na')}
              className={`flex-1 py-2 rounded-lg font-medium text-sm border-2 ${value === 'na' ? 'bg-gray-500 border-gray-500 text-white' : 'border-gray-300 text-gray-700'}`}>
              N/A
            </button>
          </div>
        </div>
      );

      // Text Input Box Component
      const TextInputBox = ({ value, onChange, label, placeholder }) => (
        <div className="bg-white rounded-xl p-4 shadow-sm">
          <p className="text-gray-700 mb-2 font-medium">{label}</p>
          <input type="text" value={value} onChange={(e) => onChange(e.target.value)}
            className="w-full border border-gray-300 rounded-lg p-3 text-sm" placeholder={placeholder || "Tap to edit"} />
        </div>
      );

      // Section Header Component
      const SectionHeader = ({ title, progress }) => (
        <div className="bg-indigo-400 rounded-xl p-3 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <span className="text-white">â–¼</span>
            <span className="text-white font-medium">{title}</span>
          </div>
          {progress && <span className="text-white text-sm">{progress}</span>}
        </div>
      );

      const handleSubmit = () => {
        onSubmit({
          siteConducted, conductedOn, preparedBy, location,
          preConstructionMeeting, highRiskWorkshop, shopdrawingsApproved, allItemsSignedOff,
          shopdrawingRevision, orderedGlassFrom, glassSpecification,
          glassFreeFromDamage, specificationOfFixings, setoutCompletedBy, installationMethod,
          glassInstalledCorrectRL, glassLockedWedgedGlued, removeWedgesCaulk,
          handrailSpecConfirmed, spigotsCouplingsTight, handrailCompliantHeight, threadOnFixings, fullWeldingJunctions,
          allGlassNoDefects, allHandrailNoDefects, balustradeAsPerDesign,
          builderSignoffName, builderSignature, futureCorrespondence,
          date: new Date().toISOString()
        });
        setSubmitted(true);
      };

      const resetForm = () => {
        setPage(1); setSubmitted(false);
        setSiteConducted(''); setConductedOn(new Date().toISOString().slice(0, 16)); setPreparedBy(''); setLocation('');
        setPreConstructionMeeting(''); setHighRiskWorkshop(null); setShopdrawingsApproved(null); setAllItemsSignedOff(null);
        setShopdrawingRevision(''); setOrderedGlassFrom(''); setGlassSpecification('');
        setGlassFreeFromDamage(null); setSpecificationOfFixings(''); setSetoutCompletedBy(''); setInstallationMethod('');
        setGlassInstalledCorrectRL(null); setGlassLockedWedgedGlued(null); setRemoveWedgesCaulk('');
        setHandrailSpecConfirmed(null); setSpigotsCouplingsTight(null); setHandrailCompliantHeight(null);
        setThreadOnFixings(null); setFullWeldingJunctions(null);
        setAllGlassNoDefects(null); setAllHandrailNoDefects(null); setBalustradeAsPerDesign(null);
        setBuilderSignoffName(''); setBuilderSignature(null); setFutureCorrespondence('');
      };

      if (submitted) {
        return (
          <div className="text-center py-12">
            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl">âœ…</div>
            <h2 className="text-2xl font-bold text-gray-800 mb-2">ITP Form Complete!</h2>
            <p className="text-gray-600 mb-6">Inspection Test Plan has been recorded.</p>
            <button onClick={resetForm} className="bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold">Start New ITP</button>
          </div>
        );
      }

      return (
        <div className="space-y-4">
          {signingPerson && <SignaturePad name={signingPerson} onSave={(data) => { setBuilderSignature(data); setSigningPerson(null); }} onCancel={() => setSigningPerson(null)} />}

          {/* Header */}
          <div className="bg-white rounded-xl p-4 shadow-sm">
            <div className="flex justify-between items-center">
              <div>
                <h2 className="text-xl font-bold text-gray-800">ğŸ“ ITP Form</h2>
                <p className="text-gray-500 text-sm">Page {page}/3</p>
              </div>
            </div>
          </div>

          {/* Page 1 - Title Page */}
          {page === 1 && (
            <div className="space-y-4">
              <div className="bg-gradient-to-r from-indigo-500 to-indigo-600 rounded-xl p-4 text-white">
                <p className="font-bold text-lg">Title Page</p>
                <p className="text-indigo-200 text-sm">Page 1/3</p>
              </div>

              <div className="bg-white rounded-xl p-4 shadow-sm space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">* Site Conducted</label>
                  <select value={siteConducted} onChange={(e) => setSiteConducted(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 bg-indigo-100 text-indigo-800 font-medium">
                    <option value="">Select Site</option>
                    {sitesList.map((site) => <option key={site} value={site}>{site}</option>)}
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Conducted on</label>
                  <input type="datetime-local" value={conductedOn} onChange={(e) => setConductedOn(e.target.value)}
                    className="w-full border border-gray-300 rounded-lg p-3 bg-gray-100" />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Prepared by</label>
                  <select value={preparedBy} onChange={(e) => setPreparedBy(e.target.value)} className="w-full border border-gray-300 rounded-lg p-3 bg-white">
                    <option value="">Select Preparer</option>
                    {preparers.map((p) => <option key={p} value={p}>{p}</option>)}
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Location</label>
                  <div className="flex gap-2">
                    <input type="text" value={location} onChange={(e) => setLocation(e.target.value)}
                      className="flex-1 border border-gray-300 rounded-lg p-3" placeholder="Enter location" />
                    <button onClick={getLocation} disabled={isLocating}
                      className="bg-indigo-500 text-white px-4 rounded-lg disabled:bg-indigo-300">
                      {isLocating ? '...' : 'ğŸ“'}
                    </button>
                  </div>
                </div>
              </div>

              <div className="flex justify-end">
                <button onClick={() => setPage(2)} disabled={!siteConducted || !preparedBy}
                  className="bg-indigo-500 text-white px-6 py-3 rounded-lg font-medium disabled:bg-gray-300">
                  Next â†’ Page 2/3
                </button>
              </div>
            </div>
          )}

          {/* Page 2 - ITP Form */}
          {page === 2 && (
            <div className="space-y-4">
              <div className="bg-gradient-to-r from-indigo-500 to-indigo-600 rounded-xl p-4 text-white">
                <p className="font-bold text-lg">ITP Form</p>
                <p className="text-indigo-200 text-sm">Page 2/3</p>
              </div>

              <TextInputBox label="* Pre-Construction Meeting completed with Builder : NAME" value={preConstructionMeeting} onChange={setPreConstructionMeeting} placeholder="Tap to edit" />

              <YesNoNAButtons label="High Risk Workshop Completed: (If Applicable)" value={highRiskWorkshop} onChange={setHighRiskWorkshop} />

              <YesNoNAButtons label="Shopdrawings Submitted to Builder and approved by Engineer" value={shopdrawingsApproved} onChange={setShopdrawingsApproved} />

              <YesNoNAButtons label="All Items Above completed and Signed off" value={allItemsSignedOff} onChange={setAllItemsSignedOff} />

              {/* Procurement Section */}
              <SectionHeader title="Procurement" />

              <TextInputBox label="Shopdrawing Revision for Glass Order" value={shopdrawingRevision} onChange={setShopdrawingRevision} />
              <TextInputBox label="Ordered Glass from (Company Name)" value={orderedGlassFrom} onChange={setOrderedGlassFrom} />
              <TextInputBox label="Glass Specification" value={glassSpecification} onChange={setGlassSpecification} />

              {/* Installation of Glass Section */}
              <SectionHeader title="Installation of Glass" progress="0/1 (0%)" />

              <YesNoNAButtons label="Glass free from damages and defects on edges" value={glassFreeFromDamage} onChange={setGlassFreeFromDamage} />
              <TextInputBox label="Specification of Fixings - Grout / Hilti HY270" value={specificationOfFixings} onChange={setSpecificationOfFixings} />
              <TextInputBox label="Setout completed by - Surveyor or J&M Artsteel - Name/Company" value={setoutCompletedBy} onChange={setSetoutCompletedBy} />
              <TextInputBox label="Installation method - Plant Required" value={installationMethod} onChange={setInstallationMethod} />
              <YesNoNAButtons label="Glass Installed with correct RL from builder and 1m from FFL Minimum" value={glassInstalledCorrectRL} onChange={setGlassInstalledCorrectRL} />
              <YesNoNAButtons label="All Glass Locked off, wedged and Glued for 24 hours minimum" value={glassLockedWedgedGlued} onChange={setGlassLockedWedgedGlued} />
              <TextInputBox label="Remove Wedges and Caulk gap if required" value={removeWedgesCaulk} onChange={setRemoveWedgesCaulk} />

              {/* Installation of Handrails Section */}
              <SectionHeader title="Installation of Handrails" progress="0/2 (0%)" />

              <YesNoNAButtons label="Handrail Specification Confirmed and Shopdrawing Approved" value={handrailSpecConfirmed} onChange={setHandrailSpecConfirmed} />
              <YesNoNAButtons label="Install all spigots and threaded couplings hand tight for alignment" value={spigotsCouplingsTight} onChange={setSpigotsCouplingsTight} />
              <YesNoNAButtons label="Installation of handrail to compliant height as per shopdrawing and Architectural details" value={handrailCompliantHeight} onChange={setHandrailCompliantHeight} />
              <YesNoNAButtons label="Thread on all fixings / brackets, tack all tube together" value={threadOnFixings} onChange={setThreadOnFixings} />
              <YesNoNAButtons label="Full welding of all junctions of spigots, handrail joints and all coupling pieces tensioned" value={fullWeldingJunctions} onChange={setFullWeldingJunctions} />

              {/* Handover and Finalisation Section */}
              <SectionHeader title="Handover and Finalisation of install" progress="0/1 (0%)" />

              <YesNoNAButtons label="All glass installed to satisfactory finish with no defects or damages" value={allGlassNoDefects} onChange={setAllGlassNoDefects} />
              <YesNoNAButtons label="All Handrail installed to satisfactory finish with no defects or damages - All joints welded and polished" value={allHandrailNoDefects} onChange={setAllHandrailNoDefects} />
              <YesNoNAButtons label="Balustrade system is installed as per design intent with correct RL heights" value={balustradeAsPerDesign} onChange={setBalustradeAsPerDesign} />

              <div className="flex justify-between">
                <button onClick={() => setPage(1)} className="border border-gray-300 text-gray-700 px-6 py-3 rounded-lg font-medium">
                  â† Back Page 1/3
                </button>
                <button onClick={() => setPage(3)} className="bg-indigo-500 text-white px-6 py-3 rounded-lg font-medium">
                  Next â†’ Page 3/3
                </button>
              </div>
            </div>
          )}

          {/* Page 3 - Sign off Page */}
          {page === 3 && (
            <div className="space-y-4">
              <div className="bg-gradient-to-r from-indigo-500 to-indigo-600 rounded-xl p-4 text-white">
                <p className="font-bold text-lg">Sign off Page</p>
                <p className="text-indigo-200 text-sm">Page 3/3</p>
              </div>

              {/* Builder Signoff */}
              <div className="bg-white rounded-xl p-4 shadow-sm space-y-4">
                <p className="text-gray-700 font-medium">Builder Signoff - Name / Signature</p>
                <input type="text" value={builderSignoffName} onChange={(e) => setBuilderSignoffName(e.target.value)}
                  className="w-full border border-gray-300 rounded-lg p-3" placeholder="Full name" />
                {builderSignoffName && (
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Signature</label>
                    {builderSignature ? (
                      <div className="relative inline-block">
                        <div className="border-2 border-green-500 rounded-lg p-2 bg-green-50 h-20 w-40">
                          <img src={builderSignature} alt="builder signature" className="h-full w-full object-contain" />
                        </div>
                        <button onClick={() => setBuilderSignature(null)}
                          className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-sm">âœ•</button>
                      </div>
                    ) : (
                      <button onClick={() => setSigningPerson(builderSignoffName)}
                        className="h-20 w-40 border-2 border-dashed border-indigo-300 rounded-lg text-indigo-500 hover:border-indigo-500 flex items-center justify-center">
                        âœï¸ Tap to sign
                      </button>
                    )}
                  </div>
                )}
              </div>

              {/* Comments and Notes Section */}
              <SectionHeader title="Comments and Notes" />

              <div className="bg-white rounded-xl p-4 shadow-sm">
                <p className="text-gray-700 mb-2 font-medium">Items for Future correspondence or arisen issues during constructions</p>
                <textarea value={futureCorrespondence} onChange={(e) => setFutureCorrespondence(e.target.value)}
                  className="w-full border border-gray-300 rounded-lg p-3 text-sm min-h-[100px]" placeholder="Tap to edit" />
              </div>

              <div className="flex justify-between">
                <button onClick={() => setPage(2)} className="border border-gray-300 text-gray-700 px-6 py-3 rounded-lg font-medium">
                  â† Back Page 2/3
                </button>
                <button onClick={handleSubmit}
                  className="bg-indigo-500 text-white px-6 py-3 rounded-lg font-medium">
                  Complete
                </button>
              </div>
            </div>
          )}
        </div>
      );
    }

    // Steel Inspection Test Plan View
    function SteelITPView({ onSubmit, sites = [] }) {
      const [step, setStep] = useState(1);
      const [submitted, setSubmitted] = useState(false);
      const [managerSignature, setManagerSignature] = useState(null);
      const [builderSignature, setBuilderSignature] = useState(null);
      const [signingManager, setSigningManager] = useState(false);
      const [signingBuilder, setSigningBuilder] = useState(false);

      // Form state
      const [siteConducted, setSiteConducted] = useState('');
      const [preparedBy, setPreparedBy] = useState('');
      const [location, setLocation] = useState('');
      const [jobStructure, setJobStructure] = useState('');

      // Items section
      const [preConstMeeting, setPreConstMeeting] = useState('');
      const [highRiskWorkshop, setHighRiskWorkshop] = useState('');
      const [shopdrawingsApproved, setShopdrawingsApproved] = useState('');
      const [allItemsSignedOff, setAllItemsSignedOff] = useState('');

      // Fabrication section
      const [materialsOrdered, setMaterialsOrdered] = useState('');
      const [materialsCorrect, setMaterialsCorrect] = useState('');
      const [visualCheck, setVisualCheck] = useState('');
      const [shopdrawingsCurrent, setShopdrawingsCurrent] = useState('');
      const [setoutCorrect, setSetoutCorrect] = useState('');
      const [tackWeld, setTackWeld] = useState('');
      const [fullyWelded, setFullyWelded] = useState('');
      const [packLoad, setPackLoad] = useState('');

      // Specialised finishes
      const [finishConfirmed, setFinishConfirmed] = useState('');
      const [deliveryBooked, setDeliveryBooked] = useState('');
      const [sentToPainter, setSentToPainter] = useState('');
      const [deliveryVehicle, setDeliveryVehicle] = useState('');
      const [afterDeliveryFinish, setAfterDeliveryFinish] = useState('');

      // Site setout
      const [drawingsConfirmed, setDrawingsConfirmed] = useState('');
      const [surveyorMeasurements, setSurveyorMeasurements] = useState('');
      const [surveyorName, setSurveyorName] = useState('');
      const [clashesDetected, setClashesDetected] = useState('');

      // Site installation
      const [chemicalAnchors, setChemicalAnchors] = useState('');
      const [anchorsInstalled, setAnchorsInstalled] = useState('');
      const [levelPlumb, setLevelPlumb] = useState('');
      const [boltsTorqued, setBoltsTorqued] = useState('');
      const [weldingCompleted, setWeldingCompleted] = useState('');

      // Grouting
      const [groutingCompleted, setGroutingCompleted] = useState('');

      // Final inspection
      const [itemsChecked, setItemsChecked] = useState('');
      const [finishAcceptable, setFinishAcceptable] = useState('');
      const [fixingsTorqued, setFixingsTorqued] = useState('');

      // NDT
      const [weldTestingBooked, setWeldTestingBooked] = useState('');
      const [testingIssues, setTestingIssues] = useState('');
      const [weldsPassed, setWeldsPassed] = useState('');

      // Handover
      const [colourConfirmed, setColourConfirmed] = useState('');
      const [defectsChecked, setDefectsChecked] = useState('');
      const [handoverAccepted, setHandoverAccepted] = useState('');

      // Manager info
      const [managerName, setManagerName] = useState('');
      const [builderName, setBuilderName] = useState('');

      const todayDate = new Date().toLocaleDateString('en-AU', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
      const defaultSites = ['Site 1 - Sydney CBD', 'Site 2 - Parramatta', 'Site 3 - North Sydney'];
      const sitesList = sites.length > 0 ? sites : defaultSites;

      const SelectField = ({ label, value, onChange }) => (
        <div className="space-y-2">
          <label className="block text-sm font-medium text-gray-700">{label}</label>
          <div className="flex gap-2">
            {['Yes', 'No', 'N/A'].map(opt => (
              <button key={opt} onClick={() => onChange(opt)} className={`flex-1 p-2 rounded-lg border text-sm font-medium ${value === opt ? 'bg-orange-500 text-white border-orange-500' : 'bg-white border-gray-300'}`}>
                {opt}
              </button>
            ))}
          </div>
        </div>
      );

      const handleSubmit = () => {
        const data = {
          siteConducted, preparedBy, location, jobStructure,
          preConstMeeting, highRiskWorkshop, shopdrawingsApproved, allItemsSignedOff,
          materialsOrdered, materialsCorrect, visualCheck, shopdrawingsCurrent,
          setoutCorrect, tackWeld, fullyWelded, packLoad,
          finishConfirmed, deliveryBooked, sentToPainter, deliveryVehicle, afterDeliveryFinish,
          drawingsConfirmed, surveyorMeasurements, surveyorName, clashesDetected,
          chemicalAnchors, anchorsInstalled, levelPlumb, boltsTorqued, weldingCompleted,
          groutingCompleted, itemsChecked, finishAcceptable, fixingsTorqued,
          weldTestingBooked, testingIssues, weldsPassed,
          colourConfirmed, defectsChecked, handoverAccepted,
          managerName, managerSignature, builderName, builderSignature,
          submittedAt: new Date().toISOString()
        };
        onSubmit(data);
        setSubmitted(true);
      };

      if (submitted) {
        return (
          <div className="space-y-4">
            <div className="bg-green-500 text-white p-6 rounded-xl text-center">
              <div className="text-6xl mb-4">âœ…</div>
              <h2 className="text-2xl font-bold">Steel ITP Submitted!</h2>
            </div>
            <button onClick={() => { setSubmitted(false); setStep(1); }} className="w-full bg-orange-600 text-white p-4 rounded-xl font-semibold">
              Start New Steel ITP
            </button>
          </div>
        );
      }

      return (
        <div className="space-y-4">
          {signingManager && <SignaturePad name={managerName} onSave={(sig) => { setManagerSignature(sig); setSigningManager(false); }} onCancel={() => setSigningManager(false)} />}
          {signingBuilder && <SignaturePad name={builderName} onSave={(sig) => { setBuilderSignature(sig); setSigningBuilder(false); }} onCancel={() => setSigningBuilder(false)} />}

          <div className="bg-gradient-to-r from-slate-600 to-slate-700 text-white p-4 rounded-xl">
            <h2 className="text-xl font-bold">ğŸ”© Steel Inspection Test Plan</h2>
            <p className="text-sm opacity-90 mt-1">J&M ArtSteel</p>
            <p className="text-xs mt-2">{todayDate}</p>
          </div>

          {/* Progress */}
          <div className="flex gap-1">
            {[1,2,3,4,5,6,7,8].map(s => (
              <div key={s} className={`flex-1 h-2 rounded ${step >= s ? 'bg-orange-500' : 'bg-gray-200'}`}></div>
            ))}
          </div>
          <p className="text-xs text-gray-500 text-center">Step {step} of 8</p>

          {/* Step 1: Basic Info */}
          {step === 1 && (
            <div className="bg-white rounded-xl p-4 space-y-4">
              <h3 className="font-bold text-gray-800 border-b pb-2">Basic Information</h3>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Site Conducted *</label>
                <select value={siteConducted} onChange={e => setSiteConducted(e.target.value)} className="w-full p-3 border rounded-lg">
                  <option value="">Select site</option>
                  {sitesList.map(s => <option key={s} value={s}>{s}</option>)}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Prepared By</label>
                <input type="text" value={preparedBy} onChange={e => setPreparedBy(e.target.value)} placeholder="Enter name" className="w-full p-3 border rounded-lg" />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Location</label>
                <input type="text" value={location} onChange={e => setLocation(e.target.value)} placeholder="Enter location" className="w-full p-3 border rounded-lg" />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Job / Structure ITP carried out on</label>
                <input type="text" value={jobStructure} onChange={e => setJobStructure(e.target.value)} placeholder="Enter job details" className="w-full p-3 border rounded-lg" />
              </div>
            </div>
          )}

          {/* Step 2: Pre-Construction Items */}
          {step === 2 && (
            <div className="bg-white rounded-xl p-4 space-y-4">
              <h3 className="font-bold text-gray-800 border-b pb-2">Items</h3>
              <SelectField label="Pre-Construction Meeting Completed with Builder" value={preConstMeeting} onChange={setPreConstMeeting} />
              <SelectField label="Structural Steel High Risk Workshop Completed" value={highRiskWorkshop} onChange={setHighRiskWorkshop} />
              <SelectField label="Shopdrawings Submitted and Approved by Engineer" value={shopdrawingsApproved} onChange={setShopdrawingsApproved} />
              <SelectField label="All Above items completed and Signed off" value={allItemsSignedOff} onChange={setAllItemsSignedOff} />
            </div>
          )}

          {/* Step 3: Fabrication */}
          {step === 3 && (
            <div className="bg-white rounded-xl p-4 space-y-4">
              <h3 className="font-bold text-gray-800 border-b pb-2">Fabrication</h3>
              <SelectField label="Materials Ordered as Per shopdrawings" value={materialsOrdered} onChange={setMaterialsOrdered} />
              <SelectField label="Materials on delivery are correct" value={materialsCorrect} onChange={setMaterialsCorrect} />
              <SelectField label="Visual Check Materials in good condition" value={visualCheck} onChange={setVisualCheck} />
              <SelectField label="Shopdrawings are current revision" value={shopdrawingsCurrent} onChange={setShopdrawingsCurrent} />
              <SelectField label="Setout cleats, plates, members correct" value={setoutCorrect} onChange={setSetoutCorrect} />
              <SelectField label="Tack weld, check straight and plumb" value={tackWeld} onChange={setTackWeld} />
              <SelectField label="Fully weld as per engineer specifications" value={fullyWelded} onChange={setFullyWelded} />
              <SelectField label="Pack and load materials for transport" value={packLoad} onChange={setPackLoad} />
            </div>
          )}

          {/* Step 4: Specialised Finishes */}
          {step === 4 && (
            <div className="bg-white rounded-xl p-4 space-y-4">
              <h3 className="font-bold text-gray-800 border-b pb-2">Specialised Finishes</h3>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Confirm finish of steel and approved</label>
                <input type="text" value={finishConfirmed} onChange={e => setFinishConfirmed(e.target.value)} placeholder="Enter finish type" className="w-full p-3 border rounded-lg" />
              </div>
              <SelectField label="Book delivery to site/workshop" value={deliveryBooked} onChange={setDeliveryBooked} />
              <SelectField label="Send material to painter/abrasive blaster" value={sentToPainter} onChange={setSentToPainter} />
              <SelectField label="Correct Delivery vehicle and sizes confirmed" value={deliveryVehicle} onChange={setDeliveryVehicle} />
              <SelectField label="After delivery finish is acceptable" value={afterDeliveryFinish} onChange={setAfterDeliveryFinish} />
            </div>
          )}

          {/* Step 5: Site Setout & Installation */}
          {step === 5 && (
            <div className="bg-white rounded-xl p-4 space-y-4">
              <h3 className="font-bold text-gray-800 border-b pb-2">Site Setout & Installation</h3>
              <SelectField label="Confirm correct drawings with builder" value={drawingsConfirmed} onChange={setDrawingsConfirmed} />
              <SelectField label="Surveyor has correct measurements" value={surveyorMeasurements} onChange={setSurveyorMeasurements} />
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Surveyor Name</label>
                <input type="text" value={surveyorName} onChange={e => setSurveyorName(e.target.value)} placeholder="Enter surveyor name" className="w-full p-3 border rounded-lg" />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Clashes detected / issues</label>
                <textarea value={clashesDetected} onChange={e => setClashesDetected(e.target.value)} placeholder="Describe any issues" className="w-full p-3 border rounded-lg" rows={3}></textarea>
              </div>
              <SelectField label="Chemical anchors correct as per specs" value={chemicalAnchors} onChange={setChemicalAnchors} />
              <SelectField label="Anchors installed correctly" value={anchorsInstalled} onChange={setAnchorsInstalled} />
              <SelectField label="Steel checked for level and plumbness" value={levelPlumb} onChange={setLevelPlumb} />
              <SelectField label="Bolts and nuts tightened/torqued" value={boltsTorqued} onChange={setBoltsTorqued} />
              <SelectField label="Welding completed to engineering specs" value={weldingCompleted} onChange={setWeldingCompleted} />
            </div>
          )}

          {/* Step 6: Grouting & Final Inspection */}
          {step === 6 && (
            <div className="bg-white rounded-xl p-4 space-y-4">
              <h3 className="font-bold text-gray-800 border-b pb-2">Grouting & Final Inspection</h3>
              <SelectField label="Grouting completed to all steel members" value={groutingCompleted} onChange={setGroutingCompleted} />
              <SelectField label="All installed items checked as per drawings" value={itemsChecked} onChange={setItemsChecked} />
              <SelectField label="Finish in good condition (touch ups done)" value={finishAcceptable} onChange={setFinishAcceptable} />
              <SelectField label="All fixings torqued at correct lengths" value={fixingsTorqued} onChange={setFixingsTorqued} />
            </div>
          )}

          {/* Step 7: NDT & Handover */}
          {step === 7 && (
            <div className="bg-white rounded-xl p-4 space-y-4">
              <h3 className="font-bold text-gray-800 border-b pb-2">NDT & Handover</h3>
              <SelectField label="Weld Testing booked and confirmed" value={weldTestingBooked} onChange={setWeldTestingBooked} />
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Any issues with Testing?</label>
                <textarea value={testingIssues} onChange={e => setTestingIssues(e.target.value)} placeholder="Describe issues" className="w-full p-3 border rounded-lg" rows={2}></textarea>
              </div>
              <SelectField label="All welds tested have passed compliance" value={weldsPassed} onChange={setWeldsPassed} />
              <SelectField label="Colour/finish confirmed by builder" value={colourConfirmed} onChange={setColourConfirmed} />
              <SelectField label="Builder checked for defects" value={defectsChecked} onChange={setDefectsChecked} />
              <SelectField label="Builder accepted handover (defect free)" value={handoverAccepted} onChange={setHandoverAccepted} />
            </div>
          )}

          {/* Step 8: Sign-offs */}
          {step === 8 && (
            <div className="bg-white rounded-xl p-4 space-y-4">
              <h3 className="font-bold text-gray-800 border-b pb-2">Sign-offs</h3>

              <div className="bg-gray-50 p-4 rounded-lg">
                <h4 className="font-semibold text-gray-700 mb-3">Manager Completing ITP</h4>
                <input type="text" value={managerName} onChange={e => setManagerName(e.target.value)} placeholder="Manager name" className="w-full p-3 border rounded-lg mb-3" />
                {managerSignature ? (
                  <div className="border rounded-lg p-2 bg-white">
                    <p className="text-xs text-gray-500 mb-1">Signature:</p>
                    <img src={managerSignature} alt="Manager signature" className="h-16" />
                  </div>
                ) : (
                  <button onClick={() => setSigningManager(true)} disabled={!managerName} className={`w-full p-3 rounded-lg font-semibold ${managerName ? 'bg-orange-500 text-white' : 'bg-gray-300 text-gray-500'}`}>
                    âœï¸ Sign
                  </button>
                )}
              </div>

              <div className="bg-gray-50 p-4 rounded-lg">
                <h4 className="font-semibold text-gray-700 mb-3">Builder Signoff</h4>
                <input type="text" value={builderName} onChange={e => setBuilderName(e.target.value)} placeholder="Builder name" className="w-full p-3 border rounded-lg mb-3" />
                {builderSignature ? (
                  <div className="border rounded-lg p-2 bg-white">
                    <p className="text-xs text-gray-500 mb-1">Signature:</p>
                    <img src={builderSignature} alt="Builder signature" className="h-16" />
                  </div>
                ) : (
                  <button onClick={() => setSigningBuilder(true)} disabled={!builderName} className={`w-full p-3 rounded-lg font-semibold ${builderName ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-500'}`}>
                    âœï¸ Sign
                  </button>
                )}
              </div>
            </div>
          )}

          {/* Navigation */}
          <div className="flex gap-3">
            {step > 1 && (
              <button onClick={() => setStep(step - 1)} className="flex-1 bg-gray-200 p-4 rounded-xl font-semibold">
                â† Previous
              </button>
            )}
            {step < 8 ? (
              <button onClick={() => setStep(step + 1)} className="flex-1 bg-orange-600 text-white p-4 rounded-xl font-semibold">
                Next â†’
              </button>
            ) : (
              <button onClick={handleSubmit} disabled={!managerSignature} className={`flex-1 p-4 rounded-xl font-semibold ${managerSignature ? 'bg-green-600 text-white' : 'bg-gray-300 text-gray-500'}`}>
                Submit Steel ITP âœ“
              </button>
            )}
          </div>
        </div>
      );
    }

    // Emergency View
    function EmergencyView() {
      const contacts = [
        { name: 'Emergency Services', number: '000', desc: 'Police, Fire, Ambulance' },
        { name: 'SafeWork NSW', number: '13 10 50', desc: 'Report serious incidents' },
        { name: 'Poisons Information', number: '13 11 26', desc: '24/7 advice' },
      ];

      return (
        <div className="space-y-4">
          <div className="bg-red-600 rounded-xl p-4 text-white">
            <h2 className="text-xl font-bold flex items-center gap-2">ğŸ“ Emergency Information</h2>
            <p className="text-red-100 text-sm mt-1">Keep this information accessible</p>
          </div>
          <div className="bg-white rounded-xl shadow-sm divide-y">
            {contacts.map((contact, idx) => (
              <a key={idx} href={`tel:${contact.number.replace(/\s/g, '')}`} className="p-4 flex items-center justify-between">
                <div>
                  <p className="font-semibold text-gray-800">{contact.name}</p>
                  <p className="text-sm text-gray-500">{contact.desc}</p>
                </div>
                <span className="font-bold text-lg text-red-600">{contact.number}</span>
              </a>
            ))}
          </div>
        </div>
      );
    }

    // Settings View
    function SettingsView({ sites = [], onUpdateSites }) {
      const [newSite, setNewSite] = useState('');
      const [showAddSite, setShowAddSite] = useState(false);
      const defaultSites = ['Site 1 - Sydney CBD', 'Site 2 - Parramatta', 'Site 3 - North Sydney'];
      const currentSites = sites.length > 0 ? sites : defaultSites;

      const addSite = () => {
        if (newSite.trim()) {
          onUpdateSites([...currentSites, newSite.trim()]);
          setNewSite('');
          setShowAddSite(false);
        }
      };

      return (
        <div className="space-y-4">
          <div className="bg-white rounded-xl p-4 shadow-sm">
            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">âš™ï¸ Settings</h2>
          </div>
          <div className="bg-white rounded-xl shadow-sm p-4">
            <div className="flex items-center justify-between mb-3">
              <h3 className="font-semibold text-gray-800">ğŸ—ï¸ Sites</h3>
              <button onClick={() => setShowAddSite(!showAddSite)} className="bg-green-600 text-white px-3 py-1 rounded-lg text-sm">+ Add Site</button>
            </div>
            {showAddSite && (
              <div className="mb-4 flex gap-2">
                <input type="text" value={newSite} onChange={(e) => setNewSite(e.target.value)} className="flex-1 border rounded-lg p-2 text-sm" placeholder="Enter site name" />
                <button onClick={addSite} className="bg-green-600 text-white px-4 py-2 rounded-lg text-sm">Add</button>
              </div>
            )}
            <div className="space-y-2">
              {currentSites.map((site, idx) => (
                <div key={idx} className="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                  <span className="text-sm text-gray-700">{site}</span>
                  <button onClick={() => onUpdateSites(currentSites.filter(s => s !== site))} className="text-red-500">ğŸ—‘ï¸</button>
                </div>
              ))}
            </div>
          </div>
          <div className="bg-white rounded-xl shadow-sm p-4">
            <h3 className="font-semibold text-gray-800 mb-2">Team Members</h3>
            <ul className="text-sm text-gray-600 space-y-1">
              <li>â€¢ Jeff Fu</li><li>â€¢ Scott Seeho</li><li>â€¢ Davide Casolini</li>
              <li>â€¢ Zonggang Jiang</li><li>â€¢ Leon Yu</li><li>â€¢ Wang Jia</li><li>â€¢ Gen Bao</li>
            </ul>
          </div>
          <div className="bg-white rounded-xl shadow-sm p-4">
            <p className="text-sm text-gray-600">JMart Steel Safety App v1.0</p>
            <p className="text-sm text-gray-600">NSW WHS Act 2011 Compliant</p>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<JMartSteelSafetyApp />);
  </script>

  <!-- Loading Screen -->
  <script>
    // Show loading spinner while React loads
    document.getElementById('root').innerHTML = '<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#f3f4f6;"><div class="spinner"></div><p style="margin-top:16px;color:#6b7280;font-family:system-ui;">Loading JMart Safety...</p></div>';
  </script>

  <!-- Service Worker Registration & Caching -->
  <script>
    // Register service worker for offline caching (if supported)
    if ('serviceWorker' in navigator) {
      // Create inline service worker
      const swCode = `
        const CACHE_NAME = 'jmart-safety-v1';
        const urlsToCache = [
          './',
          'https://cdn.tailwindcss.com',
          'https://unpkg.com/react@18/umd/react.production.min.js',
          'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js'
        ];

        self.addEventListener('install', event => {
          event.waitUntil(
            caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))
          );
        });

        self.addEventListener('fetch', event => {
          event.respondWith(
            caches.match(event.request).then(response => {
              return response || fetch(event.request).catch(() => {
                return new Response('Offline');
              });
            })
          );
        });
      `;

      const blob = new Blob([swCode], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(blob);

      navigator.serviceWorker.register(swUrl).catch(err => {
        console.log('SW registration skipped:', err.message);
      });
    }

    // Detect standalone mode (installed PWA)
    if (window.matchMedia('(display-mode: standalone)').matches) {
      document.body.classList.add('pwa-standalone');
      console.log('Running as installed PWA');
    }

    // Prevent pull-to-refresh on mobile (interferes with app UX)
    document.body.style.overscrollBehavior = 'none';

    // Handle iOS standalone mode
    if (window.navigator.standalone === true) {
      document.body.classList.add('ios-standalone');
    }
  </script>
</body>
</html>
